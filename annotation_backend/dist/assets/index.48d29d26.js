var Te=Object.defineProperty,Ee=Object.defineProperties;var Be=Object.getOwnPropertyDescriptors;var ke=Object.getOwnPropertySymbols;var Ve=Object.prototype.hasOwnProperty,Ue=Object.prototype.propertyIsEnumerable;var Ie=(e,t,r)=>t in e?Te(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,B=(e,t)=>{for(var r in t||(t={}))Ve.call(t,r)&&Ie(e,r,t[r]);if(ke)for(var r of ke(t))Ue.call(t,r)&&Ie(e,r,t[r]);return e},R=(e,t)=>Ee(e,Be(t));import{o as u,c as w,F as W,a as d,b as Ce,E as K,d as z,r as l,e as b,w as n,f as o,g as E,h as _,i as je,_ as se,D as Oe,t as j,j as ze,u as fe,m as Ne,s as Qe,k as ge,l as Pe,n as Le,p as J,q as H,v as ye,x as N,y as A,z as Re,A as Ge,B as O,C as qe,G as ie,H as Je,I as He,J as Ke,K as Ze,L as Se,M as be,N as we,O as We,P as Ae,Q as Xe,R as Ye,S as et,T as tt,U as ot,V as nt,W as lt,X as rt,Y as st,Z as it,$ as at,a0 as ct}from"./vendor.0cb2c7c6.js";const dt=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const s of document.querySelectorAll('link[rel="modulepreload"]'))i(s);new MutationObserver(s=>{for(const a of s)if(a.type==="childList")for(const p of a.addedNodes)p.tagName==="LINK"&&p.rel==="modulepreload"&&i(p)}).observe(document,{childList:!0,subtree:!0});function r(s){const a={};return s.integrity&&(a.integrity=s.integrity),s.referrerpolicy&&(a.referrerPolicy=s.referrerpolicy),s.crossorigin==="use-credentials"?a.credentials="include":s.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(s){if(s.ep)return;s.ep=!0;const a=r(s);fetch(s.href,a)}};dt();var L=(e,t)=>{const r=e.__vccOpts||e;for(const[i,s]of t)r[i]=s;return r};const ut={name:"HomePage",components:{}},_t=d("h1",{style:{"text-align":"center"}},"Home page of HILT Demo",-1),pt=d("div",{style:{display:"flex","justify-content":"center"}},[d("p",null," (Guideline will be uploaded soon) ")],-1);function mt(e,t,r,i,s,a){return u(),w(W,null,[_t,pt],64)}var ht=L(ut,[["render",mt]]);const U={1:"Sequence Classification",2:"Relation Extraction"},G={0:{name:"Neutral",colors:[{"background-color":"#FFFFFF",color:"#000000"},{"background-color":"#FFFFFF",color:"#000000"},{"background-color":"#FFFFFF",color:"#000000"},{"background-color":"#FFFFFF",color:"#000000"},{"background-color":"#FFFFFF",color:"#000000"}]},1:{name:"Red",colors:[{"background-color":"#EA9999",color:"#000000"},{"background-color":"#E06666",color:"#FFFFFF"},{"background-color":"#CC0000",color:"#FFFFFF"}]},2:{name:"Blue",colors:[{"background-color":"#ADD8E6",color:"#000000"},{"background-color":"#4682B4",color:"#000000"},{"background-color":"#00008B",color:"#FFFFFF"}]},3:{name:"Green",colors:[{"background-color":"#8AFF8A",color:"#000000"},{"background-color":"#00D100",color:"#FFFFFF"},{"background-color":"#007500",color:"#FFFFFF"}]},4:{name:"Purple",colors:[{"background-color":"#CC85FF",color:"#000000"},{"background-color":"#7700CC",color:"#FFFFFF"},{"background-color":"#3E006B",color:"#FFFFFF"}]},5:{name:"Orange",colors:[{"background-color":"#FFCA8A",color:"#000000"},{"background-color":"#FFA12E",color:"#000000"},{"background-color":"#D67600",color:"#000000"}]}};Ce.defaults.baseURL="/api";const D=Ce.create({headers:{Accept:"application/json","Content-Type":"application/json",Authorization:null}});D.interceptors.response.use(e=>e.data,e=>(K({title:"Error",message:e.toString(),type:"error"}),Promise.reject(e)));D.interceptors.request.use(e=>e,e=>(K({title:"Error",message:e.toString(),type:"error"}),Promise.reject(e)));var Y={list(){return D.get("hilt/projects/")},get(e){return D.get(`hilt/projects/${e}/`)},create(e){return D.post("hilt/projects/",e)},update(e){return D.put(`hilt/projects/${e.id}/`,e)},delete(e){return D.delete(`hilt/projects/${e}/`)},exportJSON(e){return D.get(`hilt/export/json/${e}/`)}};const P=z({id:"project",state:()=>({projectInfo:null}),getters:{getProjectInfo:e=>e.projectInfo,task:e=>e.projectInfo.task},actions:{reset_state(){Y.get(this.projectInfo.id).then(e=>(console.log("reset_project_state",e),this.projectInfo=e,e),e=>{console.log(e)})},setProject(e){this.projectInfo=e},setTask(e){this.projectInfo.task=e},exportJSON(){return Y.exportJSON(this.projectInfo.id)}}}),ft={name:"CreateProjectModal",props:{dialogVisible:Boolean,existingInfo:Object},setup(){const e=P(),t=[];for(let r in U)t.push({id:r,name:U[r]});return{projectStore:e,taskOptions:t}},data(){return{projectInfo:{name:"",description:"",task:""},formRules:{name:[{required:!0,message:"Please input project name",trigger:"blur"}],description:[{required:!0,message:"Please input description",trigger:"blur"}],task:[{required:!0,message:"Please select task",trigger:"blur"}]}}},methods:{dialogIsOpen(){if(this.existingInfo)for(let e in this.existingInfo)this.projectInfo[e]=this.existingInfo[e];else this.projectInfo={name:"",description:"",task:""}},createProject(){this.$refs.projectInfoForm.validate(e=>{if(e){let t;this.existingInfo?t=Y.update(this.projectInfo):t=Y.create(this.projectInfo),t.then(r=>{this.projectStore.setProject(r),this.$emit("update:dialogVisible",!1),this.$router.push({name:"DocumentUpload"})})}})}}},gt={class:"dialog-footer"},yt=_("Cancel"),St=_("Confirm");function bt(e,t,r,i,s,a){const p=l("el-input"),c=l("el-form-item"),h=l("el-option"),m=l("el-select"),g=l("el-form"),f=l("el-button"),k=l("el-dialog");return u(),b(k,{title:this.existingInfo?"Edit Existing Project":"Create New Project",modelValue:r.dialogVisible,"onUpdate:modelValue":t[4]||(t[4]=y=>r.dialogVisible=y),"onUpdate:visible":t[5]||(t[5]=y=>e.$emit("update:dialogVisible",y)),onOpen:this.dialogIsOpen,width:"40%"},{footer:n(()=>[d("span",gt,[o(f,{onClick:t[3]||(t[3]=()=>e.$emit("update:dialogVisible",!1))},{default:n(()=>[yt]),_:1}),o(f,{type:"primary",onClick:a.createProject},{default:n(()=>[St]),_:1},8,["onClick"])])]),default:n(()=>[o(g,{model:s.projectInfo,rules:s.formRules,ref:"projectInfoForm"},{default:n(()=>[o(c,{label:"Name",prop:"name"},{default:n(()=>[o(p,{modelValue:s.projectInfo.name,"onUpdate:modelValue":t[0]||(t[0]=y=>s.projectInfo.name=y)},null,8,["modelValue"])]),_:1}),o(c,{label:"Description",prop:"description"},{default:n(()=>[o(p,{modelValue:s.projectInfo.description,"onUpdate:modelValue":t[1]||(t[1]=y=>s.projectInfo.description=y)},null,8,["modelValue"])]),_:1}),o(c,{label:"Task",prop:"task"},{default:n(()=>[o(m,{remote:"",modelValue:s.projectInfo.task,"onUpdate:modelValue":t[2]||(t[2]=y=>s.projectInfo.task=y),placeholder:"Select",style:{width:"100%"}},{default:n(()=>[(u(!0),w(W,null,E(i.taskOptions,y=>(u(),b(h,{key:y.id,label:y.name,value:y.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue","onOpen"])}var wt=L(ft,[["render",bt]]);const Dt={name:"ProjectsPage",components:{CreateProjectModal:wt,Edit:je,Delete:se},setup(){const e=q(),t=P(),r=[];for(let i in U)r.push({text:U[i],value:U[i]});return{userStore:e,projectStore:t,filters:r}},data(){return{projects:[],dialogVisible:!1,selectedProject:null}},created:function(){this.fetchProjects()},methods:{handleProjectSelected(e,t){this.$router.push({name:"DocumentList"}),this.projectStore.setProject(t)},handleEdit(e,t){this.selectedProject=t,this.dialogVisible=!0},handleDelete(e,t){Y.delete(t.id).then(()=>{this.fetchProjects()})},fetchProjects(){Y.list().then(e=>{this.projects=e.results},e=>{console.log(e)})},dateFormat(e,t){let r=e[t.property];return r?Oe.fromISO(r).toISODate():""},convertTaskIDToString(e,t){let r=e[t.property];return r?U[r]:""},filterTask(e,t,r){let i=t[r.property],s=U[i];return e===s}}},xt={style:{"text-align":"center"}},vt=_("CREATE PROJECT "),kt=_(" Edit "),It=_("Delete");function $t(e,t,r,i,s,a){const p=l("el-button"),c=l("el-col"),h=l("el-row"),m=l("el-link"),g=l("el-table-column"),f=l("Edit"),k=l("el-icon"),y=l("Delete"),x=l("el-popconfirm"),I=l("el-table"),F=l("CreateProjectModal");return u(),w("div",null,[d("div",xt,[d("h1",null,"Hello, "+j(this.userStore.username),1),o(h,null,{default:n(()=>[o(c,{span:12,offset:6},{default:n(()=>[o(p,{type:"primary",onClick:t[0]||(t[0]=()=>{this.selectedProject=null,this.dialogVisible=!0})},{default:n(()=>[vt]),_:1})]),_:1})]),_:1})]),o(h,null,{default:n(()=>[o(c,{span:16,offset:4},{default:n(()=>[o(I,{data:s.projects,stripe:"","default-sort":{prop:"updated_at",order:"descending"}},{default:n(()=>[o(g,{prop:"name",label:"Name",sortable:""},{default:n(S=>[o(m,{type:"primary",onClick:T=>a.handleProjectSelected(S.$index,S.row)},{default:n(()=>[_(j(S.row.name),1)]),_:2},1032,["onClick"])]),_:1}),o(g,{prop:"description",label:"Description",sortable:""}),o(g,{prop:"task",label:"Task",formatter:a.convertTaskIDToString,sortable:"",filters:this.filters,"filter-method":a.filterTask,width:"180"},null,8,["formatter","filters","filter-method"]),o(g,{prop:"updated_at",label:"Last Updated",formatter:a.dateFormat,sortable:""},null,8,["formatter"]),o(g,{label:"Operations",width:"180"},{default:n(S=>[o(p,{size:"small",onClick:T=>a.handleEdit(S.$index,S.row)},{default:n(()=>[o(k,null,{default:n(()=>[o(f)]),_:1}),kt]),_:2},1032,["onClick"]),o(x,{title:"Are you sure?",onConfirm:T=>a.handleDelete(S.$index,S.row),style:{"margin-left":"10px"}},{reference:n(()=>[o(p,{size:"small",type:"danger"},{default:n(()=>[o(k,null,{default:n(()=>[o(y)]),_:1}),It]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1}),o(F,{"dialog-visible":s.dialogVisible,"onUpdate:dialog-visible":t[1]||(t[1]=S=>s.dialogVisible=S),"existing-info":this.selectedProject},null,8,["dialog-visible","existing-info"])])}var Ft=L(Dt,[["render",$t]]);const Ct={name:"SetupSideBar",components:{Files:ze,UploadFilled:fe,MessageBox:Ne,StarFilled:Qe,Edit:je,Download:ge,DataAnalysis:Pe,Tools:Le},computed:{disabled(){return this.projectStore.getProjectInfo,!1}},setup(){return{projectStore:P()}}},ae=e=>(J("data-v-fa01afce"),e=e(),H(),e),jt=ae(()=>d("span",null,"Setup",-1)),Pt=_(" Overview "),Lt=_(" Upload New Document "),Wt=_(" Upload Custom Model "),At=ae(()=>d("span",null,"Generate Explanations",-1)),Mt=ae(()=>d("span",null,"Debug",-1)),Tt=ae(()=>d("span",null,"Export Data",-1));function Et(e,t,r,i,s,a){const p=l("Tools"),c=l("el-icon"),h=l("Files"),m=l("el-menu-item"),g=l("UploadFilled"),f=l("el-sub-menu"),k=l("DataAnalysis"),y=l("el-menu"),x=l("Edit"),I=l("Download"),F=l("el-col");return u(),b(F,null,{default:n(()=>[o(y,{"default-active":e.$route.path,router:!0},{default:n(()=>[o(f,{index:"1"},{title:n(()=>[o(c,null,{default:n(()=>[o(p)]),_:1}),jt]),default:n(()=>[o(m,{index:"/project/doc/list"},{default:n(()=>[o(c,null,{default:n(()=>[o(h)]),_:1}),Pt]),_:1}),o(m,{index:"/project/doc/upload",disabled:a.disabled},{default:n(()=>[o(c,null,{default:n(()=>[o(g)]),_:1}),Lt]),_:1},8,["disabled"]),o(m,{index:"/project/doc/model",disabled:a.disabled},{default:n(()=>[o(c,null,{default:n(()=>[o(g)]),_:1}),Wt]),_:1},8,["disabled"])]),_:1}),o(m,{index:"/project/generate-explanations"},{default:n(()=>[o(c,null,{default:n(()=>[o(k)]),_:1}),At]),_:1})]),_:1},8,["default-active"]),o(y,null,{default:n(()=>[o(m,{onClick:t[0]||(t[0]=()=>this.$router.push({name:"DebugOverview"}))},{default:n(()=>[o(c,null,{default:n(()=>[o(x)]),_:1}),Mt]),_:1})]),_:1}),o(y,{"default-active":e.$route.path,router:!0},{default:n(()=>[o(m,{index:"/project/export"},{default:n(()=>[o(c,null,{default:n(()=>[o(I)]),_:1}),Tt]),_:1})]),_:1},8,["default-active"])]),_:1})}var Bt=L(Ct,[["render",Et],["__scopeId","data-v-fa01afce"]]);const Vt={name:"ProjectSetupPage",components:{SetupSideBar:Bt}};function Ut(e,t,r,i,s,a){const p=l("SetupSideBar"),c=l("el-aside"),h=l("router-view"),m=l("el-main"),g=l("el-container");return u(),w("div",null,[o(g,null,{default:n(()=>[o(c,{style:{"border-right":"solid 1px #e6e6e6"}},{default:n(()=>[o(p,{style:{width:"100%"}})]),_:1}),o(m,null,{default:n(()=>[o(h)]),_:1})]),_:1})])}var Ot=L(Vt,[["render",Ut]]);const zt={name:"SetupDocument"};function Nt(e,t,r,i,s,a){const p=l("router-view");return u(),b(p)}var Qt=L(zt,[["render",Nt]]),Z={list(e,t,r){const i={};return t&&(i.page=t),r&&(i.page_size=r),D.get(`hilt/projects/${e}/docs/`,{params:i})},uploadFile(e,t,r){const i=new FormData;return i.append("dataset",t),i.append("format",r.toLowerCase()),D.post(`hilt/projects/${e}/docs/upload/`,i,{headers:R(B({},D.defaults.headers),{"Content-Type":"multipart/form-data"})})},markAnnotated(e,t,r,i){return console.log("documents API",t,":	",r),D.put(`hilt/projects/${t}/docs/${r}/`,{annotated:e,project:t,text:i})},delete(e,t){return D.delete(`hilt/projects/${e}/docs/${t}/`)},detailedDocument(e,t){return D.get(`hilt/projects/${e}/docs/${t}/words-annotations/`)}};const ne=z({id:"document",state:()=>({documents:[],curPage:1,maxPage:1,totalDocCount:0,curDocIndex:0,annotatedDocCount:0,pageSize:10}),getters:{getDocuments:e=>e.documents,getdocumentInfo:e=>e},actions:{resetState(){return this.curPage=1,this.pageSize=10,this.fetchDocuments()},setCurDocIndex(e){this.curDocIndex=e},fetchDocuments(){const e=P();return Z.list(e.getProjectInfo.id,this.curPage,this.pageSize).then(t=>(this.documents=t.results.results,this.totalDocCount=t.count,this.annotatedDocCount=t.results.annotatedCount,this.maxPage=Math.ceil(this.totalDocCount/this.pageSize),console.log(t.results.results),t))},updateCurPage(e){return this.curPage=e,this.curDocIndex=0,this.fetchDocuments()},deleteDocument(e){const t=P();return Z.delete(t.getProjectInfo.id,e.id)},markAnnotated(e){const t=P();return this.documents[this.curDocIndex].id?(console.log(t.getProjectInfo.id,this.documents[this.curDocIndex].id),Z.markAnnotated(e,t.getProjectInfo.id,this.documents[this.curDocIndex].id,this.documents[this.curDocIndex].text).then(()=>{this.documents[this.curDocIndex].annotated=!0})):null}}}),Rt={name:"DocumentList",components:{Search:ye,Delete:se,QuestionFilled:N},setup(){return{documentStore:ne()}},data(){return{searchQuery:""}},methods:{pageChanged(e){this.documentStore.updateCurPage(e)},indexMethod(e){return e+1},percentageText(e){return`${e} % annotated`},handleDelete(e,t){this.documentStore.deleteDocument(t).then(()=>{this.documentStore.fetchDocuments()})}},created(){this.documentStore.resetState()}},Gt={style:{"text-align":"center"}},qt=d("div",null,[d("h1",null,"All Uploaded Documents")],-1),Jt={style:{"align-content":"center"}},Ht=_("Delete");function Kt(e,t,r,i,s,a){const p=l("Search"),c=l("el-icon"),h=l("el-input"),m=l("el-table-column"),g=l("Delete"),f=l("el-button"),k=l("el-popconfirm"),y=l("el-table"),x=l("el-pagination");return u(),w("div",null,[d("div",Gt,[qt,o(h,{modelValue:s.searchQuery,"onUpdate:modelValue":t[0]||(t[0]=I=>s.searchQuery=I),placeholder:"Type to search for documents",style:{width:"50%"},clearable:""},{prefix:n(()=>[d("div",Jt,[o(c,null,{default:n(()=>[o(p)]),_:1})])]),_:1},8,["modelValue"])]),o(y,{data:i.documentStore.getDocuments.filter(I=>!s.searchQuery||I.text.toLowerCase().includes(s.searchQuery.toLowerCase().trim())),stripe:""},{default:n(()=>[o(m,{type:"index",index:a.indexMethod},null,8,["index"]),o(m,{prop:"text",label:"Text"},{default:n(I=>[_(j(I.row.text),1)]),_:1}),o(m,{label:"Operations"},{default:n(I=>[o(k,{title:"Are you sure?",onConfirm:F=>a.handleDelete(I.$index,I.row),style:{"margin-left":"10px"}},{reference:n(()=>[o(f,{size:"small",type:"danger"},{default:n(()=>[o(c,null,{default:n(()=>[o(g)]),_:1}),Ht]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"]),o(x,{background:"",layout:"prev, pager, next",total:i.documentStore.getdocumentInfo.totalDocCount,"page-size":i.documentStore.getdocumentInfo.pageSize,"current-page":i.documentStore.getdocumentInfo.curPage,onCurrentChange:a.pageChanged,style:{"text-align":"center"}},null,8,["total","page-size","current-page","onCurrentChange"])])}var Zt=L(Rt,[["render",Kt]]);const Xt={name:"DocumentUpload",components:{UploadFilled:fe},setup(){return{projectStore:P()}},data(){return{fileForm:{fileType:"JSON"}}},methods:{uploadFile(e){Z.uploadFile(this.projectStore.getProjectInfo.id,e.file,this.fileForm.fileType).then(()=>{this.$router.push({name:"GenerateExplanations"})}).catch(t=>{console.log(t)})}}},V=e=>(J("data-v-4fd2d100"),e=e(),H(),e),Yt=V(()=>d("h3",null,"Import your corpus below",-1)),eo=V(()=>d("div",null,[_("In order to start the annotation process, a corpus "),d("u",null,"must"),_(" be uploaded")],-1)),to=V(()=>d("div",null,"We accept datasets in the following formats:",-1)),oo=V(()=>d("b",null,"JSON (recommended)",-1)),no=V(()=>d("br",null,null,-1)),lo=V(()=>d("u",null,"Format:",-1)),ro={style:{width:"fit-content","padding-left":"20px","padding-right":"20px",height:"fit-content"}},so=_("                "),io=_(`

{
  "data" : [
    {
      "text" : "Louis Armstrong the great trumpet player lived in Corona.",
    `),ao=_(`
      "label": "Label-Name-1"
    `),co=_(`
      "label": "Label-Name-1",
      "start_offset": 0,
      "end_offset": 5,
    `),uo=_(`
    },
    ...
  ]
}
              `),_o=_(`
							`),po=_(" Each entry within "),mo=V(()=>d("i",null,"data",-1)),ho=_(" must have keys "),fo=V(()=>d("i",null,[d("b",null,"text")],-1)),go=_(" and "),yo=V(()=>d("i",null,[d("b",null,"words")],-1)),So=_(". All other keys will be saved in a metadata dictionary associated with the text "),bo=V(()=>d("br",null,null,-1)),wo=_(" The "),Do=V(()=>d("i",null,[d("b",null,"annotations")],-1)),xo=_(" key in each entry is optional. And, can be used to populate the document with label. "),vo=V(()=>d("div",null,[_("Document Example: "),d("a",{href:"https://github.com/INK-USC/XMD/blob/master/annotation_backend/sample_data/tweeteval_hate_sample_100.json"},"[Dataset]")],-1)),ko=V(()=>d("br",null,null,-1)),Io=_("JSON file"),$o=V(()=>d("div",{class:"el-upload__text"},[_(" Drop file here or "),d("em",null,"click to upload")],-1));function Fo(e,t,r,i,s,a){const p=l("el-radio"),c=l("el-form-item"),h=l("UploadFilled"),m=l("el-icon"),g=l("el-upload"),f=l("el-form"),k=l("el-card"),y=l("el-col"),x=l("el-row");return u(),b(x,null,{default:n(()=>[o(y,null,{default:n(()=>[o(k,null,{header:n(()=>[Yt]),default:n(()=>[d("div",null,[eo,to,d("ul",null,[d("li",null,[oo,no,lo,d("pre",ro,[so,d("code",null,[io,this.projectStore.task===1?(u(),w(W,{key:0},[ao],64)):A("",!0),this.projectStore.task===2?(u(),w(W,{key:1},[co],64)):A("",!0),uo]),_o]),po,mo,ho,fo,go,yo,So,bo,wo,Do,xo])]),vo,ko]),o(f,{model:this.fileForm,style:{"text-align":"center"}},{default:n(()=>[o(c,null,{default:n(()=>[o(p,{modelValue:s.fileForm.fileType,"onUpdate:modelValue":t[0]||(t[0]=I=>s.fileForm.fileType=I),label:"JSON",border:""},{default:n(()=>[Io]),_:1},8,["modelValue"])]),_:1}),o(c,{label:""},{default:n(()=>[o(g,{"http-request":a.uploadFile,drag:"",accept:"text/json",ref:"uploadInput",action:""},{default:n(()=>[o(m,{size:48},{default:n(()=>[o(h)]),_:1}),$o]),_:1},8,["http-request"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1})}var Co=L(Xt,[["render",Fo],["__scopeId","data-v-4fd2d100"]]),X={list(e){return D.get(`hilt/projects/${e}/models/`)},uploadModel(e,t,r){const i=new FormData;return i.append("model_zip",t),i.append("format",r.toLowerCase()),console.log(i),D.post(`hilt/projects/${e}/models/upload/`,i,{headers:R(B({},D.defaults.headers),{"Content-Type":"multipart/form-data"})})},downloadModel(e,t){const r=new FormData;return r.append("model_id",t),D.post(`hilt/projects/${e}/model/download/`,r,{headers:R(B({},D.defaults.headers),{"Content-Type":"multipart/form-data"}),responseType:"arraybuffer"})}};const jo={name:"ModelUpload",components:{UploadFilled:fe,Upload:Re,SuccessFilled:Ge,QuestionFilled:N},setup(){return{projectStore:P()}},data(){return{modelRadio:"Upload Model",modelList:[],fileForm:{fileType:".zip",fileZip:[],file:null},savingSuccessful:!1}},methods:{handleUpload(e){X.uploadModel(this.projectStore.getProjectInfo.id,e.file,this.fileForm.fileType).then(t=>{console.log(t),t!=null&&t.success&&(this.savingSuccessful=!0)}).catch(t=>{console.log(t)})},uploadFile(){this.$refs.modelUploadForm.validate(e=>{e&&X.uploadModel(this.projectStore.getProjectInfo.id,this.fileForm.file,this.fileForm.description,this.fileForm.fileType).then(()=>{}).catch(t=>{console.log(t)})})},getModelList(){X.list(this.projectStore.getProjectInfo.id).then(e=>{this.modelList=e.results,console.log("res",e),console.log("model list:",this.modelList)})},created(){this.getModelList()}}},ce=e=>(J("data-v-1a6e1ead"),e=e(),H(),e),Po=_("Model List "),Lo=ce(()=>d("h3",null,[_("Upload new model "),d("span",{style:{color:"#909399"}},"(Optional)")],-1)),Wo=ce(()=>d("div",null,[_(" We expect model architecture be compatible to "),d("a",{href:"https://huggingface.co/docs/transformers/model_doc/auto#transformers.AutoModelForSequenceClassification"},"Huggingface sequence classification model")],-1)),Ao=ce(()=>d("div",null,[d("br")],-1)),Mo=_(".ZIP file"),To=ce(()=>d("div",{class:"el-upload__text"},[_(" Drop file here or "),d("em",null,"click to upload")],-1)),Eo={key:0,class:"success",style:{color:"green"}},Bo=_("Model was saved successfully ");function Vo(e,t,r,i,s,a){const p=l("QuestionFilled"),c=l("el-icon"),h=l("el-popover"),m=l("el-table-column"),g=l("el-table"),f=l("el-card"),k=l("el-radio"),y=l("el-form-item"),x=l("UploadFilled"),I=l("el-upload"),F=l("SuccessFilled"),S=l("el-form"),T=l("el-col"),$=l("el-row");return u(),b($,null,{default:n(()=>[o(T,null,{default:n(()=>[s.modelRadio=="Model List"?(u(),b(f,{key:0},{header:n(()=>[d("h3",null,[Po,o(h,{content:"help text",trigger:"hover",width:400},{reference:n(()=>[o(c,{style:{height:"100%","margin-left":"0.5rem"}},{default:n(()=>[o(p)]),_:1})]),_:1})])]),default:n(()=>[o(g,{data:this.modelList,stripe:"",style:{width:"100%"}},{default:n(()=>[o(m,{prop:"id",label:"Id"}),o(m,{prop:"name",label:"Name"}),o(m,{prop:"model",label:"Model path"}),o(m,{prop:"uploaded_at",label:"Uploaded at"})]),_:1},8,["data"])]),_:1})):A("",!0),s.modelRadio=="Upload Model"?(u(),b(f,{key:1},{header:n(()=>[Lo]),default:n(()=>[Wo,Ao,o(S,{model:this.fileForm,ref:"modelUploadForm",style:{"text-align":"center"}},{default:n(()=>[o(y,null,{default:n(()=>[o(k,{modelValue:s.fileForm.fileType,"onUpdate:modelValue":t[0]||(t[0]=v=>s.fileForm.fileType=v),label:".zip",border:""},{default:n(()=>[Mo]),_:1},8,["modelValue"])]),_:1}),o(y,null,{default:n(()=>[o(I,{"file-list":s.fileForm.fileZip,"onUpdate:file-list":t[1]||(t[1]=v=>s.fileForm.fileZip=v),drag:"",accept:".zip",ref:"uploadInput",action:"","http-request":a.handleUpload},{default:n(()=>[o(c,{size:48},{default:n(()=>[o(x)]),_:1}),To]),_:1},8,["file-list","http-request"])]),_:1}),s.savingSuccessful?(u(),w("div",Eo,[d("p",null,[Bo,o(c,null,{default:n(()=>[o(F)]),_:1})])])):A("",!0)]),_:1},8,["model"])]),_:1})):A("",!0)]),_:1})]),_:1})}var Uo=L(jo,[["render",Vo],["__scopeId","data-v-1a6e1ead"]]),$e={list(e){return D.get(`hilt/projects/${e}/labels/?page_size=100`)},update(e,t){return D.put(`hilt/projects/${e}/labels/${t.id}/`,t)}};const ee=z({id:"label",state:()=>({labels:[],labelsMap:{}}),getters:{getLabels:e=>e.labels,getLabelByID:e=>t=>!t||!(t in e.labelsMap)?null:e.labels[e.labelsMap[t]]},actions:{fetchLabels(){const e=P();return $e.list(e.getProjectInfo.id).then(t=>{const r={};for(let i=0;i<t.results.length;i++){const s=t.results[i];r[s.id]=i}return this.labels=t.results,this.labelsMap=r,t.results})},updateLabel(e){const t=P();return $e.update(t.getProjectInfo.id,e)}}}),Oo={name:"LabelModificationPage",components:{QuestionFilled:N},setup(){const e=ee(),t=[];for(let r in G)t.push({id:r,name:G[r].name});return{labelStore:e,colorSetOptions:t}},data(){return{existingLabels:[],colors_sets:[],saving:!1}},methods:{goNextStep(){this.saving=!0;const e=[];for(let t=0;t<this.existingLabels.length;t++){const r=this.existingLabels[t],i=parseInt(this.colors_sets[t]);r.color_set!=i&&(r.color_set=i,e.push(this.labelStore.updateLabel(r)))}Promise.all(e).then(()=>{this.saving=!1,this.labelStore.fetchLabels(),this.$router.push({name:"GenerateExplanations"})})},getColors(e){return e=parseInt(e),e in G?G[e].colors:[]}},created(){this.labelStore.fetchLabels().then(e=>{const t={};for(let r in e)t[r]=""+e[r].color_set;this.colors_sets=t,this.existingLabels=e})},computed:{disableButton(){if(this.saving)return!0;const e={};for(let t in this.colors_sets){if(t in e)return!0;e[t]=null}return!1}}},zo=d("h3",null,"Label Space Creation",-1),No={style:{"text-align":"left"}},Qo=d("b",null,"Current Label Space",-1),Ro={style:{"margin-left":"5px"}},Go=_(" Done ");function qo(e,t,r,i,s,a){const p=l("QuestionFilled"),c=l("el-icon"),h=l("el-popover"),m=l("el-col"),g=l("el-row"),f=l("el-divider"),k=l("el-option"),y=l("el-select"),x=l("el-form-item"),I=l("el-button"),F=l("el-form"),S=l("el-card");return u(),b(g,{style:{width:"100%"}},{default:n(()=>[o(S,{style:{width:"100%"}},{header:n(()=>[zo]),default:n(()=>[d("div",No,[o(g,null,{default:n(()=>[o(m,{span:8},{default:n(()=>[o(h,{content:"Available labels for model to predict.",trigger:"hover"},{reference:n(()=>[d("span",null,[Qo,o(c,{style:{"margin-left":"5px"}},{default:n(()=>[o(p)]),_:1})])]),_:1})]),_:1})]),_:1}),o(f),o(F,{model:s.colors_sets},{default:n(()=>[(u(!0),w(W,null,E(this.existingLabels,(T,$)=>(u(),b(g,{key:T.id},{default:n(()=>[o(x,{label:T.text},{default:n(()=>[o(y,{modelValue:this.colors_sets[$],"onUpdate:modelValue":v=>this.colors_sets[$]=v,placeholder:"Select",style:{width:"100%"}},{default:n(()=>[(u(!0),w(W,null,E(this.colorSetOptions,v=>(u(),b(k,{key:v.id,label:v.name,value:v.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]),d("div",Ro,[(u(!0),w(W,null,E(this.getColors(this.colors_sets[$]),(v,Q)=>(u(),w("span",{key:Q,style:O([v,{"margin-left":"5px",padding:"5px"}])}," Word ",4))),128))])]),_:2},1024))),128)),o(g,null,{default:n(()=>[o(I,{type:"success",disabled:this.disableButton,onClick:a.goNextStep},{default:n(()=>[Go]),_:1},8,["disabled","onClick"])]),_:1})]),_:1},8,["model"])])]),_:1})]),_:1})}var Jo=L(Oo,[["render",qo]]),le={generateExplanations(e,t,{str:r,model_id:i,model_path:s}={}){console.log("inside network/explanations.js");const a=new FormData;return a.append("useHuggingface",t),t?a.append("str",r):(a.append("model_id",i),a.append("model_path",s)),console.log(a),D.post(`hilt/projects/${e}/explanations/`,a,{headers:R(B({},D.defaults.headers),{"Content-Type":"multipart/form-data"})})},didFinishGeneration(e){return D.get(`hilt/projects/${e}/update/model_status/`)},getAttributeScoresForDoc(e,t,r,i){console.log("inside network/getAttributeScoresForDoc function");const s=new FormData;return s.append("text",t),s.append("label",r),s.append("model_id",i),console.log("explanations/single",s),D.post(`hilt/projects/${e}/explanations/single`,s,{headers:R(B({},D.defaults.headers),{"Content-Type":"multipart/form-data"})})}};const Ho={name:"GenerateExplanations",components:{Tools:Le,QuestionFilled:N},setup(){return{projectStore:P()}},data(){return{generating_explanations:!1,huggingfaceForm:{str:"",rules:{str:{required:!0,message:"Please input huggingface model name",trigger:"blur"}}},customModelForm:{modelList:[],select:"",rules:{select:{required:!0,message:"Please select model",trigger:"change"}}},loadingExplanations:!1}},methods:{getModelList(){console.log("model list"),X.list(this.projectStore.getProjectInfo.id).then(e=>{this.customModelForm.modelList=e.results})},huggingfaceSubmit(){this.$refs.huggingfaceForm.validate(e=>{e&&(console.log("huggingface generate explanations"),this.loadingExplanations=!0,le.generateExplanations(this.projectStore.getProjectInfo.id,!0,{str:this.huggingfaceForm.str}).then(t=>{console.log("Here"),console.log(t),this.generating_explanations=!0,this.waitForCompletion(),K({title:"Explanation Generation Started",message:"Page will automatically change once task is completed",type:"success",duration:0})}).catch(t=>{this.loadingExplanations=!1,t.response&&t.response.data?this.$notify.error({title:"Model training failed",message:t.response.data}):this.$notify.error({title:"Model failed to start training",message:"Please try again later"})}))})},customModelSubmit(){this.$refs.customModelForm.validate(e=>{e&&(console.log("custom model generate explanations"),console.log("model_id:",this.customModelForm.select[0]),console.log("model_path",this.customModelForm.select[1]),this.loadingExplanations=!0,K({title:"Started",message:"Task accepted",type:"success",duration:4500}),le.generateExplanations(this.projectStore.getProjectInfo.id,!1,{model_id:this.customModelForm.select[0],model_path:this.customModelForm.select[1]}).then(t=>{const r=this.projectStore.getProjectInfo;this.projectStore.reset_state(),console.log(r.explanations_status),console.log(t),this.generating_explanations=!0,this.waitForCompletion(),K({title:"Explanation Generation Started",message:"Page will automatically change once task is",type:"success",duration:0})}).catch(t=>{this.loadingExplanations=!1,console.log(t),t.response&&t.response.data?this.$notify.error({title:"Model training failed",message:t.response.data}):this.$notify.error({title:"Model failed to start training",message:"Please try again later"})}))})},waitForCompletion(){let e=60,t=setInterval(()=>le.didFinishGeneration(this.projectStore.getProjectInfo.id).then(r=>{console.log(r),e<0||r.status=="finished"?(console.log("finished"),this.loadingExplanations=!1,this.$notify.success({title:"Success",message:"Model Execution had been completed",duration:0}),clearInterval(t),this.$router.push({name:"DebugOverview"})):(console.log("Waiting for model finish message."),e-=1,console.log(e))}),2*1e3)}},mounted(){this.getModelList()}},Ko=_(" Generate Explanations Page "),Zo=_(" Generate Explanations "),Xo=_("Generate Explanations");function Yo(e,t,r,i,s,a){const p=l("QuestionFilled"),c=l("el-icon"),h=l("el-popover"),m=l("el-input"),g=l("el-col"),f=l("el-form-item"),k=l("el-button"),y=l("el-form"),x=l("el-tab-pane"),I=l("el-option"),F=l("el-select"),S=l("el-tabs"),T=l("el-card");return u(),b(T,{style:{width:"100%"}},{default:n(()=>[d("h3",null,[Ko,o(h,{content:"Generate model attribution scores using Captum (https://captum.ai/tutorials/)",trigger:"hover",width:400},{reference:n(()=>[o(c,{style:{height:"100%","margin-left":"0.5rem"}},{default:n(()=>[o(p)]),_:1})]),_:1})]),o(S,{type:"border-card"},{default:n(()=>[o(x,{label:"Huggingface"},{default:n(()=>[o(y,{model:s.huggingfaceForm,ref:"huggingfaceForm",rules:s.huggingfaceForm.rules,"label-position":"top"},{default:n(()=>[o(f,{label:"huggingface model name",prop:"str"},{default:n(()=>[o(g,{span:6},{default:n(()=>[o(m,{modelValue:s.huggingfaceForm.str,"onUpdate:modelValue":t[0]||(t[0]=$=>s.huggingfaceForm.str=$),placeholder:"cardiffnlp/bertweet-base-hate"},null,8,["modelValue"])]),_:1}),o(h,{content:"Search your model from Huggingface model hub (https://huggingface.co/models)",trigger:"hover",width:400},{reference:n(()=>[o(c,{style:{height:"100%","margin-left":"0.5rem"}},{default:n(()=>[o(p)]),_:1})]),_:1})]),_:1}),o(f,null,{default:n(()=>[o(k,{type:"primary",onClick:a.huggingfaceSubmit,loading:s.loadingExplanations},{default:n(()=>[Zo]),_:1},8,["onClick","loading"])]),_:1})]),_:1},8,["model","rules"])]),_:1}),o(x,{label:"Custom Model"},{default:n(()=>[o(y,{model:s.customModelForm,ref:"customModelForm",rules:s.customModelForm.rules,"label-position":"top"},{default:n(()=>[o(f,{label:"Custom Model",prop:"select"},{default:n(()=>[o(F,{modelValue:s.customModelForm.select,"onUpdate:modelValue":t[1]||(t[1]=$=>s.customModelForm.select=$),clearable:"",placeholder:"Select Model"},{default:n(()=>[(u(!0),w(W,null,E(s.customModelForm.modelList,$=>(u(),b(I,{key:$.id,label:$.name,value:[$.id,$.model]},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),o(h,{content:"Select your custom model. You can upload your model in project setup.",trigger:"hover",width:400},{reference:n(()=>[o(c,{style:{height:"100%","margin-left":"0.5rem"}},{default:n(()=>[o(p)]),_:1})]),_:1})]),_:1}),o(f,null,{default:n(()=>[o(k,{type:"primary",onClick:a.customModelSubmit,loading:s.loadingExplanations},{default:n(()=>[Xo]),_:1},8,["onClick","loading"])]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1})]),_:1})}var en=L(Ho,[["render",Yo]]);const tn={name:"ExportData",components:{Download:ge,QuestionFilled:N},setup(){return{projectStore:P()}},methods:{exportJSON(){this.projectStore.exportJSON().then(e=>{qe(JSON.stringify(e,null,1),`${this.projectStore.getProjectInfo.name}.json`)})}}},on=_("Export Explanation-Generated Data "),nn=_(" Download JSON data ");function ln(e,t,r,i,s,a){const p=l("QuestionFilled"),c=l("el-icon"),h=l("el-popover"),m=l("Download"),g=l("el-button");return u(),w(W,null,[d("h3",null,[on,o(h,{content:"help text",trigger:"hover",width:400},{reference:n(()=>[o(c,{style:{height:"100%","margin-left":"0.5rem"}},{default:n(()=>[o(p)]),_:1})]),_:1})]),o(g,{type:"primary",onClick:t[0]||(t[0]=f=>a.exportJSON())},{default:n(()=>[o(c,null,{default:n(()=>[o(m)]),_:1}),nn]),_:1})],64)}var rn=L(tn,[["render",ln]]);const sn={name:"SetupSideBar",components:{Back:ie,Document:Je,DocumentCopy:He,List:Ke,Management:Ze,DataAnalysis:Pe}},De=e=>(J("data-v-c9efccda"),e=e(),H(),e),an=De(()=>d("span",null,"Back",-1)),cn=De(()=>d("span",null,"Debug Overview",-1)),dn=De(()=>d("span",null,"Evaluation",-1));function un(e,t,r,i,s,a){const p=l("Back"),c=l("el-icon"),h=l("el-menu-item"),m=l("Management"),g=l("DataAnalysis"),f=l("el-menu"),k=l("el-col");return u(),b(k,null,{default:n(()=>[o(f,{"default-active":e.$route.path},{default:n(()=>[o(h,{index:"1",onClick:t[0]||(t[0]=()=>this.$router.push({name:"GenerateExplanations"}))},{default:n(()=>[o(c,null,{default:n(()=>[o(p)]),_:1}),an]),_:1}),o(h,{index:"/debug/overview",onClick:t[1]||(t[1]=()=>this.$router.push({name:"DebugOverview"}))},{default:n(()=>[o(c,null,{default:n(()=>[o(m)]),_:1}),cn]),_:1}),o(h,{index:"/debug/evaluation",onClick:t[2]||(t[2]=()=>this.$router.push({name:"DebugEvaluation"}))},{default:n(()=>[o(c,null,{default:n(()=>[o(g)]),_:1}),dn]),_:1})]),_:1},8,["default-active"])]),_:1})}var _n=L(sn,[["render",un],["__scopeId","data-v-c9efccda"]]);const xe=z({id:"detailedDocument",state:()=>({document:null,maxWords:50}),getters:{getDocument:e=>e.document,getMaxWords:e=>e.maxWords},actions:{fetchDocument(e){const t=P();return Z.detailedDocument(t.getProjectInfo.id,e).then(r=>{const i={};for(let s of r.words){const a={};for(let p of s.word_annotation_score)a[p.annotation]=p,p.annotation in i||(i[p.annotation]=[]),i[p.annotation].push([p.score,p]);s.scores=a,delete s.word_annotation_score}for(let s in i){const a=i[s];a.sort((c,h)=>h[0]-c[0]);let p=0;for(let c=0;c<a.length;c++){const h=a[c];c>0&&a[c-1][0]!==h[0]&&(p=c),h[1].order=p}}this.document=r})}}});var pe={list(e,t){const r=t!==void 0?`&doc_id=${t}`:"";return D.get(`hilt/projects/${e}/dict/local/?page_size=10000`+r)},create(e,t){return D.post(`hilt/projects/${e}/dict/local/`,t)},delete(e,t){return D.delete(`hilt/projects/${e}/dict/local/${t}/`)}};const de=z({id:"dictionary_local",state:()=>({documents:{},annotatedDocCount:0}),getters:{getByDocumentID:e=>t=>e.documents[t],fetchIfExists:e=>(t,r,i)=>{if(!(t in e.documents))return null;const s=e.documents[t];if(!(r in s))return null;const a=s[r];return i in a?a[i]:null},getLocalInfo:e=>e},actions:{fetchDictionary(e){const t=P();return pe.list(t.getProjectInfo.id,e).then(r=>{const i=r.results,s={};let a=0;for(let p of i){const c=p.word.document;c in s||(s[c]={},a+=1);const h=p.word.id;h in s[c]||(s[c][h]={});const m=p.annotation;s[c][h][m]=p}this.documents=s,this.annotatedDocCount=a,console.log(`dictionaryLocal -> fetchDictionary: annotatedDocCount ${a}`)})},addWord(e,t){const r=P();return pe.create(r.getProjectInfo.id,t).then(()=>{this.fetchDictionary(e)})},deleteWord(e){const t=P();return pe.delete(t.getProjectInfo.id,e).then(()=>this.fetchDictionary())}}});const pn={name:"LocalSideBar",components:{Back:ie,Check:Se},setup(){const e=ne(),t=xe(),r=ee(),i=de();return{documentStore:e,detailedDocumentStore:t,labelStore:r,localDictionaryStore:i}},data(){return{docs:[]}},created(){const e=[];e.push(this.labelStore.fetchLabels()),e.push(this.documentStore.resetState().then(()=>this.localDictionaryStore.fetchDictionary(this.documentStore.getDocuments[this.documentStore.getdocumentInfo.curDocIndex].id))),Promise.all(e).then(()=>{this.detailedDocumentStore.fetchDocument(this.documentStore.getDocuments[this.documentStore.getdocumentInfo.curDocIndex].id),this.docs=this.documentStore.getDocuments,console.log("updating docs data")})},methods:{pageChanged(e){this.documentStore.updateCurPage(e).then(t=>{this.docs=t.results.results,console.log("updating docs data"),this.detailedDocumentStore.fetchDocument(this.documentStore.getDocuments[this.documentStore.getdocumentInfo.curDocIndex].id)})},goToDocument(e,t){this.documentStore.setCurDocIndex(e),this.detailedDocumentStore.fetchDocument(t.id),this.localDictionaryStore.fetchDictionary(t.id)},truncate(e,t){return e.length>t?e.substring(0,t)+"...":e}}},mn=e=>(J("data-v-35321ea0"),e=e(),H(),e),hn=mn(()=>d("span",null,"Back",-1)),fn={key:0},gn={key:1};function yn(e,t,r,i,s,a){const p=l("Back"),c=l("el-icon"),h=l("el-menu-item"),m=l("el-menu"),g=l("Check"),f=l("el-table-column"),k=l("el-link"),y=l("el-table"),x=l("el-pagination"),I=l("el-col");return u(),b(I,null,{default:n(()=>[o(m,null,{default:n(()=>[o(h,{onClick:t[0]||(t[0]=()=>this.$router.push({name:"DebugOverview"}))},{default:n(()=>[o(c,null,{default:n(()=>[o(p)]),_:1}),hn]),_:1})]),_:1}),o(y,{data:Array.from(s.docs)},{default:n(()=>[o(f,{width:"40"},{default:n(F=>[F.row.annotated?(u(),w("span",fn,[o(c,null,{default:n(()=>[o(g)]),_:1})])):(u(),w("div",gn,j(i.documentStore.getdocumentInfo.pageSize*(i.documentStore.getdocumentInfo.curPage-1)+F.$index+1),1))]),_:1}),o(f,{prop:"text"},{default:n(F=>[o(k,{onClick:S=>a.goToDocument(F.$index,F.row)},{default:n(()=>[_(j(this.truncate(F.row.text,100)),1)]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),o(x,{background:"",layout:"prev, pager, next",total:i.documentStore.getdocumentInfo.totalDocCount,"page-size":i.documentStore.getdocumentInfo.pageSize,"current-page":i.documentStore.getdocumentInfo.curPage,onCurrentChange:a.pageChanged,style:{"text-align":"center"}},null,8,["total","page-size","current-page","onCurrentChange"])]),_:1})}var Sn=L(pn,[["render",yn],["__scopeId","data-v-35321ea0"]]),Fe={list(e,t,r,i){const s={};return t&&(s.page=t),r!=null&&(s.page_size=r),i!=null&&(s.q=i),D.get(`hilt/projects/${e}/words/`,{params:s})},documents(e,t){return D.get(`hilt/projects/${e}/words/${t}/`)}};const ue=z({id:"words",state:()=>({words:[],curPage:1,maxPage:1,totalWordCount:0,curWordIndex:0,pageSize:10,currDocuments:[],searchQuery:void 0,wordLoaded:!1}),getters:{getWords:e=>e.words,getWordInfo:e=>e,getCurrWord:e=>()=>e.words[e.curWordIndex]?e.words[e.curWordIndex].text:void 0,getDocuments:e=>e.currDocuments},actions:{resetState(e=void 0){return this.curPage=1,this.pageSize=10,this.currDocuments=[],this.searchQuery=e,this.fetchWords()},setCurWordIndex(e){this.curWordIndex=e},fetchWords(){const e=P();return Fe.list(e.getProjectInfo.id,this.curPage,this.pageSize,this.searchQuery).then(t=>(this.words=t.results,this.totalWordCount=t.count,this.maxPage=Math.ceil(this.totalWordCount/this.pageSize),t))},updateCurPage(e){return this.curPage=e,this.curWordIndex=0,this.currDocuments=[],this.fetchWords()},fetchDocuments(){this.wordLoaded=!1;const e=P();return Fe.documents(e.getProjectInfo.id,this.getCurrWord()).then(t=>{for(const r of t.results)for(let i of r.words){const s={};for(let a of i.word_annotation_score)s[a.annotation]=a;i.scores=s,delete i.word_annotation_score}this.currDocuments=t.results,this.wordLoaded=!0})}}});var me={list(e,t){const r=t!==void 0?`&q=${t}`:"";return D.get(`hilt/projects/${e}/dict/global/?page_size=10000`+r)},create(e,t){return D.post(`hilt/projects/${e}/dict/global/`,t)},update(e,t){return D.put(`hilt/projects/${e}/dict/global/${t.id}/`,t)},delete(e,t){return D.delete(`hilt/projects/${e}/dict/global/${t}/`)}};const _e=z({id:"dictionary_global",state:()=>({words:{},wordRows:[]}),getters:{getWords:e=>e.words,getRows:e=>e.wordRows,containsWord:e=>t=>t in e.words},actions:{fetchDictionary(e=void 0){const t=P();return me.list(t.getProjectInfo.id,e).then(r=>{const i=r.results,s={},a=[];for(let p of i)s[p.word]=a.length,a.push(p);this.words=s,this.wordRows=a})},addWord(e,t,r){const i=P();return me.create(i.getProjectInfo.id,{word:e,modification_type:t,ground_truth_label:r}).then(s=>{this.words[e]=this.wordRows.length,this.wordRows.push(s),console.log(`added global word ${e}`)})},deleteWord(e){console.log(`deleted global word ${e}`);const t=P();return me.delete(t.getProjectInfo.id,this.wordRows[this.words[e]].id).then(()=>this.fetchDictionary())}}});const bn={name:"GlobalSideBar",components:{Back:ie,Check:Se,Search:ye},setup(){const e=ee(),t=ue(),r=_e();return{labelStore:e,wordStore:t,globalDictionaryStore:r}},data(){return{searchQuery:""}},watch:{searchQuery:function(e,t){console.log(e),e===""?this.wordStore.resetState().then(()=>{this.wordStore.fetchDocuments()}):this.wordStore.resetState(e).then(()=>{this.wordStore.fetchDocuments()})}},created(){this.$route.query.q!==void 0&&(this.searchQuery=this.$route.query.q);const e=[];e.push(this.labelStore.fetchLabels()),e.push(this.globalDictionaryStore.fetchDictionary()),this.searchQuery===""?e.push(this.wordStore.resetState()):e.push(this.wordStore.resetState(this.searchQuery)),Promise.all(e).then(()=>{this.wordStore.fetchDocuments()})},methods:{tableRowStyle({row:e}){return this.globalDictionaryStore.containsWord(e.text)?this.globalDictionaryStore.getRows[this.globalDictionaryStore.getWords[e.text]].modification_type==0?{color:"white",backgroundColor:"#67C23A"}:{color:"white",backgroundColor:"#F56C6C"}:{}},pageChanged(e){this.wordStore.updateCurPage(e).then(()=>{this.wordStore.fetchDocuments()})},goToDocument(e){this.wordStore.setCurWordIndex(e),this.wordStore.fetchDocuments()}}},wn=e=>(J("data-v-5cdc2f13"),e=e(),H(),e),Dn=wn(()=>d("span",null,"Back",-1)),xn={style:{"align-content":"center"}},vn={key:0},kn={key:1};function In(e,t,r,i,s,a){const p=l("Back"),c=l("el-icon"),h=l("el-menu-item"),m=l("el-menu"),g=l("Search"),f=l("el-input"),k=l("Check"),y=l("el-table-column"),x=l("el-link"),I=l("el-table"),F=l("el-pagination"),S=l("el-col"),T=be("snip");return u(),b(S,null,{default:n(()=>[o(m,null,{default:n(()=>[o(h,{onClick:t[0]||(t[0]=()=>this.$router.push({name:"DebugOverview"}))},{default:n(()=>[o(c,null,{default:n(()=>[o(p)]),_:1}),Dn]),_:1})]),_:1}),o(f,{modelValue:s.searchQuery,"onUpdate:modelValue":t[1]||(t[1]=$=>s.searchQuery=$),placeholder:"Type to search for words",style:{"margin-top":"20px",width:"90%"},clearable:""},{prefix:n(()=>[d("div",xn,[o(c,null,{default:n(()=>[o(g)]),_:1})])]),_:1},8,["modelValue"]),o(I,{data:Array.from(i.wordStore.getWords),"row-style":a.tableRowStyle},{default:n(()=>[o(y,{width:"40"},{default:n($=>[i.globalDictionaryStore.containsWord($.row.text)?(u(),w("span",vn,[o(c,null,{default:n(()=>[o(k)]),_:1})])):(u(),w("div",kn,j(i.wordStore.getWordInfo.pageSize*(i.wordStore.getWordInfo.curPage-1)+$.$index+1),1))]),_:1}),o(y,{prop:"text"},{default:n($=>[we((u(),b(x,{key:$.row.text,onClick:v=>a.goToDocument($.$index)},{default:n(()=>[_(j($.row.text),1)]),_:2},1032,["onClick"])),[[T,{lines:3}]])]),_:1})]),_:1},8,["data","row-style"]),o(F,{background:"",layout:"prev, pager, next",total:i.wordStore.getWordInfo.totalWordCount,"page-size":i.wordStore.getWordInfo.pageSize,"current-page":i.wordStore.getWordInfo.curPage,onCurrentChange:a.pageChanged,style:{"text-align":"center"}},null,8,["total","page-size","current-page","onCurrentChange"])]),_:1})}var $n=L(bn,[["render",In],["__scopeId","data-v-5cdc2f13"]]);const Fn={name:"DebugPage",components:{OverviewSideBar:_n,LocalSideBar:Sn,GlobalSideBar:$n}};function Cn(e,t,r,i,s,a){const p=l("OverviewSideBar"),c=l("LocalSideBar"),h=l("GlobalSideBar"),m=l("el-aside"),g=l("router-view"),f=l("el-main"),k=l("el-container");return u(),w("div",null,[o(k,null,{default:n(()=>[o(m,{style:{"border-right":"solid 1px #e6e6e6"}},{default:n(()=>[this.$route.path.endsWith("/overview")||this.$route.path.endsWith("/dictionary")||this.$route.path.endsWith("/evaluation")?(u(),b(p,{key:0,style:{width:"100%"}})):A("",!0),this.$route.path.endsWith("/local")?(u(),b(c,{key:1,style:{width:"100%"}})):A("",!0),this.$route.path.endsWith("/global")?(u(),b(h,{key:2,style:{width:"100%"}})):A("",!0)]),_:1}),o(f,null,{default:n(()=>[o(g)]),_:1})]),_:1})])}var jn=L(Fn,[["render",Cn]]),he={train(e){return D.post(`hilt/projects/${e}/debug/training/`,{headers:B({},D.defaults.headers)})},didFinishGeneration(e){return D.get(`hilt/projects/${e}/update/training_debug_model_status/`)}};const Pn={name:"DebugOverview",components:{QuestionFilled:N},setup(){const e=P(),t=ne(),r=_e(),i=de(),s=ue();return{projectStore:e,documentStore:t,globalDictionaryStore:r,localDictionaryStore:i,wordStore:s}},created(){const e=[];e.push(this.globalDictionaryStore.fetchDictionary()),e.push(this.localDictionaryStore.fetchDictionary()),e.push(this.documentStore.fetchDocuments()),e.push(this.wordStore.resetState()),Promise.all(e).then(()=>{this.wordStore.fetchDocuments()})},methods:{getInstanceProgressBarLabel(){let e=this.documentStore.getdocumentInfo;return`${this.localDictionaryStore.getLocalInfo.annotatedDocCount} / ${e.totalDocCount} sentences annotated`},getTaskProgressBarLabel(){return`${this.globalDictionaryStore.getRows.length} / ${this.wordStore.getWordInfo.totalWordCount} words annotated`},fetchDebugScores(e){return Z.detailedDocument(this.projectStore.getProjectInfo.id,e).then(t=>{console.log(t),console.log(t.words);for(let r of t.words)console.log("word:",r.text),console.log("initial score:",r.word_annotation_score[0].score)})},trainDebugModel(){he.train(this.projectStore.getProjectInfo.id).then(e=>{console.log("Here"),console.log(e),this.waitForCompletion(),K({title:"Debug Training Started",message:"Page will automatically change once task is completed",type:"success",duration:0})}).catch(e=>{e.response&&e.response.data?this.$notify.error({title:"Model training failed",message:e.response.data}):this.$notify.error({title:"Model failed to start training",message:"Please try again later"})}),this.fetchDebugScores(this.documentStore.getDocuments[1].id)},waitForCompletion(){let e=60,t=setInterval(()=>he.didFinishGeneration(this.projectStore.getProjectInfo.id).then(r=>{console.log(r),e<0||r.status=="finished"?(console.log("finished"),this.$notify.success({title:"Success",message:"Model Execution had been completed",duration:0}),clearInterval(t),this.$router.push({name:"DebugEvaluation"})):(console.log("Waiting for model finish message."),e-=1,console.log(e))}),10*1e3)}},computed:{instanceAnnotationCompletionPercentage(){let e=this.documentStore.getdocumentInfo,t=this.localDictionaryStore.getLocalInfo;return e.totalDocCount==0?0:100*t.annotatedDocCount/e.totalDocCount},taskAnnotationCompletionPercentage(){let e=this.wordStore.getWordInfo;return e.totalWordCount==0?0:100*Array.from(this.globalDictionaryStore.getRows).length/e.totalWordCount}}},Ln=_(" Debug Overview Page "),Wn=_(" Start Debug Training "),An=_(),Mn=d("br",null,null,-1),Tn={style:{"padding-right":"1em"}},En=_("Instance Explanation "),Bn=_(" Start Annotating "),Vn={style:{"padding-right":"1em"}},Un=_("Task Explanation "),On=_(" Start Annotating ");function zn(e,t,r,i,s,a){const p=l("QuestionFilled"),c=l("el-icon"),h=l("el-popover"),m=l("el-button"),g=l("el-progress"),f=l("el-row");return u(),w(W,null,[d("h3",null,[Ln,o(h,{content:"Overview of Human Debugging Phase. Perform task and instance annotation to start debugging phase",trigger:"hover",width:400},{reference:n(()=>[o(c,{style:{height:"100%","margin-left":"0.5rem"}},{default:n(()=>[o(p)]),_:1})]),_:1})]),o(m,{type:"primary",onClick:t[0]||(t[0]=k=>a.trainDebugModel())},{default:n(()=>[Wn]),_:1}),An,Mn,o(f,{style:{width:"100%","margin-top":"3em"}},{default:n(()=>[d("span",Tn,[En,o(h,{content:"Select words to debug for each instance",trigger:"hover",width:400},{reference:n(()=>[o(c,{style:{height:"100%","margin-left":"0.5rem"}},{default:n(()=>[o(p)]),_:1})]),_:1})]),o(m,{size:"small",onClick:t[1]||(t[1]=()=>this.$router.push({name:"DebugLocal"}))},{default:n(()=>[Bn]),_:1}),o(g,{style:{width:"100%","margin-top":"1em"},percentage:a.instanceAnnotationCompletionPercentage,format:a.getInstanceProgressBarLabel,type:"line","stroke-width":30,"text-inside":""},null,8,["percentage","format"])]),_:1}),o(f,{style:{width:"100%","margin-top":"3em"}},{default:n(()=>[d("span",Vn,[Un,o(h,{content:"Select words to debug for all instances",trigger:"hover",width:400},{reference:n(()=>[o(c,{style:{height:"100%","margin-left":"0.5rem"}},{default:n(()=>[o(p)]),_:1})]),_:1})]),o(m,{size:"small",onClick:t[2]||(t[2]=()=>this.$router.push({name:"DebugGlobal"}))},{default:n(()=>[On]),_:1}),o(g,{style:{width:"100%","margin-top":"1em"},percentage:a.taskAnnotationCompletionPercentage,format:a.getTaskProgressBarLabel,type:"line","stroke-width":30,"text-inside":""},null,8,["percentage","format"])]),_:1})],64)}var Nn=L(Pn,[["render",zn]]);const Qn={name:"LocalExplanations",components:{ArrowLeft:We,ArrowRight:Ae,Delete:se,QuestionFilled:N},setup(){const e=ne(),t=xe(),r=P(),i=de(),s=ee();return{documentStore:e,detailedDocumentStore:t,projectStore:r,localDictionaryStore:i,labelStore:s,TaskTypes:U,getLabelByID:s.getLabelByID}},data(){return{topK:3}},methods:{wordDelete(e){console.log("vue delete word"),this.localDictionaryStore.deleteWord(e).then(this.updateAnnotation())},wordClick(e,t,r){const i=this.detailedDocumentStore.getDocument.id,s=this.localDictionaryStore.fetchIfExists(i,t,e);s===null?r>=0&&this.localDictionaryStore.addWord(i,{word:t,annotation:e,modification_type:r}).then(()=>this.updateAnnotation()):r==-1&&this.wordDelete(s.id)},getWordStyle(e,t){const r={padding:"3px 3px 3px 3px",margin:"3px 3px 3px 3px",fontSize:"18px"};if(this.topK>0&&e.order>=this.topK)return r;const i=e.score,s=G[1].colors;let a=-1;return i<=.1?r:(i<=.5?a=0:i<=.75?a=1:i<=1&&(a=2),B(B({},r),s[a]))},getProgressBarLabel(){let e=this.documentStore.getdocumentInfo;return`${e.annotatedDocCount} / ${e.totalDocCount} documents annotated`},goToPrevDoc(){this.updateAnnotation();const e=this.documentStore.getdocumentInfo.curDocIndex-1;e==-1?this.documentStore.updateCurPage(this.documentStore.getdocumentInfo.curPage-1).then(()=>{this.documentStore.setCurDocIndex(this.documentStore.getDocuments.length-1),this.detailedDocumentStore.fetchDocument(this.documentStore.getDocuments[this.documentStore.getDocuments.length-1].id)}):(this.documentStore.setCurDocIndex(e),this.detailedDocumentStore.fetchDocument(this.documentStore.getDocuments[e].id))},goToNextDoc(){this.updateAnnotation();const e=this.documentStore.getdocumentInfo.curDocIndex+1;this.documentStore.getDocuments.length==e?this.documentStore.updateCurPage(this.documentStore.getdocumentInfo.curPage+1).then(()=>{this.detailedDocumentStore.fetchDocument(this.documentStore.getDocuments[0].id),this.localDictionaryStore.fetchDictionary(this.documentStore.getDocuments[0].id)}):(this.documentStore.setCurDocIndex(e),this.detailedDocumentStore.fetchDocument(this.documentStore.getDocuments[e].id),this.localDictionaryStore.fetchDictionary(this.documentStore.getDocuments[e].id))},noAnnotation(){this.documentStore.markAnnotated().then(()=>{const e=this.documentStore.getdocumentInfo.curDocIndex+1;this.documentStore.getDocuments.length!==e&&this.documentStore.getdocumentInfo.curPage!==this.documentStore.getdocumentInfo.maxPage&&this.goToNextDoc()})},updateAnnotation(){const e=this.detailedDocumentStore.getDocument.id;this.localDictionaryStore.getByDocumentID(e)!==void 0?(console.log("Marking Annotated"),this.documentStore.markAnnotated(!0)):(console.log("Unmarking Annotated"),this.documentStore.markAnnotated(!1))},trainDebugModel(){he.train(this.projectStore.getProjectInfo.id)}},computed:{annotationCompletionPercentage:function(){let e=this.documentStore.getdocumentInfo;return e.totalDocCount==0?0:100*e.annotatedDocCount/e.totalDocCount},dictTableData:function(){const e=this.detailedDocumentStore.getDocument.id,t=this.localDictionaryStore.getByDocumentID(e),r=[];if(e===void 0||t===void 0)return r;const i=this.detailedDocumentStore.getDocument.words;for(const s of i){const a=s.id;if(!(a in t))continue;const p=t[a];for(const c in p){const h=p[c].id,m=s.scores[c].score;let g;for(const f of this.detailedDocumentStore.getDocument.annotations)if(f.id==c){g=f.label;break}r.push({id:h,word:s.text,score:{score:m,order:0},label:g,type:p[c].modification_type})}}return r}}},Rn={style:{display:"flex","align-items":"center","justify-content":"space-between"}},Gn={style:{"text-align":"center"}},qn=_(" Annotate page (Instance Explanation) "),Jn={style:{width:"100%"}},Hn={key:0,class:"demonstration"},Kn={key:1,class:"demonstration"},Zn=_("Words"),Xn={style:{"font-size":"18px"}},Yn=_("Model Output"),el={style:{"text-align":"right",margin:"0"}},tl=_(" add "),ol=_(" remove "),nl=_(" reset "),ll=_("Add"),rl=_("Remove"),sl=_("Delete"),il=_(" Prev "),al=_(" Next "),cl=_(" Skip (Nothing to Mark Up)"),dl=_(" Submit ");function ul(e,t,r,i,s,a){const p=l("QuestionFilled"),c=l("el-icon"),h=l("el-popover"),m=l("el-row"),g=l("el-slider"),f=l("el-tag"),k=l("el-divider"),y=l("el-button"),x=l("el-col"),I=l("el-table-column"),F=l("Delete"),S=l("el-popconfirm"),T=l("el-table"),$=l("el-card"),v=l("ArrowLeft"),Q=l("ArrowRight");return u(),w(W,null,[o(m,{style:{width:"100%"}},{default:n(()=>[o(m,{style:{width:"100%"}},{default:n(()=>[d("div",Rn,[d("h1",Gn,[qn,o(h,{content:"Attribution scores refer to how much the word positively correlates to the ground truth label.",trigger:"hover",width:400},{reference:n(()=>[o(c,{style:{height:"100%","margin-left":"0.5rem"}},{default:n(()=>[o(p)]),_:1})]),_:1})])])]),_:1}),o(m,{style:{width:"100%"}},{default:n(()=>[d("div",Jn,[s.topK>0?(u(),w("span",Hn,"Top "+j(s.topK)+" words",1)):A("",!0),s.topK==0?(u(),w("span",Kn,"All words")):A("",!0),o(g,{modelValue:s.topK,"onUpdate:modelValue":t[0]||(t[0]=C=>s.topK=C),max:this.detailedDocumentStore.getMaxWords},null,8,["modelValue","max"])])]),_:1}),this.detailedDocumentStore.getDocument?(u(),b($,{key:0,style:{width:"100%","margin-top":"10px"}},{default:n(()=>[o(m,null,{default:n(()=>[o(x,{span:16},{default:n(()=>[o(m,null,{default:n(()=>[o(f,null,{default:n(()=>[Zn]),_:1}),"ground_truth"in this.detailedDocumentStore.getDocument?(u(),b(f,{key:0,style:{"margin-left":"10px"}},{default:n(()=>[_(" Ground truth: "+j(i.getLabelByID(this.detailedDocumentStore.getDocument.ground_truth).text),1)]),_:1})):A("",!0)]),_:1}),o(m,{style:{"line-height":"2","margin-top":"10px"}},{default:n(()=>[d("span",Xn,j(this.detailedDocumentStore.getDocument.text),1)]),_:1}),o(k),(u(!0),w(W,null,E(this.detailedDocumentStore.getDocument.annotations,C=>(u(),b(m,{style:{"margin-top":"10px"},key:C.id},{default:n(()=>[o(m,{style:{width:"100%"}},{default:n(()=>[o(f,{style:{"margin-right":"10px"}},{default:n(()=>[Yn]),_:1}),o(f,null,{default:n(()=>[_("Label: "+j(i.getLabelByID(C.label).text),1)]),_:2},1024),o(h,{content:"If you think positively correlated words (red-colored) should not be correlated to the ground truth label prediction, delete those words! If you think weakly correlated words should be correlated to the ground truth label, add those words!",trigger:"hover",width:400},{reference:n(()=>[o(c,{style:{height:"100%","margin-left":"0.5rem"}},{default:n(()=>[o(p)]),_:1})]),_:1})]),_:2},1024),o(m,{style:{"line-height":"2","margin-top":"10px"}},{default:n(()=>[(u(!0),w(W,null,E(this.detailedDocumentStore.getDocument.words,M=>(u(),w("span",{key:M.id,style:O(a.getWordStyle(M.scores[C.id],C.label))},[o(h,{trigger:"hover",width:"200px"},{reference:n(()=>[d("span",null,j(M.text),1)]),default:n(()=>[d("p",null,j(M.text+": "+M.scores[C.id].score),1),d("div",el,[o(y,{size:"small",type:"success",onClick:ve=>a.wordClick(C.id,M.id,0)},{default:n(()=>[tl]),_:2},1032,["onClick"]),o(y,{size:"small",type:"primary",onClick:ve=>a.wordClick(C.id,M.id,1)},{default:n(()=>[ol]),_:2},1032,["onClick"]),o(y,{size:"small",type:"info",onClick:ve=>a.wordClick(C.id,M.id,-1)},{default:n(()=>[nl]),_:2},1032,["onClick"])])]),_:2},1024)],4))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1}),o(x,{span:8},{default:n(()=>[o(T,{data:a.dictTableData,border:"",style:{width:"100%"}},{default:n(()=>[o(I,{label:"Word"},{default:n(C=>[d("span",{style:O(a.getWordStyle(C.row.score,C.row.label))},j(C.row.word),5)]),_:1}),o(I,{label:"Type"},{default:n(C=>[C.row.type==0?(u(),b(f,{key:0,type:"success"},{default:n(()=>[ll]),_:1})):A("",!0),C.row.type==1?(u(),b(f,{key:1,type:"danger"},{default:n(()=>[rl]),_:1})):A("",!0)]),_:1}),o(I,{label:"Operations"},{default:n(C=>[o(S,{title:"Are you sure?",onConfirm:M=>a.wordDelete(C.row.id),style:{"margin-left":"10px"}},{reference:n(()=>[o(y,{size:"small",type:"danger"},{default:n(()=>[o(c,null,{default:n(()=>[o(F)]),_:1}),sl]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1})]),_:1})):A("",!0),o(m,{style:{"margin-top":"20px",width:"100%"}},{default:n(()=>[o(x,{style:{display:"flex","justify-content":"space-between"}},{default:n(()=>[o(y,{type:"primary",onClick:t[1]||(t[1]=C=>a.goToPrevDoc()),disabled:this.documentStore.getdocumentInfo.curDocIndex===0&&this.documentStore.getdocumentInfo.curPage===1},{default:n(()=>[o(c,null,{default:n(()=>[o(v)]),_:1}),il]),_:1},8,["disabled"]),o(y,{type:"primary",onClick:t[2]||(t[2]=C=>a.goToNextDoc()),disabled:this.documentStore.getdocumentInfo.curDocIndex===this.documentStore.getdocumentInfo.documents.length-1&&this.documentStore.getdocumentInfo.curPage===this.documentStore.getdocumentInfo.maxPage},{default:n(()=>[al,o(c,null,{default:n(()=>[o(Q)]),_:1})]),_:1},8,["disabled"])]),_:1})]),_:1}),this.detailedDocumentStore.getDocument?(u(),b(m,{key:1,style:{"margin-top":"10px",width:"100%"}},{default:n(()=>[o(x,{style:{display:"flex","justify-content":"flex-end"}},{default:n(()=>[o(y,{type:"primary",onClick:a.noAnnotation},{default:n(()=>[cl,o(c,null,{default:n(()=>[o(Q)]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1})):A("",!0)]),_:1}),o(m,null,{default:n(()=>[o(y,{type:"primary",onClick:t[3]||(t[3]=C=>a.trainDebugModel())},{default:n(()=>[dl]),_:1})]),_:1})],64)}var _l=L(Qn,[["render",ul]]);const pl={name:"GlobalExplanations",components:{ArrowLeft:We,ArrowRight:Ae,QuestionFilled:N},setup(){const e=ee(),t=ue(),r=_e(),i=P();return{labelStore:e,wordStore:t,globalDictionaryStore:r,projectStore:i,TaskTypes:U,getLabelByID:e.getLabelByID}},computed:{documents:function(){return this.wordStore.getDocuments}},methods:{addWord(e){this.globalDictionaryStore.addWord(this.wordStore.getCurrWord(),e,this.getLabelByID(this.documents[0].ground_truth).id)},getWordStyle(e,t){const r={padding:"3px 3px 3px 3px",margin:"3px 3px 3px 3px",fontSize:"18px"},i=e.score,s=G[1].colors;let a=-1;return i<=.1?r:(i<=.5?a=0:i<=.75?a=1:i<=1&&(a=2),B(B({},r),s[a]))},goToPrevWord(){const e=this.wordStore.getWordInfo.curWordIndex-1;e==-1?this.wordStore.updateCurPage(this.wordStore.getWordInfo.curPage-1).then(()=>{this.wordStore.setCurWordIndex(this.wordStore.getWords.length-1),this.wordStore.fetchDocuments()}):(this.wordStore.setCurWordIndex(e),this.wordStore.fetchDocuments())},goToNextWord(){const e=this.wordStore.getWordInfo.curWordIndex+1;this.wordStore.getWords.length==e?this.wordStore.updateCurPage(this.wordStore.getWordInfo.curPage+1).then(()=>{this.wordStore.fetchDocuments()}):(this.wordStore.setCurWordIndex(e),this.wordStore.fetchDocuments())}}},ml={style:{display:"flex","align-items":"center","justify-content":"space-between"}},hl={style:{"text-align":"center"}},fl=_(" Annotate page (Task Explanation) "),gl=_(" Prev "),yl=_(" Next "),Sl=_(" Current Word: "),bl={style:{"margin-left":"10px",display:"inline-block"}},wl=_(" add "),Dl=_(" remove "),xl=_(" reset ");function vl(e,t,r,i,s,a){const p=l("QuestionFilled"),c=l("el-icon"),h=l("el-popover"),m=l("el-row"),g=l("ArrowLeft"),f=l("el-button"),k=l("ArrowRight"),y=l("el-col"),x=l("el-tag"),I=l("el-divider"),F=l("el-card");return u(),b(m,{style:{width:"100%"}},{default:n(()=>[o(m,{style:{width:"100%"}},{default:n(()=>[d("div",ml,[d("h1",hl,[fl,o(h,{content:"Attribution scores refer to how much the word positively correlates to the ground truth label.",trigger:"hover",width:400},{reference:n(()=>[o(c,{style:{height:"100%","margin-left":"0.5rem"}},{default:n(()=>[o(p)]),_:1})]),_:1})])])]),_:1}),i.wordStore.getCurrWord()!==void 0?(u(),b(m,{key:0,style:{"margin-top":"20px",width:"100%"}},{default:n(()=>[o(y,{style:{display:"flex","justify-content":"space-between"}},{default:n(()=>[o(f,{type:"primary",onClick:t[0]||(t[0]=S=>a.goToPrevWord()),disabled:this.wordStore.getWordInfo.curWordIndex===0&&this.wordStore.getWordInfo.curPage===1},{default:n(()=>[o(c,null,{default:n(()=>[o(g)]),_:1}),gl]),_:1},8,["disabled"]),o(f,{type:"primary",onClick:t[1]||(t[1]=S=>a.goToNextWord()),disabled:this.wordStore.getWordInfo.curWordIndex===this.wordStore.getWordInfo.words.length-1&&this.wordStore.getWordInfo.curPage===this.wordStore.getWordInfo.maxPage},{default:n(()=>[yl,o(c,null,{default:n(()=>[o(k)]),_:1})]),_:1},8,["disabled"])]),_:1})]),_:1})):A("",!0),i.wordStore.wordLoaded?(u(),b(F,{key:1,style:{width:"100%","margin-top":"10px"}},{header:n(()=>[d("div",null,[Sl,d("b",null,j(this.wordStore.getCurrWord()),1),d("div",bl,[i.globalDictionaryStore.containsWord(i.wordStore.getCurrWord())?A("",!0):(u(),b(f,{key:0,size:"small",type:"success",onClick:t[2]||(t[2]=S=>a.addWord(0))},{default:n(()=>[wl]),_:1})),i.globalDictionaryStore.containsWord(i.wordStore.getCurrWord())?A("",!0):(u(),b(f,{key:1,size:"small",type:"primary",onClick:t[3]||(t[3]=S=>a.addWord(1))},{default:n(()=>[Dl]),_:1})),i.globalDictionaryStore.containsWord(i.wordStore.getCurrWord())?(u(),b(f,{key:2,size:"small",type:"info",onClick:t[4]||(t[4]=S=>i.globalDictionaryStore.deleteWord(i.wordStore.getCurrWord()))},{default:n(()=>[xl]),_:1})):A("",!0),o(h,{content:"If you think positively correlated words (red-colored) should not be correlated to the ground truth label prediction, delete those words! If you think weakly correlated words should be correlated to the ground truth label, add those words!",trigger:"hover",width:400},{reference:n(()=>[o(c,{style:{height:"100%","margin-left":"0.5rem"}},{default:n(()=>[o(p)]),_:1})]),_:1})])])]),default:n(()=>[(u(!0),w(W,null,E(a.documents,(S,T)=>(u(),b(m,{style:{width:"100%"},key:S.id},{default:n(()=>[(u(!0),w(W,null,E(S.annotations,$=>(u(),b(m,{style:{width:"100%"},key:$.id},{default:n(()=>[o(m,{style:{width:"100%"}},{default:n(()=>[o(x,null,{default:n(()=>[_("Document #"+j(T+1),1)]),_:2},1024),"ground_truth"in S?(u(),b(x,{key:0,style:{"margin-left":"10px"}},{default:n(()=>[_(" Ground truth: "+j(i.getLabelByID(S.ground_truth).text),1)]),_:2},1024)):A("",!0),o(x,{style:{"margin-left":"10px"}},{default:n(()=>[_(" Prediction: "+j(i.getLabelByID($.label).text),1)]),_:2},1024)]),_:2},1024),o(m,{style:{"line-height":"2","margin-top":"10px"}},{default:n(()=>[d("div",null,[(u(!0),w(W,null,E(S.words,v=>(u(),w("span",{key:v.id,style:O(a.getWordStyle(v.scores[$.id],$.label))},[o(h,{content:v.text+": "+v.scores[$.id].score,trigger:"hover"},{reference:n(()=>[d("span",{style:O(v.text===this.wordStore.getCurrWord()?{border:"2px solid black"}:{})},j(v.text),5)]),_:2},1032,["content"])],4))),128))])]),_:2},1024)]),_:2},1024))),128)),o(I)]),_:2},1024))),128))]),_:1})):A("",!0)]),_:1})}var kl=L(pl,[["render",vl]]);const Il={name:"DictionaryOverview",components:{Search:ye,Delete:se},setup(){return{dictionaryStore:_e()}},data(){return{searchQuery:""}},watch:{searchQuery:function(e,t){this.dictionaryStore.fetchDictionary(e)}},methods:{indexMethod(e){return e+1},onClick(e,t){this.$router.push({name:"DebugGlobal",query:{q:t.word}})},handleDelete(e,t){this.dictionaryStore.deleteWord(t.word).then(()=>{this.dictionaryStore.fetchDictionary()})}},created(){this.dictionaryStore.fetchDictionary()}},$l={style:{"text-align":"center"}},Fl=d("div",null,[d("h1",null,"Task Dictionary")],-1),Cl={style:{"align-content":"center"}},jl=["onClick"],Pl=_("Delete");function Ll(e,t,r,i,s,a){const p=l("Search"),c=l("el-icon"),h=l("el-input"),m=l("el-table-column"),g=l("Delete"),f=l("el-button"),k=l("el-popconfirm"),y=l("el-table");return u(),w("div",null,[d("div",$l,[Fl,o(h,{modelValue:s.searchQuery,"onUpdate:modelValue":t[0]||(t[0]=x=>s.searchQuery=x),modelModifiers:{lazy:!0,trim:!0},placeholder:"Type to search for words",style:{width:"50%"},clearable:""},{prefix:n(()=>[d("div",Cl,[o(c,null,{default:n(()=>[o(p)]),_:1})])]),_:1},8,["modelValue"])]),o(y,{data:Array.from(i.dictionaryStore.getRows),stripe:""},{default:n(()=>[o(m,{type:"index",index:a.indexMethod},null,8,["index"]),o(m,{label:"Text",sortable:""},{default:n(x=>[d("p",{onClick:I=>a.onClick(x.$index,x.row),style:{cursor:"pointer"}},j(x.row.word),9,jl)]),_:1}),o(m,{label:"Operations"},{default:n(x=>[o(k,{title:"Are you sure?",onConfirm:I=>a.handleDelete(x.$index,x.row),style:{"margin-left":"10px"}},{reference:n(()=>[o(f,{size:"small",type:"danger"},{default:n(()=>[o(c,null,{default:n(()=>[o(g)]),_:1}),Pl]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])])}var Wl=L(Il,[["render",Ll]]);const Al={name:"DebugEvaluation",components:{Back:ie,Check:Se,Download:ge},setup(){const e=ne(),t=xe(),r=ee(),i=de(),s=P(),a=ue();return{documentStore:e,detailedDocumentStore:t,labelStore:r,localDictionaryStore:i,projectStore:s,wordStore:a,getLabelByID:r.getLabelByID}},created(){const e=[];e.push(this.labelStore.fetchLabels()),e.push(this.documentStore.resetState().then(()=>this.localDictionaryStore.fetchDictionary(this.documentStore.getDocuments[this.documentStore.getdocumentInfo.curDocIndex].id))),Promise.all(e).then(()=>{this.detailedDocumentStore.fetchDocument(this.documentStore.getDocuments[this.documentStore.getdocumentInfo.curDocIndex].id)}),this.getModelDetails()},data(){return{exampleInputsForm:{sentence_id:""},downloading:!1,model:{model_id:"",model_name:""},detailedSentence:[],debugTrainingSentence:[],loadingAnnotations:!1}},computed:{getDocText(){return console.log("calling getDocTest"),console.log(this.exampleInputsForm.sentence_id),this.detailedSentence},documents:function(){return console.log("inside documents function"),console.log(this.detailedSentence),this.detailedSentence},disableDownload(){return this.model.model_id}},methods:{updateDetailedDoc(e){this.loadingAnnotations=!0;const t=[];t.push(this.detailedDocumentStore.fetchDocument(e)),Promise.all(t).then(()=>{this.detailedSentence=[this.detailedDocumentStore.getDocument],this.calculateAttrsForDoc(this.detailedSentence[0].text,this.getLabelByID(this.detailedSentence[0].ground_truth).text).then(r=>{this.debugTrainingSentence=JSON.parse(r).res,console.log(JSON.parse(r).res),this.loadingAnnotations=!1}).catch(r=>{console.log(r),this.loadingAnnotations=!1})})},getModelDetails(){X.list(this.projectStore.getProjectInfo.id).then(e=>{console.log(e.results.at(-1));const t=e.results.at(-1);this.model.model_id=t.id,this.model.model_name=t.name})},modelDownload(){this.downloading=!0,X.downloadModel(this.projectStore.getProjectInfo.id,this.model.model_id).then(e=>{console.log(e.length);const t=new Blob([e],{type:"application/zip"});Xe.exports.saveAs(t,"test.zip"),this.downloading=!1}).catch(e=>{console.log(e),this.downloading=!1})},str2bytes(e){for(var t=new Uint8Array(e.length),r=0;r<e.length;r++)t[r]=e.charCodeAt(r);return t},getWordStyle(e=0,t){const r={padding:"3px 3px 3px 3px",margin:"3px 3px 3px 3px",fontSize:"18px"},i=e.score,s=G[1].colors;let a=-1;return i<=.1?r:(i<=.5?a=0:i<=.75?a=1:i<=1&&(a=2),B(B({},r),s[a]))},calculateAttrsForDoc(e,t){return le.getAttributeScoresForDoc(this.projectStore.getProjectInfo.id,e,t,this.model.model_id).then(r=>(console.log(r),r.res))}}},Ml=_("Evaluation Section "),Tl={style:{"padding-right":"1em"}},El=_("Model Selected: "),Bl=d("h4",null,"Example Input",-1),Vl=_("Before Debugging"),Ul=_("After Debug Training"),Ol=d("span",null,"\xA0",-1);function zl(e,t,r,i,s,a){const p=l("QuestionFilled"),c=l("el-icon"),h=l("el-popover"),m=l("Download"),g=l("el-button"),f=l("el-divider"),k=l("el-option"),y=l("el-select"),x=l("el-form-item"),I=l("el-form"),F=l("el-tag"),S=l("el-row"),T=l("el-card"),$=be("loading");return u(),b(S,{style:{width:"100%"}},{default:n(()=>[o(T,{style:{width:"100%"}},{header:n(()=>[d("h3",null,[Ml,o(h,{content:"help text",trigger:"hover",width:400},{reference:n(()=>[o(c,{style:{height:"100%","margin-left":"0.5rem"}},{default:n(()=>[o(p)]),_:1})]),_:1})])]),default:n(()=>[o(S,null,{default:n(()=>[d("span",Tl,[El,d("b",null,j(s.model.model_name),1)]),o(g,{type:"primary",size:"small",disabled:this.disableDownload,loading:s.downloading,onClick:t[0]||(t[0]=v=>this.modelDownload())},{default:n(()=>[o(c,null,{default:n(()=>[o(m)]),_:1})]),_:1},8,["disabled","loading"]),o(f),Bl,o(I,{model:s.exampleInputsForm,size:"large",style:{width:"100%"}},{default:n(()=>[o(x,null,{default:n(()=>[o(y,{modelValue:s.exampleInputsForm.sentence_id,"onUpdate:modelValue":t[1]||(t[1]=v=>s.exampleInputsForm.sentence_id=v),placeholder:"Select a Sentence",size:"large",onChange:a.updateDetailedDoc,style:{width:"100%"}},{default:n(()=>[(u(!0),w(W,null,E(i.documentStore.getDocuments,v=>(u(),b(k,{key:v.id,label:v.text,value:v.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1})]),_:1},8,["model"]),(u(!0),w(W,null,E(s.detailedSentence,(v,Q)=>(u(),b(S,{style:{width:"100%"},key:v.id},{default:n(()=>[(u(!0),w(W,null,E(v.annotations,C=>(u(),b(S,{style:{width:"100%"},key:C.id},{default:n(()=>[o(S,{style:{width:"100%"}},{default:n(()=>[o(F,null,{default:n(()=>[_("Document #"+j(Q+1),1)]),_:2},1024),"ground_truth"in v?(u(),b(F,{key:0,style:{"margin-left":"10px"}},{default:n(()=>[_(" Ground truth: "+j(i.getLabelByID(v.ground_truth).text),1)]),_:2},1024)):A("",!0)]),_:2},1024),o(S,{style:{width:"100%","margin-top":"10px"}},{default:n(()=>[o(F,{type:"warning"},{default:n(()=>[Vl]),_:1})]),_:1}),o(S,{style:{"line-height":"2","margin-top":"10px"}},{default:n(()=>[(u(!0),w(W,null,E(v.words,M=>(u(),w("span",{key:M.id,style:O(a.getWordStyle(M.scores[C.id],C.label))},[o(h,{content:M.text+": "+M.scores[C.id].score,trigger:"hover"},{reference:n(()=>[d("span",null,j(M.text),1)]),_:2},1032,["content"])],4))),128))]),_:2},1024)]),_:2},1024))),128)),o(f)]),_:2},1024))),128)),(u(!0),w(W,null,E(s.detailedSentence,(v,Q)=>(u(),b(S,{style:{width:"100%"},key:v.id},{default:n(()=>[(u(!0),w(W,null,E(v.annotations,C=>(u(),b(S,{style:{width:"100%"},key:C.id},{default:n(()=>[o(S,{style:{width:"100%"}},{default:n(()=>[o(F,{type:"warning"},{default:n(()=>[Ul]),_:1})]),_:1}),s.model.model_id?we((u(),b(S,{key:0,style:{"line-height":"2","margin-top":"10px"}},{default:n(()=>[(u(!0),w(W,null,E(s.debugTrainingSentence,M=>(u(),w("span",{style:O(a.getWordStyle({score:M.score},C.label))},[o(h,{content:M.text+": "+M.score,trigger:"hover"},{reference:n(()=>[d("span",null,j(M.text),1)]),_:2},1032,["content"])],4))),256)),Ol]),_:2},1024)),[[$,s.loadingAnnotations]]):A("",!0)]),_:2},1024))),128)),o(f)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})}var Nl=L(Al,[["render",zl]]),re={updateToken(e){D.defaults.headers.Authorization=`Bearer ${e}`},login(e,t,r=!1){const i=q();return D.post("token/",{username:e,password:t,rememberMe:r}).then(s=>(s.token=s.access,delete s.access,i.login(R(B({},s),{username:e})),s))},refreshToken(){const e=q();return D.post("token/refresh/",{token:e.token}).then(t=>{e.updateToken(t.token)})}};const Ql={name:"LoginPage",components:{UserFilled:Ye,Lock:et},data(){return{loginForm:{username:"",password:"",rememberMe:!1},rules:{username:[{required:!0,message:"Please input username",trigger:"blur"}],password:[{required:!0,message:"Please input password",trigger:"blur"}]},isLoading:!1,isValid:!1,showLoginFailed:"none"}},methods:{login(){this.$refs.loginForm.validate(e=>{if(e)this.isLoading=!0,this.showLoginFailed="none",re.login(this.loginForm.username,this.loginForm.password,this.loginForm.rememberMe).catch(()=>{this.isLoading=!1,this.showLoginFailed=""});else return!1})}}},Rl=e=>(J("data-v-7ff5fcd0"),e=e(),H(),e),Gl={style:{display:"flex","justify-content":"center"}},ql={style:{"align-content":"center"}},Jl={style:{"align-content":"center"}},Hl=_(" Login "),Kl=Rl(()=>d("div",{style:{display:"flex","justify-content":"center"}},[d("p",null,"test ID: test / password: test")],-1));function Zl(e,t,r,i,s,a){const p=l("el-alert"),c=l("UserFilled"),h=l("el-icon"),m=l("el-input"),g=l("el-form-item"),f=l("Lock"),k=l("el-checkbox"),y=l("el-button"),x=l("el-form"),I=l("el-col"),F=be("loading");return u(),w(W,null,[d("div",Gl,[we((u(),b(I,{span:6,style:{"margin-top":"2em"}},{default:n(()=>[o(p,{title:"Invalid username/password",type:"error","show-icon":"",style:O({display:s.showLoginFailed})},null,8,["style"]),o(x,{model:s.loginForm,rules:s.rules,ref:"loginForm"},{default:n(()=>[o(g,{label:"Username",prop:"username",class:"bold-label"},{default:n(()=>[o(m,{modelValue:s.loginForm.username,"onUpdate:modelValue":t[0]||(t[0]=S=>s.loginForm.username=S)},{prefix:n(()=>[d("div",ql,[o(h,null,{default:n(()=>[o(c)]),_:1})])]),_:1},8,["modelValue"])]),_:1}),o(g,{label:"Password",prop:"password",class:"bold-label"},{default:n(()=>[o(m,{type:"password",modelValue:s.loginForm.password,"onUpdate:modelValue":t[1]||(t[1]=S=>s.loginForm.password=S)},{prefix:n(()=>[d("div",Jl,[o(h,null,{default:n(()=>[o(f)]),_:1})])]),_:1},8,["modelValue"])]),_:1}),o(g,null,{default:n(()=>[o(k,{label:"Remember me",modelValue:s.loginForm.rememberMe,"onUpdate:modelValue":t[2]||(t[2]=S=>s.loginForm.rememberMe=S)},null,8,["modelValue"])]),_:1}),o(g,null,{default:n(()=>[o(y,{type:"primary",onClick:a.login,disabled:this.isValid,style:{width:"100%"}},{default:n(()=>[Hl]),_:1},8,["onClick","disabled"])]),_:1})]),_:1},8,["model","rules"])]),_:1})),[[F,s.isLoading]])]),Kl],64)}var Xl=L(Ql,[["render",Zl],["__scopeId","data-v-7ff5fcd0"]]);const Yl={name:"LogoutPage",setup(){return{userStore:q()}},created(){this.userStore.logout()}};function er(e,t,r,i,s,a){return u(),w("div")}var tr=L(Yl,[["render",er]]);const oe=tt({history:ot("/"),routes:[{path:"/",name:"Home",component:ht},{path:"/projects",name:"Projects",component:Ft},{path:"/login",name:"Login",component:Xl},{path:"/logout",component:tr},{path:"/project/",component:Ot,children:[{path:"doc/",component:Qt,children:[{path:"upload",name:"DocumentUpload",component:Co},{path:"list",name:"DocumentList",component:Zt},{path:"model",name:"ModelUpload",component:Uo}]},{path:"labels",name:"Labels",component:Jo},{path:"generate-explanations",name:"GenerateExplanations",component:en},{path:"export",name:"ExportData",component:rn}]},{path:"/debug/",component:jn,children:[{path:"overview",name:"DebugOverview",component:Nn},{path:"dictionary",name:"DebugDictionary",component:Wl},{path:"local",name:"DebugLocal",component:_l},{path:"global",name:"DebugGlobal",component:kl},{path:"evaluation",name:"DebugEvaluation",component:Nl}]}]});oe.beforeEach((e,t,r)=>{!q().isLoggedIn&&e.name!=="Login"&&e.name!=="Home"?r("/login"):(e.name=="Login",r())});oe.afterEach(()=>{const e=q();e.isLoggedIn&&e.inspectToken()});const q=z({id:"user",presist:!0,state:()=>({userInfo:null}),getters:{username:e=>e.userInfo.username,token:e=>e.userInfo.token,isLoggedIn:e=>e.userInfo!==null},actions:{login(e){this.userInfo=e,re.updateToken(e.token),oe.push({name:"Projects"}).then(t=>t)},logout(){this.userInfo=null,oe.push("/").then(e=>e)},updateToken(e){this.userInfo.token=e,re.updateToken(e)},inspectToken(){const e=this.userInfo.token;if(e){const t=nt(e),r=t.exp,i=t.orig_iat;r<Date.now()/1e3?this.logout():r-Date.now()/1e3<1800&&Date.now()/1e3-i<628200&&re.refreshToken()}}}});var or="/assets/logo.4941f0a9.png";const nr={name:"NavBar",components:{},setup(){return{userStore:q(),Logo:or}},methods:{loginClicked(){this.userStore.isLoggedIn?this.$router.push("/login"):this.$router.push("/logout")}}},lr=_(" Projects ");function rr(e,t,r,i,s,a){const p=l("el-image"),c=l("el-menu-item"),h=l("el-button"),m=l("el-menu");return u(),b(m,{"default-active":e.$route.path,mode:"horizontal",router:!0},{default:n(()=>[o(c,{index:"/"},{default:n(()=>[o(p,{src:i.Logo,style:{width:"58px",height:"58px"}},null,8,["src"])]),_:1}),i.userStore.isLoggedIn?(u(),b(c,{key:0,index:"/projects"},{default:n(()=>[lr]),_:1})):A("",!0),o(c,{index:i.userStore.isLoggedIn?"/logout":"/login",class:"dock-right"},{default:n(()=>[o(h,{onClick:t[0]||(t[0]=g=>a.loginClicked(g)),jest:"logBtn"},{default:n(()=>[_(j(this.userStore.isLoggedIn?"Logout":"Login"),1)]),_:1})]),_:1},8,["index"])]),_:1},8,["default-active"])}var sr=L(nr,[["render",rr],["__scopeId","data-v-3fc15066"]]);const ir={components:{NavBar:sr}},ar={id:"app"};function cr(e,t,r,i,s,a){const p=l("NavBar"),c=l("router-view");return u(),w("div",ar,[o(p,{style:{width:"100%"}}),o(c)])}var dr=L(ir,[["render",cr]]);const te=lt(dr);te.use(rt);te.provide("$api",D);te.use(st,{locale:it});const Me=at();Me.use(ct);te.use(Me);te.use(oe);te.mount("#app");
