var Ae=Object.defineProperty,Te=Object.defineProperties;var Be=Object.getOwnPropertyDescriptors;var De=Object.getOwnPropertySymbols;var Ee=Object.prototype.hasOwnProperty,Ve=Object.prototype.propertyIsEnumerable;var we=(e,t,s)=>t in e?Ae(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,E=(e,t)=>{for(var s in t||(t={}))Ee.call(t,s)&&we(e,s,t[s]);if(De)for(var s of De(t))Ve.call(t,s)&&we(e,s,t[s]);return e},q=(e,t)=>Te(e,Be(t));import{o as c,c as x,F as L,a as u,b as Ie,E as J,d as z,r as l,e as S,w as n,f as o,g as B,h as p,i as $e,_ as se,D as Ue,t as j,j as Oe,u as fe,m as ze,s as Ne,k as ge,l as Ce,n as Fe,p as R,q as G,v as ye,x as X,y as ie,z as ae,A,B as Qe,C as Re,G as O,H as Ge,I as ce,J as qe,K as Je,L as He,M as Ke,N as Se,O as je,P as Pe,Q as Ze,R as Xe,S as Ye,T as et,U as tt,V as ot,W as nt,X as lt,Y as rt,Z as st,$ as it}from"./vendor.2b525e03.js";const at=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))i(r);new MutationObserver(r=>{for(const a of r)if(a.type==="childList")for(const d of a.addedNodes)d.tagName==="LINK"&&d.rel==="modulepreload"&&i(d)}).observe(document,{childList:!0,subtree:!0});function s(r){const a={};return r.integrity&&(a.integrity=r.integrity),r.referrerpolicy&&(a.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?a.credentials="include":r.crossorigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function i(r){if(r.ep)return;r.ep=!0;const a=s(r);fetch(r.href,a)}};at();var M=(e,t)=>{const s=e.__vccOpts||e;for(const[i,r]of t)s[i]=r;return s};const ct={name:"HomePage",components:{}},dt=u("h1",{style:{"text-align":"center"}},"Home page of HILT Demo",-1),ut=u("div",{style:{display:"flex","justify-content":"center"}},[u("p",null," (Guideline will be uploaded soon) ")],-1);function _t(e,t,s,i,r,a){return c(),x(L,null,[dt,ut],64)}var pt=M(ct,[["render",_t]]);const U={1:"Sequence Classification",2:"Relation Extraction"},N={0:{name:"Neutral",colors:[{"background-color":"#FFFFFF",color:"#000000"},{"background-color":"#FFFFFF",color:"#000000"},{"background-color":"#FFFFFF",color:"#000000"},{"background-color":"#FFFFFF",color:"#000000"},{"background-color":"#FFFFFF",color:"#000000"}]},1:{name:"Red",colors:[{"background-color":"#EA9999",color:"#000000"},{"background-color":"#E06666",color:"#FFFFFF"},{"background-color":"#CC0000",color:"#FFFFFF"}]},2:{name:"Blue",colors:[{"background-color":"#ADD8E6",color:"#000000"},{"background-color":"#4682B4",color:"#000000"},{"background-color":"#00008B",color:"#FFFFFF"}]},3:{name:"Green",colors:[{"background-color":"#8AFF8A",color:"#000000"},{"background-color":"#00D100",color:"#FFFFFF"},{"background-color":"#007500",color:"#FFFFFF"}]},4:{name:"Purple",colors:[{"background-color":"#CC85FF",color:"#000000"},{"background-color":"#7700CC",color:"#FFFFFF"},{"background-color":"#3E006B",color:"#FFFFFF"}]},5:{name:"Orange",colors:[{"background-color":"#FFCA8A",color:"#000000"},{"background-color":"#FFA12E",color:"#000000"},{"background-color":"#D67600",color:"#000000"}]}};Ie.defaults.baseURL="/api";const v=Ie.create({headers:{Accept:"application/json","Content-Type":"application/json",Authorization:null}});v.interceptors.response.use(e=>e.data,e=>(J({title:"Error",message:e.toString(),type:"error"}),Promise.reject(e)));v.interceptors.request.use(e=>e,e=>(J({title:"Error",message:e.toString(),type:"error"}),Promise.reject(e)));var Z={list(){return v.get("hilt/projects/")},get(e){return v.get(`hilt/projects/${e}/`)},create(e){return v.post("hilt/projects/",e)},update(e){return v.put(`hilt/projects/${e.id}/`,e)},delete(e){return v.delete(`hilt/projects/${e}/`)},exportJSON(e){return v.get(`hilt/export/json/${e}/`)}};const W=z({id:"project",state:()=>({projectInfo:null}),getters:{getProjectInfo:e=>e.projectInfo,task:e=>e.projectInfo.task},actions:{reset_state(){Z.get(this.projectInfo.id).then(e=>(console.log("reset_project_state",e),this.projectInfo=e,e),e=>{console.log(e)})},setProject(e){this.projectInfo=e},setTask(e){this.projectInfo.task=e},exportJSON(){return Z.exportJSON(this.projectInfo.id)}}}),mt={name:"CreateProjectModal",props:{dialogVisible:Boolean,existingInfo:Object},setup(){const e=W(),t=[];for(let s in U)t.push({id:s,name:U[s]});return{projectStore:e,taskOptions:t}},data(){return{projectInfo:{name:"",description:"",task:""},formRules:{name:[{required:!0,message:"Please input project name",trigger:"blur"}],description:[{required:!0,message:"Please input description",trigger:"blur"}],task:[{required:!0,message:"Please select task",trigger:"blur"}]}}},methods:{dialogIsOpen(){if(this.existingInfo)for(let e in this.existingInfo)this.projectInfo[e]=this.existingInfo[e];else this.projectInfo={name:"",description:"",task:""}},createProject(){this.$refs.projectInfoForm.validate(e=>{if(e){let t;this.existingInfo?t=Z.update(this.projectInfo):t=Z.create(this.projectInfo),t.then(s=>{this.projectStore.setProject(s),this.$emit("update:dialogVisible",!1),this.$router.push({name:"DocumentUpload"})})}})}}},ht={class:"dialog-footer"},ft=p("Cancel"),gt=p("Confirm");function yt(e,t,s,i,r,a){const d=l("el-input"),_=l("el-form-item"),m=l("el-option"),h=l("el-select"),f=l("el-form"),y=l("el-button"),w=l("el-dialog");return c(),S(w,{title:this.existingInfo?"Edit Existing Project":"Create New Project",modelValue:s.dialogVisible,"onUpdate:modelValue":t[4]||(t[4]=b=>s.dialogVisible=b),"onUpdate:visible":t[5]||(t[5]=b=>e.$emit("update:dialogVisible",b)),onOpen:this.dialogIsOpen,width:"40%"},{footer:n(()=>[u("span",ht,[o(y,{onClick:t[3]||(t[3]=()=>e.$emit("update:dialogVisible",!1))},{default:n(()=>[ft]),_:1}),o(y,{type:"primary",onClick:a.createProject},{default:n(()=>[gt]),_:1},8,["onClick"])])]),default:n(()=>[o(f,{model:r.projectInfo,rules:r.formRules,ref:"projectInfoForm"},{default:n(()=>[o(_,{label:"Name",prop:"name"},{default:n(()=>[o(d,{modelValue:r.projectInfo.name,"onUpdate:modelValue":t[0]||(t[0]=b=>r.projectInfo.name=b)},null,8,["modelValue"])]),_:1}),o(_,{label:"Description",prop:"description"},{default:n(()=>[o(d,{modelValue:r.projectInfo.description,"onUpdate:modelValue":t[1]||(t[1]=b=>r.projectInfo.description=b)},null,8,["modelValue"])]),_:1}),o(_,{label:"Task",prop:"task"},{default:n(()=>[o(h,{remote:"",modelValue:r.projectInfo.task,"onUpdate:modelValue":t[2]||(t[2]=b=>r.projectInfo.task=b),placeholder:"Select",style:{width:"100%"}},{default:n(()=>[(c(!0),x(L,null,B(i.taskOptions,b=>(c(),S(m,{key:b.id,label:b.name,value:b.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue","onOpen"])}var St=M(mt,[["render",yt]]);const bt={name:"ProjectsPage",components:{CreateProjectModal:St,Edit:$e,Delete:se},setup(){const e=Q(),t=W(),s=[];for(let i in U)s.push({text:U[i],value:U[i]});return{userStore:e,projectStore:t,filters:s}},data(){return{projects:[],dialogVisible:!1,selectedProject:null}},created:function(){this.fetchProjects()},methods:{handleProjectSelected(e,t){this.$router.push({name:"DocumentList"}),this.projectStore.setProject(t)},handleEdit(e,t){this.selectedProject=t,this.dialogVisible=!0},handleDelete(e,t){Z.delete(t.id).then(()=>{this.fetchProjects()})},fetchProjects(){Z.list().then(e=>{this.projects=e.results},e=>{console.log(e)})},dateFormat(e,t){let s=e[t.property];return s?Ue.fromISO(s).toISODate():""},convertTaskIDToString(e,t){let s=e[t.property];return s?U[s]:""},filterTask(e,t,s){let i=t[s.property],r=U[i];return e===r}}},xt={style:{"text-align":"center"}},Dt=p("CREATE PROJECT "),wt=p(" Edit "),vt=p("Delete");function kt(e,t,s,i,r,a){const d=l("el-button"),_=l("el-col"),m=l("el-row"),h=l("el-link"),f=l("el-table-column"),y=l("Edit"),w=l("el-icon"),b=l("Delete"),I=l("el-popconfirm"),C=l("el-table"),$=l("CreateProjectModal");return c(),x("div",null,[u("div",xt,[u("h1",null,"Hello, "+j(this.userStore.username),1),o(m,null,{default:n(()=>[o(_,{span:12,offset:6},{default:n(()=>[o(d,{type:"primary",onClick:t[0]||(t[0]=()=>{this.selectedProject=null,this.dialogVisible=!0})},{default:n(()=>[Dt]),_:1})]),_:1})]),_:1})]),o(m,null,{default:n(()=>[o(_,{span:12,offset:6},{default:n(()=>[o(C,{data:r.projects,stripe:"","default-sort":{prop:"updated_at",order:"descending"}},{default:n(()=>[o(f,{prop:"name",label:"Name",sortable:""},{default:n(g=>[o(h,{type:"primary",onClick:F=>a.handleProjectSelected(g.$index,g.row)},{default:n(()=>[p(j(g.row.name),1)]),_:2},1032,["onClick"])]),_:1}),o(f,{prop:"description",label:"Description",sortable:""}),o(f,{prop:"task",label:"Task",formatter:a.convertTaskIDToString,sortable:"",filters:this.filters,"filter-method":a.filterTask},null,8,["formatter","filters","filter-method"]),o(f,{prop:"updated_at",label:"Last Updated",formatter:a.dateFormat,sortable:""},null,8,["formatter"]),o(f,{label:"Operations"},{default:n(g=>[o(d,{size:"small",onClick:F=>a.handleEdit(g.$index,g.row)},{default:n(()=>[o(w,null,{default:n(()=>[o(y)]),_:1}),wt]),_:2},1032,["onClick"]),o(I,{title:"Are you sure?",onConfirm:F=>a.handleDelete(g.$index,g.row),style:{"margin-left":"10px"}},{reference:n(()=>[o(d,{size:"small",type:"danger"},{default:n(()=>[o(w,null,{default:n(()=>[o(b)]),_:1}),vt]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1}),o($,{"dialog-visible":r.dialogVisible,"onUpdate:dialog-visible":t[1]||(t[1]=g=>r.dialogVisible=g),"existing-info":this.selectedProject},null,8,["dialog-visible","existing-info"])])}var It=M(bt,[["render",kt]]);const $t={name:"SetupSideBar",components:{Files:Oe,UploadFilled:fe,MessageBox:ze,StarFilled:Ne,Edit:$e,Download:ge,DataAnalysis:Ce,Tools:Fe},computed:{disabled(){return this.projectStore.getProjectInfo,!1}},setup(){return{projectStore:W()}}},ne=e=>(R("data-v-1f5238c3"),e=e(),G(),e),Ct=ne(()=>u("span",null,"Setup",-1)),Ft=p(" Overview "),jt=p(" Upload New Document "),Pt=p(" Upload Custom Model "),Lt=ne(()=>u("span",null,"Labels",-1)),Wt=ne(()=>u("span",null,"Generate Explanations",-1)),Mt=ne(()=>u("span",null,"Debug",-1)),At=ne(()=>u("span",null,"Export Data",-1));function Tt(e,t,s,i,r,a){const d=l("Tools"),_=l("el-icon"),m=l("Files"),h=l("el-menu-item"),f=l("UploadFilled"),y=l("StarFilled"),w=l("el-sub-menu"),b=l("DataAnalysis"),I=l("el-menu"),C=l("Edit"),$=l("Download"),g=l("el-col");return c(),S(g,null,{default:n(()=>[o(I,{"default-active":e.$route.path,router:!0},{default:n(()=>[o(w,{index:"1"},{title:n(()=>[o(_,null,{default:n(()=>[o(d)]),_:1}),Ct]),default:n(()=>[o(h,{index:"/project/doc/list"},{default:n(()=>[o(_,null,{default:n(()=>[o(m)]),_:1}),Ft]),_:1}),o(h,{index:"/project/doc/upload",disabled:a.disabled},{default:n(()=>[o(_,null,{default:n(()=>[o(f)]),_:1}),jt]),_:1},8,["disabled"]),o(h,{index:"/project/doc/model",disabled:a.disabled},{default:n(()=>[o(_,null,{default:n(()=>[o(f)]),_:1}),Pt]),_:1},8,["disabled"]),o(h,{index:"/project/labels"},{default:n(()=>[o(_,null,{default:n(()=>[o(y)]),_:1}),Lt]),_:1})]),_:1}),o(h,{index:"/project/generate-explanations"},{default:n(()=>[o(_,null,{default:n(()=>[o(b)]),_:1}),Wt]),_:1})]),_:1},8,["default-active"]),o(I,null,{default:n(()=>[o(h,{onClick:t[0]||(t[0]=()=>this.$router.push({name:"DebugOverview"}))},{default:n(()=>[o(_,null,{default:n(()=>[o(C)]),_:1}),Mt]),_:1})]),_:1}),o(I,{"default-active":e.$route.path,router:!0},{default:n(()=>[o(h,{index:"/project/export"},{default:n(()=>[o(_,null,{default:n(()=>[o($)]),_:1}),At]),_:1})]),_:1},8,["default-active"])]),_:1})}var Bt=M($t,[["render",Tt],["__scopeId","data-v-1f5238c3"]]);const Et={name:"ProjectSetupPage",components:{SetupSideBar:Bt}};function Vt(e,t,s,i,r,a){const d=l("SetupSideBar"),_=l("el-aside"),m=l("router-view"),h=l("el-main"),f=l("el-container");return c(),x("div",null,[o(f,null,{default:n(()=>[o(_,{style:{"border-right":"solid 1px #e6e6e6"}},{default:n(()=>[o(d,{style:{width:"100%"}})]),_:1}),o(h,null,{default:n(()=>[o(m)]),_:1})]),_:1})])}var Ut=M(Et,[["render",Vt]]);const Ot={name:"SetupDocument"};function zt(e,t,s,i,r,a){const d=l("router-view");return c(),S(d)}var Nt=M(Ot,[["render",zt]]),H={list(e,t,s){const i={};return t&&(i.page=t),s&&(i.page_size=s),v.get(`hilt/projects/${e}/docs/`,{params:i})},uploadFile(e,t,s){const i=new FormData;return i.append("dataset",t),i.append("format",s.toLowerCase()),v.post(`hilt/projects/${e}/docs/upload/`,i,{headers:q(E({},v.defaults.headers),{"Content-Type":"multipart/form-data"})})},markAnnotated(e,t,s,i){return console.log("documents API",t,":	",s),v.put(`hilt/projects/${t}/docs/${s}/`,{annotated:e,project:t,text:i})},delete(e,t){return v.delete(`hilt/projects/${e}/docs/${t}/`)},detailedDocument(e,t){return v.get(`hilt/projects/${e}/docs/${t}/words-annotations/`)}};const le=z({id:"document",state:()=>({documents:[],curPage:1,maxPage:1,totalDocCount:0,curDocIndex:0,annotatedDocCount:0,pageSize:10}),getters:{getDocuments:e=>e.documents,getdocumentInfo:e=>e},actions:{resetState(){return this.curPage=1,this.pageSize=10,this.fetchDocuments()},setCurDocIndex(e){this.curDocIndex=e},fetchDocuments(){const e=W();return H.list(e.getProjectInfo.id,this.curPage,this.pageSize).then(t=>(this.documents=t.results.results,this.totalDocCount=t.count,this.annotatedDocCount=t.results.annotatedCount,this.maxPage=Math.ceil(this.totalDocCount/this.pageSize),console.log(t.results.results),t))},updateCurPage(e){return this.curPage=e,this.curDocIndex=0,this.fetchDocuments()},deleteDocument(e){const t=W();return H.delete(t.getProjectInfo.id,e.id)},markAnnotated(e){const t=W();return this.documents[this.curDocIndex].id?(console.log(t.getProjectInfo.id,this.documents[this.curDocIndex].id),H.markAnnotated(e,t.getProjectInfo.id,this.documents[this.curDocIndex].id,this.documents[this.curDocIndex].text).then(()=>{this.documents[this.curDocIndex].annotated=!0})):null}}}),Qt={name:"DocumentList",components:{Search:ye,Delete:se,QuestionFilled:X},setup(){return{documentStore:le()}},data(){return{searchQuery:""}},methods:{pageChanged(e){this.documentStore.updateCurPage(e)},indexMethod(e){return e+1},percentageText(e){return`${e} % annotated`},handleDelete(e,t){this.documentStore.deleteDocument(t).then(()=>{this.documentStore.fetchDocuments()})}},created(){this.documentStore.resetState()}},Rt={style:{"text-align":"center"}},Gt=p("All Uploaded Documents "),qt={style:{"align-content":"center"}},Jt=p("Delete");function Ht(e,t,s,i,r,a){const d=l("QuestionFilled"),_=l("el-icon"),m=l("el-popover"),h=l("Search"),f=l("el-input"),y=l("el-table-column"),w=l("Delete"),b=l("el-button"),I=l("el-popconfirm"),C=l("el-table"),$=l("el-pagination"),g=ie("snip");return c(),x("div",null,[u("div",Rt,[u("div",null,[u("h1",null,[Gt,o(m,{content:"help text",trigger:"hover",width:400},{reference:n(()=>[o(_,{style:{height:"100%","margin-left":"0.5rem"}},{default:n(()=>[o(d)]),_:1})]),_:1})])]),o(f,{modelValue:r.searchQuery,"onUpdate:modelValue":t[0]||(t[0]=F=>r.searchQuery=F),placeholder:"Type to search for documents",style:{width:"50%"},clearable:""},{prefix:n(()=>[u("div",qt,[o(_,null,{default:n(()=>[o(h)]),_:1})])]),_:1},8,["modelValue"])]),o(C,{data:i.documentStore.getDocuments.filter(F=>!r.searchQuery||F.text.toLowerCase().includes(r.searchQuery.toLowerCase().trim())),stripe:""},{default:n(()=>[o(y,{type:"index",index:a.indexMethod},null,8,["index"]),o(y,{label:"Text"},{default:n(F=>[ae((c(),x("p",null,[p(j(F.row.text),1)])),[[g,{lines:3}]])]),_:1}),o(y,{label:"Operations"},{default:n(F=>[o(I,{title:"Are you sure?",onConfirm:D=>a.handleDelete(F.$index,F.row),style:{"margin-left":"10px"}},{reference:n(()=>[o(b,{size:"small",type:"danger"},{default:n(()=>[o(_,null,{default:n(()=>[o(w)]),_:1}),Jt]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"]),o($,{background:"",layout:"prev, pager, next",total:i.documentStore.getdocumentInfo.totalDocCount,"page-size":i.documentStore.getdocumentInfo.pageSize,"current-page":i.documentStore.getdocumentInfo.curPage,onCurrentChange:a.pageChanged,style:{"text-align":"center"}},null,8,["total","page-size","current-page","onCurrentChange"])])}var Kt=M(Qt,[["render",Ht]]);const Zt={name:"DocumentUpload",components:{UploadFilled:fe},setup(){return{projectStore:W()}},data(){return{fileForm:{fileType:"JSON"}}},methods:{uploadFile(e){H.uploadFile(this.projectStore.getProjectInfo.id,e.file,this.fileForm.fileType).then(()=>{this.$router.push({name:"ModelUpload"})}).catch(t=>{console.log(t)})}}},V=e=>(R("data-v-4a0a22b4"),e=e(),G(),e),Xt=V(()=>u("h3",null,"Import your corpus below",-1)),Yt=V(()=>u("div",null,[p(" In order to start the annotation process, a corpus "),u("u",null,"must"),p(" be uploaded ")],-1)),eo=V(()=>u("div",null,"We accept datasets in the following formats:",-1)),to=V(()=>u("b",null,"JSON (recommended)",-1)),oo=V(()=>u("br",null,null,-1)),no=V(()=>u("u",null,"Format:",-1)),lo={style:{width:"fit-content","padding-left":"20px","padding-right":"20px",height:"fit-content"}},ro=p("                "),so=p(`

{
  "data" : [
    {
      "text" : "Louis Armstrong the great trumpet player lived in Corona.",
    `),io=p(`
      "label": "Label-Name-1"
    `),ao=p(`
      "label": "Label-Name-1",
      "start_offset": 0,
      "end_offset": 5,
    `),co=p(`
    },
    ...
  ]
}
              `),uo=p(`
							`),_o=p(" Each entry within "),po=V(()=>u("i",null,"data",-1)),mo=p(" must have keys "),ho=V(()=>u("i",null,[u("b",null,"text")],-1)),fo=p(" and "),go=V(()=>u("i",null,[u("b",null,"words")],-1)),yo=p(". All other keys will be saved in a metadata dictionary associated with the text "),So=V(()=>u("br",null,null,-1)),bo=p(" The "),xo=V(()=>u("i",null,[u("b",null,"annotations")],-1)),Do=p(" key in each entry is optional. And, can be used to populate the document with label. "),wo=p("JSON file"),vo=V(()=>u("div",{class:"el-upload__text"},[p(" Drop file here or "),u("em",null,"click to upload")],-1));function ko(e,t,s,i,r,a){const d=l("el-radio"),_=l("el-form-item"),m=l("UploadFilled"),h=l("el-icon"),f=l("el-upload"),y=l("el-form"),w=l("el-card"),b=l("el-col"),I=l("el-row");return c(),S(I,null,{default:n(()=>[o(b,null,{default:n(()=>[o(w,null,{header:n(()=>[Xt]),default:n(()=>[u("div",null,[Yt,eo,u("ul",null,[u("li",null,[to,oo,no,u("pre",lo,[ro,u("code",null,[so,this.projectStore.task===1?(c(),x(L,{key:0},[io],64)):A("",!0),this.projectStore.task===2?(c(),x(L,{key:1},[ao],64)):A("",!0),co]),uo]),_o,po,mo,ho,fo,go,yo,So,bo,xo,Do])])]),o(y,{model:this.fileForm,style:{"text-align":"center"}},{default:n(()=>[o(_,null,{default:n(()=>[o(d,{modelValue:r.fileForm.fileType,"onUpdate:modelValue":t[0]||(t[0]=C=>r.fileForm.fileType=C),label:"JSON",border:""},{default:n(()=>[wo]),_:1},8,["modelValue"])]),_:1}),o(_,{label:""},{default:n(()=>[o(f,{"http-request":a.uploadFile,drag:"",accept:"text/json",ref:"uploadInput",action:""},{default:n(()=>[o(h,{size:48},{default:n(()=>[o(m)]),_:1}),vo]),_:1},8,["http-request"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1})}var Io=M(Zt,[["render",ko],["__scopeId","data-v-4a0a22b4"]]),K={list(e){return v.get(`hilt/projects/${e}/models/`)},uploadModel(e,t,s){const i=new FormData;return i.append("model_zip",t),i.append("format",s.toLowerCase()),console.log(i),v.post(`hilt/projects/${e}/models/upload/`,i,{headers:q(E({},v.defaults.headers),{"Content-Type":"multipart/form-data"})})},downloadModel(e,t){const s=new FormData;return s.append("model_id",t),v.post(`hilt/projects/${e}/model/download/`,s,{headers:q(E({},v.defaults.headers),{"Content-Type":"multipart/form-data"})})}};const $o={name:"ModelUpload",components:{UploadFilled:fe,Upload:Qe,SuccessFilled:Re,QuestionFilled:X},setup(){return{projectStore:W()}},data(){return{modelRadio:"Upload Model",modelList:[],fileForm:{fileType:".zip",fileZip:[],file:null},savingSuccessful:!1}},methods:{handleUpload(e){K.uploadModel(this.projectStore.getProjectInfo.id,e.file,this.fileForm.fileType).then(t=>{console.log(t),t!=null&&t.success&&(this.savingSuccessful=!0)}).catch(t=>{console.log(t)})},uploadFile(){this.$refs.modelUploadForm.validate(e=>{e&&K.uploadModel(this.projectStore.getProjectInfo.id,this.fileForm.file,this.fileForm.description,this.fileForm.fileType).then(()=>{}).catch(t=>{console.log(t)})})},getModelList(){K.list(this.projectStore.getProjectInfo.id).then(e=>{this.modelList=e.results,console.log("res",e),console.log("model list:",this.modelList)})},created(){this.getModelList()}}},Le=e=>(R("data-v-4cf389c2"),e=e(),G(),e),Co=p("Model List "),Fo=Le(()=>u("h3",null,[p("Upload new model "),u("span",{style:{color:"#909399"}},"(Optional)")],-1)),jo=p(".ZIP file"),Po=Le(()=>u("div",{class:"el-upload__text"},[p(" Drop file here or "),u("em",null,"click to upload")],-1)),Lo={key:0,class:"success",style:{color:"green"}},Wo=p("Model was saved successfully ");function Mo(e,t,s,i,r,a){const d=l("QuestionFilled"),_=l("el-icon"),m=l("el-popover"),h=l("el-table-column"),f=l("el-table"),y=l("el-card"),w=l("el-radio"),b=l("el-form-item"),I=l("UploadFilled"),C=l("el-upload"),$=l("SuccessFilled"),g=l("el-form"),F=l("el-col"),D=l("el-row");return c(),S(D,null,{default:n(()=>[o(F,null,{default:n(()=>[r.modelRadio=="Model List"?(c(),S(y,{key:0},{header:n(()=>[u("h3",null,[Co,o(m,{content:"help text",trigger:"hover",width:400},{reference:n(()=>[o(_,{style:{height:"100%","margin-left":"0.5rem"}},{default:n(()=>[o(d)]),_:1})]),_:1})])]),default:n(()=>[o(f,{data:this.modelList,stripe:"",style:{width:"100%"}},{default:n(()=>[o(h,{prop:"id",label:"Id"}),o(h,{prop:"name",label:"Name"}),o(h,{prop:"model",label:"Model path"}),o(h,{prop:"uploaded_at",label:"Uploaded at"})]),_:1},8,["data"])]),_:1})):A("",!0),r.modelRadio=="Upload Model"?(c(),S(y,{key:1},{header:n(()=>[Fo]),default:n(()=>[o(g,{model:this.fileForm,ref:"modelUploadForm",style:{"text-align":"center"}},{default:n(()=>[o(b,null,{default:n(()=>[o(w,{modelValue:r.fileForm.fileType,"onUpdate:modelValue":t[0]||(t[0]=P=>r.fileForm.fileType=P),label:".zip",border:""},{default:n(()=>[jo]),_:1},8,["modelValue"])]),_:1}),o(b,null,{default:n(()=>[o(C,{"file-list":r.fileForm.fileZip,"onUpdate:file-list":t[1]||(t[1]=P=>r.fileForm.fileZip=P),drag:"",accept:".zip",ref:"uploadInput",action:"","http-request":a.handleUpload},{default:n(()=>[o(_,{size:48},{default:n(()=>[o(I)]),_:1}),Po]),_:1},8,["file-list","http-request"])]),_:1}),r.savingSuccessful?(c(),x("div",Lo,[u("p",null,[Wo,o(_,null,{default:n(()=>[o($)]),_:1})])])):A("",!0)]),_:1},8,["model"])]),_:1})):A("",!0)]),_:1})]),_:1})}var Ao=M($o,[["render",Mo],["__scopeId","data-v-4cf389c2"]]),ve={list(e){return v.get(`hilt/projects/${e}/labels/?page_size=100`)},update(e,t){return v.put(`hilt/projects/${e}/labels/${t.id}/`,t)}};const Y=z({id:"label",state:()=>({labels:[],labelsMap:{}}),getters:{getLabels:e=>e.labels,getLabelByID:e=>t=>!t||!(t in e.labelsMap)?null:e.labels[e.labelsMap[t]]},actions:{fetchLabels(){const e=W();return ve.list(e.getProjectInfo.id).then(t=>{const s={};for(let i=0;i<t.results.length;i++){const r=t.results[i];s[r.id]=i}return this.labels=t.results,this.labelsMap=s,t.results})},updateLabel(e){const t=W();return ve.update(t.getProjectInfo.id,e)}}}),To={name:"LabelModificationPage",components:{QuestionFilled:X},setup(){const e=Y(),t=[];for(let s in N)t.push({id:s,name:N[s].name});return{labelStore:e,colorSetOptions:t}},data(){return{existingLabels:[],colors_sets:[],saving:!1}},methods:{goNextStep(){this.saving=!0;const e=[];for(let t=0;t<this.existingLabels.length;t++){const s=this.existingLabels[t],i=parseInt(this.colors_sets[t]);s.color_set!=i&&(s.color_set=i,e.push(this.labelStore.updateLabel(s)))}Promise.all(e).then(()=>{this.saving=!1,this.labelStore.fetchLabels(),this.$router.push({name:"GenerateExplanations"})})},getColors(e){return e=parseInt(e),e in N?N[e].colors:[]}},created(){this.labelStore.fetchLabels().then(e=>{const t={};for(let s in e)t[s]=""+e[s].color_set;this.colors_sets=t,this.existingLabels=e})},computed:{disableButton(){if(this.saving)return!0;const e={};for(let t in this.colors_sets){if(t in e)return!0;e[t]=null}return!1}}},Bo=u("h3",null,"Label Space Creation",-1),Eo={style:{"text-align":"left"}},Vo=u("b",null,"Current Label Space",-1),Uo={style:{"margin-left":"5px"}},Oo=p(" Done ");function zo(e,t,s,i,r,a){const d=l("QuestionFilled"),_=l("el-icon"),m=l("el-popover"),h=l("el-col"),f=l("el-row"),y=l("el-divider"),w=l("el-option"),b=l("el-select"),I=l("el-form-item"),C=l("el-button"),$=l("el-form"),g=l("el-card");return c(),S(f,{style:{width:"100%"}},{default:n(()=>[o(g,{style:{width:"100%"}},{header:n(()=>[Bo]),default:n(()=>[u("div",Eo,[o(f,null,{default:n(()=>[o(h,{span:8},{default:n(()=>[o(m,{content:"Available labels for model to predict.",trigger:"hover"},{reference:n(()=>[u("span",null,[Vo,o(_,{style:{"margin-left":"5px"}},{default:n(()=>[o(d)]),_:1})])]),_:1})]),_:1})]),_:1}),o(y),o($,{model:r.colors_sets},{default:n(()=>[(c(!0),x(L,null,B(this.existingLabels,(F,D)=>(c(),S(f,{key:F.id},{default:n(()=>[o(I,{label:F.text},{default:n(()=>[o(b,{modelValue:this.colors_sets[D],"onUpdate:modelValue":P=>this.colors_sets[D]=P,placeholder:"Select",style:{width:"100%"}},{default:n(()=>[(c(!0),x(L,null,B(this.colorSetOptions,P=>(c(),S(w,{key:P.id,label:P.name,value:P.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]),u("div",Uo,[(c(!0),x(L,null,B(this.getColors(this.colors_sets[D]),(P,k)=>(c(),x("span",{key:k,style:O([P,{"margin-left":"5px",padding:"5px"}])}," Word ",4))),128))])]),_:2},1024))),128)),o(f,null,{default:n(()=>[o(C,{type:"success",disabled:this.disableButton,onClick:a.goNextStep},{default:n(()=>[Oo]),_:1},8,["disabled","onClick"])]),_:1})]),_:1},8,["model"])])]),_:1})]),_:1})}var No=M(To,[["render",zo]]),pe={generateExplanations(e,t,{str:s,model_id:i,model_path:r}={}){console.log("inside network/explanations.js");const a=new FormData;return a.append("useHuggingface",t),t?a.append("str",s):(a.append("model_id",i),a.append("model_path",r)),console.log(a),v.post(`hilt/projects/${e}/explanations/`,a,{headers:q(E({},v.defaults.headers),{"Content-Type":"multipart/form-data"})})},didFinishGeneration(e){return v.get(`hilt/projects/${e}/update/model_status/`)}};const Qo={name:"GenerateExplanations",components:{Tools:Fe,QuestionFilled:X},setup(){return{projectStore:W()}},data(){return{generating_explanations:!1,huggingfaceForm:{str:"",rules:{str:{required:!0,message:"Please input huggingface string",trigger:"blur"}}},customModelForm:{modelList:[],select:"",rules:{select:{required:!0,message:"Please select model",trigger:"change"}}},loadingExplanations:!1}},methods:{getModelList(){console.log("model list"),K.list(this.projectStore.getProjectInfo.id).then(e=>{this.customModelForm.modelList=e.results})},huggingfaceSubmit(){this.$refs.huggingfaceForm.validate(e=>{e&&(console.log("huggingface generate explanations"),this.loadingExplanations=!0,pe.generateExplanations(this.projectStore.getProjectInfo.id,!0,{str:this.huggingfaceForm.str}).then(t=>{console.log("Here"),console.log(t),this.generating_explanations=!0,this.waitForCompletion(),J({title:"Explanation Generation Started",message:"Page will automatically change once task is completed",type:"success",duration:0})}).catch(t=>{this.loadingExplanations=!1,t.response&&t.response.data?this.$notify.error({title:"Model training failed",message:t.response.data}):this.$notify.error({title:"Model failed to start training",message:"Please try again later"})}))})},customModelSubmit(){this.$refs.customModelForm.validate(e=>{e&&(console.log("custom model generate explanations"),console.log("model_id:",this.customModelForm.select[0]),console.log("model_path",this.customModelForm.select[1]),this.loadingExplanations=!0,J({title:"Started",message:"Task accepted",type:"success",duration:4500}),pe.generateExplanations(this.projectStore.getProjectInfo.id,!1,{model_id:this.customModelForm.select[0],model_path:this.customModelForm.select[1]}).then(t=>{const s=this.projectStore.getProjectInfo;this.projectStore.reset_state(),console.log(s.explanations_status),console.log(t),this.generating_explanations=!0,this.waitForCompletion(),J({title:"Explanation Generation Started",message:"Page will automatically change once task is",type:"success",duration:0})}).catch(t=>{this.loadingExplanations=!1,console.log(t),t.response&&t.response.data?this.$notify.error({title:"Model training failed",message:t.response.data}):this.$notify.error({title:"Model failed to start training",message:"Please try again later"})}))})},waitForCompletion(){let e=60,t=setInterval(()=>pe.didFinishGeneration(this.projectStore.getProjectInfo.id).then(s=>{console.log(s),e<0||s.status=="finished"?(console.log("finished"),this.loadingExplanations=!0,this.$notify.success({title:"Success",message:"Model Execution had been completed",duration:0}),clearInterval(t),this.$router.push({name:"DebugOverview"})):(console.log("Waiting for model finish message."),e-=1,console.log(e))}),1e3)}},mounted(){this.getModelList()}},Ro=p(" Generate Explanations Page "),Go=p("Generate Explanations"),qo=p("Generate Explanations");function Jo(e,t,s,i,r,a){const d=l("QuestionFilled"),_=l("el-icon"),m=l("el-popover"),h=l("el-option"),f=l("el-select"),y=l("el-form-item"),w=l("el-button"),b=l("el-form"),I=l("el-alert"),C=l("el-tab-pane"),$=l("el-input"),g=l("el-col"),F=l("el-tabs"),D=l("el-card");return c(),S(D,{style:{width:"100%"}},{default:n(()=>[u("h3",null,[Ro,o(m,{content:"help text",trigger:"hover",width:400},{reference:n(()=>[o(_,{style:{height:"100%","margin-left":"0.5rem"}},{default:n(()=>[o(d)]),_:1})]),_:1})]),o(F,{type:"border-card"},{default:n(()=>[o(C,{label:"Custom Model"},{default:n(()=>[o(b,{model:r.customModelForm,ref:"customModelForm",rules:r.customModelForm.rules,"label-position":"top"},{default:n(()=>[o(y,{label:"Custom Model",prop:"select"},{default:n(()=>[o(f,{modelValue:r.customModelForm.select,"onUpdate:modelValue":t[0]||(t[0]=P=>r.customModelForm.select=P),clearable:"",placeholder:"Select Model"},{default:n(()=>[(c(!0),x(L,null,B(r.customModelForm.modelList,P=>(c(),S(h,{key:P.id,label:P.name,value:[P.id,P.model]},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(y,null,{default:n(()=>[o(w,{type:"primary",onClick:a.customModelSubmit,loading:r.loadingExplanations},{default:n(()=>[Go]),_:1},8,["onClick","loading"])]),_:1})]),_:1},8,["model","rules"]),r.generating_explanations?(c(),S(I,{key:0,title:"Generating Explanations...",type:"info",description:"will update once the task in done",center:"","show-icon":"",closable:!1})):A("",!0)]),_:1}),o(C,{label:"Huggingface"},{default:n(()=>[o(b,{model:r.huggingfaceForm,ref:"huggingfaceForm",rules:r.huggingfaceForm.rules,"label-position":"top"},{default:n(()=>[o(y,{label:"huggingface string",prop:"str"},{default:n(()=>[o(g,{span:6},{default:n(()=>[o($,{modelValue:r.huggingfaceForm.str,"onUpdate:modelValue":t[1]||(t[1]=P=>r.huggingfaceForm.str=P)},null,8,["modelValue"])]),_:1})]),_:1}),o(y,null,{default:n(()=>[o(w,{type:"primary",onClick:a.huggingfaceSubmit,loading:r.loadingExplanations},{default:n(()=>[qo]),_:1},8,["onClick","loading"])]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1})]),_:1})}var Ho=M(Qo,[["render",Jo]]);const Ko={name:"ExportData",components:{Download:ge,QuestionFilled:X},setup(){return{projectStore:W()}},methods:{exportJSON(){this.projectStore.exportJSON().then(e=>{Ge(JSON.stringify(e,null,1),`${this.projectStore.getProjectInfo.name}.json`)})}}},Zo=p("Export Explanation-Generated Data "),Xo=p(" Download JSON data ");function Yo(e,t,s,i,r,a){const d=l("QuestionFilled"),_=l("el-icon"),m=l("el-popover"),h=l("Download"),f=l("el-button");return c(),x(L,null,[u("h3",null,[Zo,o(m,{content:"help text",trigger:"hover",width:400},{reference:n(()=>[o(_,{style:{height:"100%","margin-left":"0.5rem"}},{default:n(()=>[o(d)]),_:1})]),_:1})]),o(f,{type:"primary",onClick:t[0]||(t[0]=y=>a.exportJSON())},{default:n(()=>[o(_,null,{default:n(()=>[o(h)]),_:1}),Xo]),_:1})],64)}var en=M(Ko,[["render",Yo]]);const tn={name:"SetupSideBar",components:{Back:ce,Document:qe,DocumentCopy:Je,List:He,Management:Ke,DataAnalysis:Ce}},be=e=>(R("data-v-c9efccda"),e=e(),G(),e),on=be(()=>u("span",null,"Back",-1)),nn=be(()=>u("span",null,"Debug Overview",-1)),ln=be(()=>u("span",null,"Evaluation",-1));function rn(e,t,s,i,r,a){const d=l("Back"),_=l("el-icon"),m=l("el-menu-item"),h=l("Management"),f=l("DataAnalysis"),y=l("el-menu"),w=l("el-col");return c(),S(w,null,{default:n(()=>[o(y,{"default-active":e.$route.path},{default:n(()=>[o(m,{index:"1",onClick:t[0]||(t[0]=()=>this.$router.push({name:"GenerateExplanations"}))},{default:n(()=>[o(_,null,{default:n(()=>[o(d)]),_:1}),on]),_:1}),o(m,{index:"/debug/overview",onClick:t[1]||(t[1]=()=>this.$router.push({name:"DebugOverview"}))},{default:n(()=>[o(_,null,{default:n(()=>[o(h)]),_:1}),nn]),_:1}),o(m,{index:"/debug/evaluation",onClick:t[2]||(t[2]=()=>this.$router.push({name:"DebugEvaluation"}))},{default:n(()=>[o(_,null,{default:n(()=>[o(f)]),_:1}),ln]),_:1})]),_:1},8,["default-active"])]),_:1})}var sn=M(tn,[["render",rn],["__scopeId","data-v-c9efccda"]]);const xe=z({id:"detailedDocument",state:()=>({document:null,maxWords:50}),getters:{getDocument:e=>e.document,getMaxWords:e=>e.maxWords},actions:{fetchDocument(e){const t=W();return H.detailedDocument(t.getProjectInfo.id,e).then(s=>{const i={};for(let r of s.words){const a={};for(let d of r.word_annotation_score)a[d.annotation]=d,d.annotation in i||(i[d.annotation]=[]),i[d.annotation].push([d.score,d]);r.scores=a,delete r.word_annotation_score}for(let r in i){const a=i[r];a.sort((_,m)=>m[0]-_[0]);let d=0;for(let _=0;_<a.length;_++){const m=a[_];_>0&&a[_-1][0]!==m[0]&&(d=_),m[1].order=d}}this.document=s})}}});var me={list(e,t){const s=t!==void 0?`&doc_id=${t}`:"";return v.get(`hilt/projects/${e}/dict/local/?page_size=10000`+s)},create(e,t){return v.post(`hilt/projects/${e}/dict/local/`,t)},delete(e,t){return v.delete(`hilt/projects/${e}/dict/local/${t}/`)}};const de=z({id:"dictionary_local",state:()=>({documents:{},annotatedDocCount:0}),getters:{getByDocumentID:e=>t=>e.documents[t],fetchIfExists:e=>(t,s,i)=>{if(!(t in e.documents))return null;const r=e.documents[t];if(!(s in r))return null;const a=r[s];return i in a?a[i]:null},getLocalInfo:e=>e},actions:{fetchDictionary(e){const t=W();return me.list(t.getProjectInfo.id,e).then(s=>{const i=s.results,r={};let a=0;for(let d of i){const _=d.word.document;_ in r||(r[_]={},a+=1);const m=d.word.id;m in r[_]||(r[_][m]={});const h=d.annotation;r[_][m][h]=d}this.documents=r,this.annotatedDocCount=a,console.log(`dictionaryLocal -> fetchDictionary: annotatedDocCount ${a}`)})},addWord(e,t){const s=W();return me.create(s.getProjectInfo.id,t).then(()=>{this.fetchDictionary(e)})},deleteWord(e){const t=W();return me.delete(t.getProjectInfo.id,e).then(()=>this.fetchDictionary())}}});const an={name:"LocalSideBar",components:{Back:ce,Check:Se},setup(){const e=le(),t=xe(),s=Y(),i=de();return{documentStore:e,detailedDocumentStore:t,labelStore:s,localDictionaryStore:i}},data(){return{docs:[]}},created(){const e=[];e.push(this.labelStore.fetchLabels()),e.push(this.documentStore.resetState().then(()=>this.localDictionaryStore.fetchDictionary(this.documentStore.getDocuments[this.documentStore.getdocumentInfo.curDocIndex].id))),Promise.all(e).then(()=>{this.detailedDocumentStore.fetchDocument(this.documentStore.getDocuments[this.documentStore.getdocumentInfo.curDocIndex].id),this.docs=this.documentStore.getDocuments,console.log("updating docs data")})},methods:{pageChanged(e){this.documentStore.updateCurPage(e).then(t=>{this.docs=t.results.results,console.log("updating docs data"),this.detailedDocumentStore.fetchDocument(this.documentStore.getDocuments[this.documentStore.getdocumentInfo.curDocIndex].id)})},goToDocument(e,t){this.documentStore.setCurDocIndex(e),this.detailedDocumentStore.fetchDocument(t.id),this.localDictionaryStore.fetchDictionary(t.id)}}},cn=e=>(R("data-v-4c45ba7b"),e=e(),G(),e),dn=cn(()=>u("span",null,"Back",-1)),un={key:0},_n={key:1};function pn(e,t,s,i,r,a){const d=l("Back"),_=l("el-icon"),m=l("el-menu-item"),h=l("el-menu"),f=l("Check"),y=l("el-table-column"),w=l("el-link"),b=l("el-table"),I=l("el-pagination"),C=l("el-col"),$=ie("snip");return c(),S(C,null,{default:n(()=>[o(h,null,{default:n(()=>[o(m,{onClick:t[0]||(t[0]=()=>this.$router.push({name:"DebugOverview"}))},{default:n(()=>[o(_,null,{default:n(()=>[o(d)]),_:1}),dn]),_:1})]),_:1}),o(b,{data:Array.from(r.docs)},{default:n(()=>[o(y,{width:"40"},{default:n(g=>[g.row.annotated?(c(),x("span",un,[o(_,null,{default:n(()=>[o(f)]),_:1})])):(c(),x("div",_n,j(i.documentStore.getdocumentInfo.pageSize*(i.documentStore.getdocumentInfo.curPage-1)+g.$index+1),1))]),_:1}),o(y,{prop:"text"},{default:n(g=>[ae((c(),S(w,{onClick:F=>a.goToDocument(g.$index,g.row)},{default:n(()=>[p(j(g.row.text),1)]),_:2},1032,["onClick"])),[[$,{lines:3}]])]),_:1})]),_:1},8,["data"]),o(I,{background:"",layout:"prev, pager, next",total:i.documentStore.getdocumentInfo.totalDocCount,"page-size":i.documentStore.getdocumentInfo.pageSize,"current-page":i.documentStore.getdocumentInfo.curPage,onCurrentChange:a.pageChanged,style:{"text-align":"center"}},null,8,["total","page-size","current-page","onCurrentChange"])]),_:1})}var mn=M(an,[["render",pn],["__scopeId","data-v-4c45ba7b"]]),ke={list(e,t,s,i){const r={};return t&&(r.page=t),s!=null&&(r.page_size=s),i!=null&&(r.q=i),v.get(`hilt/projects/${e}/words/`,{params:r})},documents(e,t){return v.get(`hilt/projects/${e}/words/${t}/`)}};const ue=z({id:"words",state:()=>({words:[],curPage:1,maxPage:1,totalWordCount:0,curWordIndex:0,pageSize:10,currDocuments:[],searchQuery:void 0,wordLoaded:!1}),getters:{getWords:e=>e.words,getWordInfo:e=>e,getCurrWord:e=>()=>e.words[e.curWordIndex]?e.words[e.curWordIndex].text:void 0,getDocuments:e=>e.currDocuments},actions:{resetState(e=void 0){return this.curPage=1,this.pageSize=10,this.currDocuments=[],this.searchQuery=e,this.fetchWords()},setCurWordIndex(e){this.curWordIndex=e},fetchWords(){const e=W();return ke.list(e.getProjectInfo.id,this.curPage,this.pageSize,this.searchQuery).then(t=>(this.words=t.results,this.totalWordCount=t.count,this.maxPage=Math.ceil(this.totalWordCount/this.pageSize),t))},updateCurPage(e){return this.curPage=e,this.curWordIndex=0,this.currDocuments=[],this.fetchWords()},fetchDocuments(){this.wordLoaded=!1;const e=W();return ke.documents(e.getProjectInfo.id,this.getCurrWord()).then(t=>{for(const s of t.results)for(let i of s.words){const r={};for(let a of i.word_annotation_score)r[a.annotation]=a;i.scores=r,delete i.word_annotation_score}this.currDocuments=t.results,this.wordLoaded=!0})}}});var he={list(e,t){const s=t!==void 0?`&q=${t}`:"";return v.get(`hilt/projects/${e}/dict/global/?page_size=10000`+s)},create(e,t){return v.post(`hilt/projects/${e}/dict/global/`,t)},update(e,t){return v.put(`hilt/projects/${e}/dict/global/${t.id}/`,t)},delete(e,t){return v.delete(`hilt/projects/${e}/dict/global/${t}/`)}};const _e=z({id:"dictionary_global",state:()=>({words:{},wordRows:[]}),getters:{getWords:e=>e.words,getRows:e=>e.wordRows,containsWord:e=>t=>t in e.words},actions:{fetchDictionary(e=void 0){const t=W();return he.list(t.getProjectInfo.id,e).then(s=>{const i=s.results,r={},a=[];for(let d of i)r[d.word]=a.length,a.push(d);this.words=r,this.wordRows=a})},addWord(e,t,s){const i=W();return he.create(i.getProjectInfo.id,{word:e,modification_type:t,ground_truth_label:s}).then(r=>{this.words[e]=this.wordRows.length,this.wordRows.push(r),console.log(`added global word ${e}`)})},deleteWord(e){console.log(`deleted global word ${e}`);const t=W();return he.delete(t.getProjectInfo.id,this.wordRows[this.words[e]].id).then(()=>this.fetchDictionary())}}});const hn={name:"GlobalSideBar",components:{Back:ce,Check:Se,Search:ye},setup(){const e=Y(),t=ue(),s=_e();return{labelStore:e,wordStore:t,globalDictionaryStore:s}},data(){return{searchQuery:""}},watch:{searchQuery:function(e,t){console.log(e),e===""?this.wordStore.resetState().then(()=>{this.wordStore.fetchDocuments()}):this.wordStore.resetState(e).then(()=>{this.wordStore.fetchDocuments()})}},created(){this.$route.query.q!==void 0&&(this.searchQuery=this.$route.query.q);const e=[];e.push(this.labelStore.fetchLabels()),e.push(this.globalDictionaryStore.fetchDictionary()),this.searchQuery===""?e.push(this.wordStore.resetState()):e.push(this.wordStore.resetState(this.searchQuery)),Promise.all(e).then(()=>{this.wordStore.fetchDocuments()})},methods:{tableRowStyle({row:e}){return this.globalDictionaryStore.containsWord(e.text)?this.globalDictionaryStore.getRows[this.globalDictionaryStore.getWords[e.text]].modification_type==0?{color:"white",backgroundColor:"#67C23A"}:{color:"white",backgroundColor:"#F56C6C"}:{}},pageChanged(e){this.wordStore.updateCurPage(e).then(()=>{this.wordStore.fetchDocuments()})},goToDocument(e){this.wordStore.setCurWordIndex(e),this.wordStore.fetchDocuments()}}},fn=e=>(R("data-v-5cdc2f13"),e=e(),G(),e),gn=fn(()=>u("span",null,"Back",-1)),yn={style:{"align-content":"center"}},Sn={key:0},bn={key:1};function xn(e,t,s,i,r,a){const d=l("Back"),_=l("el-icon"),m=l("el-menu-item"),h=l("el-menu"),f=l("Search"),y=l("el-input"),w=l("Check"),b=l("el-table-column"),I=l("el-link"),C=l("el-table"),$=l("el-pagination"),g=l("el-col"),F=ie("snip");return c(),S(g,null,{default:n(()=>[o(h,null,{default:n(()=>[o(m,{onClick:t[0]||(t[0]=()=>this.$router.push({name:"DebugOverview"}))},{default:n(()=>[o(_,null,{default:n(()=>[o(d)]),_:1}),gn]),_:1})]),_:1}),o(y,{modelValue:r.searchQuery,"onUpdate:modelValue":t[1]||(t[1]=D=>r.searchQuery=D),placeholder:"Type to search for words",style:{"margin-top":"20px",width:"90%"},clearable:""},{prefix:n(()=>[u("div",yn,[o(_,null,{default:n(()=>[o(f)]),_:1})])]),_:1},8,["modelValue"]),o(C,{data:Array.from(i.wordStore.getWords),"row-style":a.tableRowStyle},{default:n(()=>[o(b,{width:"40"},{default:n(D=>[i.globalDictionaryStore.containsWord(D.row.text)?(c(),x("span",Sn,[o(_,null,{default:n(()=>[o(w)]),_:1})])):(c(),x("div",bn,j(i.wordStore.getWordInfo.pageSize*(i.wordStore.getWordInfo.curPage-1)+D.$index+1),1))]),_:1}),o(b,{prop:"text"},{default:n(D=>[ae((c(),S(I,{key:D.row.text,onClick:P=>a.goToDocument(D.$index)},{default:n(()=>[p(j(D.row.text),1)]),_:2},1032,["onClick"])),[[F,{lines:3}]])]),_:1})]),_:1},8,["data","row-style"]),o($,{background:"",layout:"prev, pager, next",total:i.wordStore.getWordInfo.totalWordCount,"page-size":i.wordStore.getWordInfo.pageSize,"current-page":i.wordStore.getWordInfo.curPage,onCurrentChange:a.pageChanged,style:{"text-align":"center"}},null,8,["total","page-size","current-page","onCurrentChange"])]),_:1})}var Dn=M(hn,[["render",xn],["__scopeId","data-v-5cdc2f13"]]);const wn={name:"DebugPage",components:{OverviewSideBar:sn,LocalSideBar:mn,GlobalSideBar:Dn}};function vn(e,t,s,i,r,a){const d=l("OverviewSideBar"),_=l("LocalSideBar"),m=l("GlobalSideBar"),h=l("el-aside"),f=l("router-view"),y=l("el-main"),w=l("el-container");return c(),x("div",null,[o(w,null,{default:n(()=>[o(h,{style:{"border-right":"solid 1px #e6e6e6"}},{default:n(()=>[this.$route.path.endsWith("/overview")||this.$route.path.endsWith("/dictionary")||this.$route.path.endsWith("/evaluation")?(c(),S(d,{key:0,style:{width:"100%"}})):A("",!0),this.$route.path.endsWith("/local")?(c(),S(_,{key:1,style:{width:"100%"}})):A("",!0),this.$route.path.endsWith("/global")?(c(),S(m,{key:2,style:{width:"100%"}})):A("",!0)]),_:1}),o(y,null,{default:n(()=>[o(f)]),_:1})]),_:1})])}var kn=M(wn,[["render",vn]]),We={train(e){return v.post(`hilt/projects/${e}/debug/training/`,{headers:E({},v.defaults.headers)})}};const In={name:"DebugOverview",components:{QuestionFilled:X},setup(){const e=W(),t=le(),s=_e(),i=de(),r=ue();return{projectStore:e,documentStore:t,globalDictionaryStore:s,localDictionaryStore:i,wordStore:r}},created(){const e=[];e.push(this.globalDictionaryStore.fetchDictionary()),e.push(this.localDictionaryStore.fetchDictionary()),e.push(this.documentStore.fetchDocuments()),e.push(this.wordStore.resetState()),Promise.all(e).then(()=>{this.wordStore.fetchDocuments()})},methods:{getInstanceProgressBarLabel(){let e=this.documentStore.getdocumentInfo;return`${this.localDictionaryStore.getLocalInfo.annotatedDocCount} / ${e.totalDocCount} sentences annotated`},getTaskProgressBarLabel(){return`${this.globalDictionaryStore.getRows.length} / ${this.wordStore.getWordInfo.totalWordCount} words annotated`},fetchDebugScores(e){return H.detailedDocument(this.projectStore.getProjectInfo.id,e).then(t=>{console.log(t),console.log(t.words);for(let s of t.words)console.log("word:",s.text),console.log("initial score:",s.word_annotation_score[0].score)})},trainDebugModel(){We.train(this.projectStore.getProjectInfo.id).then(e=>{console.log("Here"),console.log(e),this.waitForCompletion(),J({title:"Debug Training Started",message:"Page will automatically change once task is completed",type:"success",duration:0})}).catch(e=>{e.response&&e.response.data?this.$notify.error({title:"Model training failed",message:e.response.data}):this.$notify.error({title:"Model failed to start training",message:"Please try again later"})}),this.fetchDebugScores(this.documentStore.getDocuments[1].id)},waitForCompletion(){}},computed:{instanceAnnotationCompletionPercentage(){let e=this.documentStore.getdocumentInfo,t=this.localDictionaryStore.getLocalInfo;return e.totalDocCount==0?0:100*t.annotatedDocCount/e.totalDocCount},taskAnnotationCompletionPercentage(){let e=this.wordStore.getWordInfo;return e.totalWordCount==0?0:100*Array.from(this.globalDictionaryStore.getRows).length/e.totalWordCount}}},$n=p(" Debug Overview Page "),Cn=p(" Start Debug Training "),Fn=p(),jn=u("br",null,null,-1),Pn=u("span",{style:{"padding-right":"1em"}},"Instance Explanation",-1),Ln=p(" Start Annotating "),Wn=u("span",{style:{"padding-right":"1em"}},"Task Explanation",-1),Mn=p(" Start Annotating ");function An(e,t,s,i,r,a){const d=l("QuestionFilled"),_=l("el-icon"),m=l("el-popover"),h=l("el-button"),f=l("el-progress"),y=l("el-row");return c(),x(L,null,[u("h3",null,[$n,o(m,{content:"Overview of Human Debugging Phase./n Perform task and instance annotation to start debugging phase",trigger:"hover",width:400},{reference:n(()=>[o(_,{style:{height:"100%","margin-left":"0.5rem"}},{default:n(()=>[o(d)]),_:1})]),_:1})]),o(h,{type:"primary",onClick:t[0]||(t[0]=w=>a.trainDebugModel())},{default:n(()=>[Cn]),_:1}),Fn,jn,o(y,{style:{width:"100%","margin-top":"3em"}},{default:n(()=>[Pn,o(h,{size:"small",onClick:t[1]||(t[1]=()=>this.$router.push({name:"DebugLocal"}))},{default:n(()=>[Ln]),_:1}),o(f,{style:{width:"100%","margin-top":"1em"},percentage:a.instanceAnnotationCompletionPercentage,format:a.getInstanceProgressBarLabel,type:"line","stroke-width":30,"text-inside":""},null,8,["percentage","format"])]),_:1}),o(y,{style:{width:"100%","margin-top":"3em"}},{default:n(()=>[Wn,o(h,{size:"small",onClick:t[2]||(t[2]=()=>this.$router.push({name:"DebugGlobal"}))},{default:n(()=>[Mn]),_:1}),o(f,{style:{width:"100%","margin-top":"1em"},percentage:a.taskAnnotationCompletionPercentage,format:a.getTaskProgressBarLabel,type:"line","stroke-width":30,"text-inside":""},null,8,["percentage","format"])]),_:1})],64)}var Tn=M(In,[["render",An]]);const Bn={name:"LocalExplanations",components:{ArrowLeft:je,ArrowRight:Pe,Delete:se},setup(){const e=le(),t=xe(),s=W(),i=de(),r=Y();return{documentStore:e,detailedDocumentStore:t,projectStore:s,localDictionaryStore:i,labelStore:r,TaskTypes:U,getLabelByID:r.getLabelByID}},data(){return{topK:3}},methods:{wordDelete(e){console.log("vue delete word"),this.localDictionaryStore.deleteWord(e).then(this.updateAnnotation())},wordClick(e,t,s){const i=this.detailedDocumentStore.getDocument.id,r=this.localDictionaryStore.fetchIfExists(i,t,e);r===null?s>=0&&this.localDictionaryStore.addWord(i,{word:t,annotation:e,modification_type:s}).then(()=>this.updateAnnotation()):s==-1&&this.wordDelete(r.id)},getColors(e){const t=this.getLabelByID(e);return N[t.color_set].colors},getWordStyle(e,t){const s={padding:"3px 3px 3px 3px",margin:"3px 3px 3px 3px",fontSize:"18px"};if(this.topK>0&&e.order>=this.topK)return s;const i=e.score,r=this.getColors(t);let a=-1;return i<=0?s:(i<=.33?a=0:i<=.66?a=1:i<=1&&(a=2),E(E({},s),r[a]))},getProgressBarLabel(){let e=this.documentStore.getdocumentInfo;return`${e.annotatedDocCount} / ${e.totalDocCount} documents annotated`},goToPrevDoc(){this.updateAnnotation();const e=this.documentStore.getdocumentInfo.curDocIndex-1;e==-1?this.documentStore.updateCurPage(this.documentStore.getdocumentInfo.curPage-1).then(()=>{this.documentStore.setCurDocIndex(this.documentStore.getDocuments.length-1),this.detailedDocumentStore.fetchDocument(this.documentStore.getDocuments[this.documentStore.getDocuments.length-1].id)}):(this.documentStore.setCurDocIndex(e),this.detailedDocumentStore.fetchDocument(this.documentStore.getDocuments[e].id))},goToNextDoc(){this.updateAnnotation();const e=this.documentStore.getdocumentInfo.curDocIndex+1;this.documentStore.getDocuments.length==e?this.documentStore.updateCurPage(this.documentStore.getdocumentInfo.curPage+1).then(()=>{this.detailedDocumentStore.fetchDocument(this.documentStore.getDocuments[0].id),this.localDictionaryStore.fetchDictionary(this.documentStore.getDocuments[0].id)}):(this.documentStore.setCurDocIndex(e),this.detailedDocumentStore.fetchDocument(this.documentStore.getDocuments[e].id),this.localDictionaryStore.fetchDictionary(this.documentStore.getDocuments[e].id))},noAnnotation(){this.documentStore.markAnnotated().then(()=>{const e=this.documentStore.getdocumentInfo.curDocIndex+1;this.documentStore.getDocuments.length!==e&&this.documentStore.getdocumentInfo.curPage!==this.documentStore.getdocumentInfo.maxPage&&this.goToNextDoc()})},updateAnnotation(){const e=this.detailedDocumentStore.getDocument.id;this.localDictionaryStore.getByDocumentID(e)!==void 0?(console.log("Marking Annotated"),this.documentStore.markAnnotated(!0)):(console.log("Unmarking Annotated"),this.documentStore.markAnnotated(!1))},trainDebugModel(){We.train(this.projectStore.getProjectInfo.id)}},computed:{annotationCompletionPercentage:function(){let e=this.documentStore.getdocumentInfo;return e.totalDocCount==0?0:100*e.annotatedDocCount/e.totalDocCount},dictTableData:function(){const e=this.detailedDocumentStore.getDocument.id,t=this.localDictionaryStore.getByDocumentID(e),s=[];if(e===void 0||t===void 0)return s;const i=this.detailedDocumentStore.getDocument.words;for(const r of i){const a=r.id;if(!(a in t))continue;const d=t[a];for(const _ in d){const m=d[_].id,h=r.scores[_].score;let f;for(const y of this.detailedDocumentStore.getDocument.annotations)if(y.id==_){f=y.label;break}s.push({id:m,word:r.text,score:{score:h,order:0},label:f,type:d[_].modification_type})}}return s}}},En={style:{display:"flex","align-items":"center","justify-content":"space-between"}},Vn={style:{"text-align":"center"}},Un={style:{width:"100%"}},On={key:0,class:"demonstration"},zn={key:1,class:"demonstration"},Nn=p("Words"),Qn=p("Model Output"),Rn={style:{"text-align":"right",margin:"0"}},Gn=p(" add "),qn=p(" remove "),Jn=p(" reset "),Hn=p("Add"),Kn=p("Remove"),Zn=p("Delete"),Xn=p(" Prev "),Yn=p(" Next "),el=p(" Skip (Nothing to Mark Up)"),tl=p(" Submit ");function ol(e,t,s,i,r,a){const d=l("el-row"),_=l("el-slider"),m=l("el-tag"),h=l("el-divider"),f=l("el-button"),y=l("el-popover"),w=l("el-col"),b=l("el-table-column"),I=l("Delete"),C=l("el-icon"),$=l("el-popconfirm"),g=l("el-table"),F=l("el-card"),D=l("ArrowLeft"),P=l("ArrowRight");return c(),x(L,null,[o(d,{style:{width:"100%"}},{default:n(()=>[o(d,{style:{width:"100%"}},{default:n(()=>[u("div",En,[u("h1",Vn," Annotate page ("+j(i.TaskTypes[this.projectStore.task])+") ",1)])]),_:1}),o(d,{style:{width:"100%"}},{default:n(()=>[u("div",Un,[r.topK>0?(c(),x("span",On,"Top "+j(r.topK)+" words",1)):A("",!0),r.topK==0?(c(),x("span",zn,"All words")):A("",!0),o(_,{modelValue:r.topK,"onUpdate:modelValue":t[0]||(t[0]=k=>r.topK=k),max:this.detailedDocumentStore.getMaxWords},null,8,["modelValue","max"])])]),_:1}),this.detailedDocumentStore.getDocument?(c(),S(F,{key:0,style:{width:"100%","margin-top":"10px"}},{default:n(()=>[o(d,null,{default:n(()=>[o(w,{span:16},{default:n(()=>[o(d,null,{default:n(()=>[o(m,null,{default:n(()=>[Nn]),_:1}),"ground_truth"in this.detailedDocumentStore.getDocument?(c(),S(m,{key:0,style:{"margin-left":"10px"}},{default:n(()=>[p(" Ground truth: "+j(i.getLabelByID(this.detailedDocumentStore.getDocument.ground_truth).text),1)]),_:1})):A("",!0)]),_:1}),o(d,{style:{"line-height":"2","margin-top":"10px"}},{default:n(()=>[(c(!0),x(L,null,B(this.detailedDocumentStore.getDocument.words,k=>(c(),x("span",{style:{padding:"3px","font-size":"18px"},key:k.id},j(k.text),1))),128))]),_:1}),o(h),(c(!0),x(L,null,B(this.detailedDocumentStore.getDocument.annotations,k=>(c(),S(d,{style:{"margin-top":"10px"},key:k.id},{default:n(()=>[o(d,{style:{width:"100%"}},{default:n(()=>[o(m,{style:{"margin-right":"10px"}},{default:n(()=>[Qn]),_:1}),o(m,null,{default:n(()=>[p("Label: "+j(i.getLabelByID(k.label).text),1)]),_:2},1024)]),_:2},1024),o(d,{style:{"line-height":"2","margin-top":"10px"}},{default:n(()=>[(c(!0),x(L,null,B(this.detailedDocumentStore.getDocument.words,T=>(c(),x("span",{key:T.id,style:O(a.getWordStyle(T.scores[k.id],k.label))},[o(y,{trigger:"hover",width:"200px"},{reference:n(()=>[u("span",null,j(T.text),1)]),default:n(()=>[u("p",null,j(T.text+": "+T.scores[k.id].score),1),u("div",Rn,[o(f,{size:"small",type:"success",onClick:te=>a.wordClick(k.id,T.id,0)},{default:n(()=>[Gn]),_:2},1032,["onClick"]),o(f,{size:"small",type:"primary",onClick:te=>a.wordClick(k.id,T.id,1)},{default:n(()=>[qn]),_:2},1032,["onClick"]),o(f,{size:"small",type:"info",onClick:te=>a.wordClick(k.id,T.id,-1)},{default:n(()=>[Jn]),_:2},1032,["onClick"])])]),_:2},1024)],4))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1}),o(w,{span:8},{default:n(()=>[o(g,{data:a.dictTableData,border:"",style:{width:"100%"}},{default:n(()=>[o(b,{label:"Word"},{default:n(k=>[u("span",{style:O(a.getWordStyle(k.row.score,k.row.label))},j(k.row.word),5)]),_:1}),o(b,{label:"Type"},{default:n(k=>[k.row.type==0?(c(),S(m,{key:0,type:"success"},{default:n(()=>[Hn]),_:1})):A("",!0),k.row.type==1?(c(),S(m,{key:1,type:"danger"},{default:n(()=>[Kn]),_:1})):A("",!0)]),_:1}),o(b,{label:"Operations"},{default:n(k=>[o($,{title:"Are you sure?",onConfirm:T=>a.wordDelete(k.row.id),style:{"margin-left":"10px"}},{reference:n(()=>[o(f,{size:"small",type:"danger"},{default:n(()=>[o(C,null,{default:n(()=>[o(I)]),_:1}),Zn]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1})]),_:1})):A("",!0),o(d,{style:{"margin-top":"20px",width:"100%"}},{default:n(()=>[o(w,{style:{display:"flex","justify-content":"space-between"}},{default:n(()=>[o(f,{type:"primary",onClick:t[1]||(t[1]=k=>a.goToPrevDoc()),disabled:this.documentStore.getdocumentInfo.curDocIndex===0&&this.documentStore.getdocumentInfo.curPage===1},{default:n(()=>[o(C,null,{default:n(()=>[o(D)]),_:1}),Xn]),_:1},8,["disabled"]),o(f,{type:"primary",onClick:t[2]||(t[2]=k=>a.goToNextDoc()),disabled:this.documentStore.getdocumentInfo.curDocIndex===this.documentStore.getdocumentInfo.documents.length-1&&this.documentStore.getdocumentInfo.curPage===this.documentStore.getdocumentInfo.maxPage},{default:n(()=>[Yn,o(C,null,{default:n(()=>[o(P)]),_:1})]),_:1},8,["disabled"])]),_:1})]),_:1}),this.detailedDocumentStore.getDocument?(c(),S(d,{key:1,style:{"margin-top":"10px",width:"100%"}},{default:n(()=>[o(w,{style:{display:"flex","justify-content":"flex-end"}},{default:n(()=>[o(f,{type:"primary",onClick:a.noAnnotation},{default:n(()=>[el,o(C,null,{default:n(()=>[o(P)]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1})):A("",!0)]),_:1}),o(d,null,{default:n(()=>[o(f,{type:"primary",onClick:t[3]||(t[3]=k=>a.trainDebugModel())},{default:n(()=>[tl]),_:1})]),_:1})],64)}var nl=M(Bn,[["render",ol]]);const ll={name:"GlobalExplanations",components:{ArrowLeft:je,ArrowRight:Pe},setup(){const e=Y(),t=ue(),s=_e(),i=W();return{labelStore:e,wordStore:t,globalDictionaryStore:s,projectStore:i,TaskTypes:U,getLabelByID:e.getLabelByID}},computed:{documents:function(){return this.wordStore.getDocuments}},methods:{addWord(e){this.globalDictionaryStore.addWord(this.wordStore.getCurrWord(),e,this.getLabelByID(this.documents[0].ground_truth).id)},getColors(e){const t=this.getLabelByID(e);return N[t.color_set].colors},getWordStyle(e,t){const s={padding:"3px 3px 3px 3px",margin:"3px 3px 3px 3px",fontSize:"18px"},i=e.score,r=this.getColors(t);let a=-1;return i<=0?s:(i<=.33?a=0:i<=.66?a=1:i<=1&&(a=2),E(E({},s),r[a]))},goToPrevWord(){const e=this.wordStore.getWordInfo.curWordIndex-1;e==-1?this.wordStore.updateCurPage(this.wordStore.getWordInfo.curPage-1).then(()=>{this.wordStore.setCurWordIndex(this.wordStore.getWords.length-1),this.wordStore.fetchDocuments()}):(this.wordStore.setCurWordIndex(e),this.wordStore.fetchDocuments())},goToNextWord(){const e=this.wordStore.getWordInfo.curWordIndex+1;this.wordStore.getWords.length==e?this.wordStore.updateCurPage(this.wordStore.getWordInfo.curPage+1).then(()=>{this.wordStore.fetchDocuments()}):(this.wordStore.setCurWordIndex(e),this.wordStore.fetchDocuments())}}},rl={style:{display:"flex","align-items":"center","justify-content":"space-between"}},sl={style:{"text-align":"center"}},il=p(" Prev "),al=p(" Next "),cl=p(" Current Word: "),dl={style:{"margin-left":"10px",display:"inline-block"}},ul=p(" add "),_l=p(" remove "),pl=p(" reset ");function ml(e,t,s,i,r,a){const d=l("el-row"),_=l("ArrowLeft"),m=l("el-icon"),h=l("el-button"),f=l("ArrowRight"),y=l("el-col"),w=l("el-tag"),b=l("el-popover"),I=l("el-divider"),C=l("el-card");return c(),S(d,{style:{width:"100%"}},{default:n(()=>[o(d,{style:{width:"100%"}},{default:n(()=>[u("div",rl,[u("h1",sl," Annotate page ("+j(i.TaskTypes[this.projectStore.task])+") ",1)])]),_:1}),i.wordStore.getCurrWord()!==void 0?(c(),S(d,{key:0,style:{"margin-top":"20px",width:"100%"}},{default:n(()=>[o(y,{style:{display:"flex","justify-content":"space-between"}},{default:n(()=>[o(h,{type:"primary",onClick:t[0]||(t[0]=$=>a.goToPrevWord()),disabled:this.wordStore.getWordInfo.curWordIndex===0&&this.wordStore.getWordInfo.curPage===1},{default:n(()=>[o(m,null,{default:n(()=>[o(_)]),_:1}),il]),_:1},8,["disabled"]),o(h,{type:"primary",onClick:t[1]||(t[1]=$=>a.goToNextWord()),disabled:this.wordStore.getWordInfo.curWordIndex===this.wordStore.getWordInfo.words.length-1&&this.wordStore.getWordInfo.curPage===this.wordStore.getWordInfo.maxPage},{default:n(()=>[al,o(m,null,{default:n(()=>[o(f)]),_:1})]),_:1},8,["disabled"])]),_:1})]),_:1})):A("",!0),i.wordStore.wordLoaded?(c(),S(C,{key:1,style:{width:"100%","margin-top":"10px"}},{header:n(()=>[u("div",null,[cl,u("b",null,j(this.wordStore.getCurrWord()),1),u("div",dl,[i.globalDictionaryStore.containsWord(i.wordStore.getCurrWord())?A("",!0):(c(),S(h,{key:0,size:"small",type:"success",onClick:t[2]||(t[2]=$=>a.addWord(0))},{default:n(()=>[ul]),_:1})),i.globalDictionaryStore.containsWord(i.wordStore.getCurrWord())?A("",!0):(c(),S(h,{key:1,size:"small",type:"primary",onClick:t[3]||(t[3]=$=>a.addWord(1))},{default:n(()=>[_l]),_:1})),i.globalDictionaryStore.containsWord(i.wordStore.getCurrWord())?(c(),S(h,{key:2,size:"small",type:"info",onClick:t[4]||(t[4]=$=>i.globalDictionaryStore.deleteWord(i.wordStore.getCurrWord()))},{default:n(()=>[pl]),_:1})):A("",!0)])])]),default:n(()=>[(c(!0),x(L,null,B(a.documents,($,g)=>(c(),S(d,{style:{width:"100%"},key:$.id},{default:n(()=>[(c(!0),x(L,null,B($.annotations,F=>(c(),S(d,{style:{width:"100%"},key:F.id},{default:n(()=>[o(d,{style:{width:"100%"}},{default:n(()=>[o(w,null,{default:n(()=>[p("Document #"+j(g+1),1)]),_:2},1024),"ground_truth"in $?(c(),S(w,{key:0,style:{"margin-left":"10px"}},{default:n(()=>[p(" Ground truth: "+j(i.getLabelByID($.ground_truth).text),1)]),_:2},1024)):A("",!0),o(w,{style:{"margin-left":"10px"}},{default:n(()=>[p(" Prediction: "+j(i.getLabelByID(F.label).text),1)]),_:2},1024)]),_:2},1024),o(d,{style:{"line-height":"2","margin-top":"10px"}},{default:n(()=>[u("div",null,[(c(!0),x(L,null,B($.words,D=>(c(),x("span",{key:D.id,style:O(a.getWordStyle(D.scores[F.id],F.label))},[o(b,{content:D.text+": "+D.scores[F.id].score,trigger:"hover"},{reference:n(()=>[u("span",{style:O(D.text===this.wordStore.getCurrWord()?{border:"2px solid black"}:{})},j(D.text),5)]),_:2},1032,["content"])],4))),128))])]),_:2},1024)]),_:2},1024))),128)),o(I)]),_:2},1024))),128))]),_:1})):A("",!0)]),_:1})}var hl=M(ll,[["render",ml]]);const fl={name:"DictionaryOverview",components:{Search:ye,Delete:se},setup(){return{dictionaryStore:_e()}},data(){return{searchQuery:""}},watch:{searchQuery:function(e,t){this.dictionaryStore.fetchDictionary(e)}},methods:{indexMethod(e){return e+1},onClick(e,t){this.$router.push({name:"DebugGlobal",query:{q:t.word}})},handleDelete(e,t){this.dictionaryStore.deleteWord(t.word).then(()=>{this.dictionaryStore.fetchDictionary()})}},created(){this.dictionaryStore.fetchDictionary()}},gl={style:{"text-align":"center"}},yl=u("div",null,[u("h1",null,"Task Dictionary")],-1),Sl={style:{"align-content":"center"}},bl=["onClick"],xl=p("Delete");function Dl(e,t,s,i,r,a){const d=l("Search"),_=l("el-icon"),m=l("el-input"),h=l("el-table-column"),f=l("Delete"),y=l("el-button"),w=l("el-popconfirm"),b=l("el-table");return c(),x("div",null,[u("div",gl,[yl,o(m,{modelValue:r.searchQuery,"onUpdate:modelValue":t[0]||(t[0]=I=>r.searchQuery=I),modelModifiers:{lazy:!0,trim:!0},placeholder:"Type to search for words",style:{width:"50%"},clearable:""},{prefix:n(()=>[u("div",Sl,[o(_,null,{default:n(()=>[o(d)]),_:1})])]),_:1},8,["modelValue"])]),o(b,{data:Array.from(i.dictionaryStore.getRows),stripe:""},{default:n(()=>[o(h,{type:"index",index:a.indexMethod},null,8,["index"]),o(h,{label:"Text",sortable:""},{default:n(I=>[u("p",{onClick:C=>a.onClick(I.$index,I.row),style:{cursor:"pointer"}},j(I.row.word),9,bl)]),_:1}),o(h,{label:"Operations"},{default:n(I=>[o(w,{title:"Are you sure?",onConfirm:C=>a.handleDelete(I.$index,I.row),style:{"margin-left":"10px"}},{reference:n(()=>[o(y,{size:"small",type:"danger"},{default:n(()=>[o(_,null,{default:n(()=>[o(f)]),_:1}),xl]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])])}var wl=M(fl,[["render",Dl]]);const vl={name:"DebugEvaluation",components:{Back:ce,Check:Se,Download:ge},setup(){const e=le(),t=xe(),s=Y(),i=de(),r=W(),a=ue();return{documentStore:e,detailedDocumentStore:t,labelStore:s,localDictionaryStore:i,projectStore:r,wordStore:a,getLabelByID:s.getLabelByID}},created(){const e=[];e.push(this.labelStore.fetchLabels()),e.push(this.documentStore.resetState().then(()=>this.localDictionaryStore.fetchDictionary(this.documentStore.getDocuments[this.documentStore.getdocumentInfo.curDocIndex].id))),Promise.all(e).then(()=>{this.detailedDocumentStore.fetchDocument(this.documentStore.getDocuments[this.documentStore.getdocumentInfo.curDocIndex].id)}),this.getModelDetails()},data(){return{exampleInputsForm:{sentence_id:""},downloading:!1,model:{model_id:"",model_name:""},detailedSentence:[]}},computed:{getDocText(){return console.log("calling getDocTest"),console.log(this.exampleInputsForm.sentence_id),this.detailedSentence},documents:function(){return console.log("inside documents function"),console.log(this.detailedSentence),this.detailedSentence}},methods:{updateDetailedDoc(e){const t=[];t.push(this.detailedDocumentStore.fetchDocument(e)),Promise.all(t).then(()=>{this.detailedSentence=[this.detailedDocumentStore.getDocument]})},getModelDetails(){K.list(this.projectStore.getProjectInfo.id).then(e=>{console.log(e.results.at(-1));const t=e.results.at(-1);this.model.model_id=t.id,this.model.model_name=t.name})},modelDownload(){this.downloading=!0,K.downloadModel(this.projectStore.getProjectInfo.id,this.model.model_id).then(e=>{const t=new Blob([e.data],{type:"application/zip"}),s=document.createElement("a");s.href=URL.createObjectURL(t),s.download="model.zip",s.click(),URL.revokeObjectURL(s.href),this.downloading=!1}).catch(e=>{console.log(e),this.downloading=!1})},getColors(e){const t=this.getLabelByID(e);return N[t.color_set].colors},getWordStyle(e=0,t){const s={padding:"3px 3px 3px 3px",margin:"3px 3px 3px 3px",fontSize:"18px"},i=e.score,r=this.getColors(t);let a=-1;return i<=0?s:(i<=.33?a=0:i<=.66?a=1:i<=1&&(a=2),E(E({},s),r[a]))}}},kl=p("Evaluation Section "),Il={style:{"padding-right":"1em"}},$l=p("Model Selected: "),Cl=u("h4",null,"Example Input",-1),Fl=p("Before Debugging"),jl=p("After Debug Training");function Pl(e,t,s,i,r,a){const d=l("QuestionFilled"),_=l("el-icon"),m=l("el-popover"),h=l("Download"),f=l("el-button"),y=l("el-divider"),w=l("el-option"),b=l("el-select"),I=l("el-form-item"),C=l("el-form"),$=l("el-tag"),g=l("el-row"),F=l("el-card");return c(),S(g,{style:{width:"100%"}},{default:n(()=>[o(F,{style:{width:"100%"}},{header:n(()=>[u("h3",null,[kl,o(m,{content:"help text",trigger:"hover",width:400},{reference:n(()=>[o(_,{style:{height:"100%","margin-left":"0.5rem"}},{default:n(()=>[o(d)]),_:1})]),_:1})])]),default:n(()=>[o(g,null,{default:n(()=>[u("span",Il,[$l,u("b",null,j(r.model.model_name),1)]),o(f,{type:"primary",size:"small",loading:r.downloading,onClick:t[0]||(t[0]=D=>this.modelDownload())},{default:n(()=>[o(_,null,{default:n(()=>[o(h)]),_:1})]),_:1},8,["loading"]),o(y),Cl,o(C,{model:r.exampleInputsForm,size:"large",style:{width:"100%"}},{default:n(()=>[o(I,null,{default:n(()=>[o(b,{modelValue:r.exampleInputsForm.sentence_id,"onUpdate:modelValue":t[1]||(t[1]=D=>r.exampleInputsForm.sentence_id=D),placeholder:"Select a Sentence",size:"large",onChange:a.updateDetailedDoc,style:{width:"100%"}},{default:n(()=>[(c(!0),x(L,null,B(i.documentStore.getDocuments,D=>(c(),S(w,{key:D.id,label:D.text,value:D.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1})]),_:1},8,["model"]),(c(!0),x(L,null,B(r.detailedSentence,(D,P)=>(c(),S(g,{style:{width:"100%"},key:D.id},{default:n(()=>[(c(!0),x(L,null,B(D.annotations,k=>(c(),S(g,{style:{width:"100%"},key:k.id},{default:n(()=>[o(g,{style:{width:"100%"}},{default:n(()=>[o($,null,{default:n(()=>[p("Document #"+j(P+1),1)]),_:2},1024),"ground_truth"in D?(c(),S($,{key:0,style:{"margin-left":"10px"}},{default:n(()=>[p(" Ground truth: "+j(i.getLabelByID(D.ground_truth).text),1)]),_:2},1024)):A("",!0),o($,{style:{"margin-left":"10px"}},{default:n(()=>[p(" Prediction: "+j(i.getLabelByID(k.label).text),1)]),_:2},1024)]),_:2},1024),o(g,{style:{width:"100%","margin-top":"10px"}},{default:n(()=>[o($,{type:"warning"},{default:n(()=>[Fl]),_:1})]),_:1}),o(g,{style:{"line-height":"2","margin-top":"10px"}},{default:n(()=>[u("div",null,[(c(!0),x(L,null,B(D.words,T=>(c(),x("span",{key:T.id,style:O(a.getWordStyle(T.scores[k.id],k.label))},[o(m,{content:T.text+": "+T.scores[k.id].score,trigger:"hover"},{reference:n(()=>[u("span",null,j(T.text),1)]),_:2},1032,["content"])],4))),128))])]),_:2},1024)]),_:2},1024))),128)),o(y)]),_:2},1024))),128)),(c(!0),x(L,null,B(r.detailedSentence,(D,P)=>(c(),S(g,{style:{width:"100%"},key:D.id},{default:n(()=>[(c(!0),x(L,null,B(D.annotations,k=>(c(),S(g,{style:{width:"100%"},key:k.id},{default:n(()=>[o(g,{style:{width:"100%"}},{default:n(()=>[o($,{type:"warning"},{default:n(()=>[jl]),_:1})]),_:1}),o(g,{style:{"line-height":"2","margin-top":"10px"}},{default:n(()=>[u("div",null,[(c(!0),x(L,null,B(D.words,T=>{var te;return c(),x("span",{key:T.id,style:O(a.getWordStyle((te=T.word_debug_annotation_score)==null?void 0:te[k.id],k.label))},[o(m,{content:T.text+": "+0,trigger:"hover"},{reference:n(()=>[u("span",null,j(T.text),1)]),_:2},1032,["content"])],4)}),128))])]),_:2},1024)]),_:2},1024))),128)),o(y)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1})}var Ll=M(vl,[["render",Pl]]),re={updateToken(e){v.defaults.headers.Authorization=`Bearer ${e}`},login(e,t,s=!1){const i=Q();return v.post("token/",{username:e,password:t,rememberMe:s}).then(r=>(r.token=r.access,delete r.access,i.login(q(E({},r),{username:e})),r))},refreshToken(){const e=Q();return v.post("token/refresh/",{token:e.token}).then(t=>{e.updateToken(t.token)})}};const Wl={name:"LoginPage",components:{UserFilled:Ze,Lock:Xe},data(){return{loginForm:{username:"",password:"",rememberMe:!1},rules:{username:[{required:!0,message:"Please input username",trigger:"blur"}],password:[{required:!0,message:"Please input password",trigger:"blur"}]},isLoading:!1,isValid:!1,showLoginFailed:"none"}},methods:{login(){this.$refs.loginForm.validate(e=>{if(e)this.isLoading=!0,this.showLoginFailed="none",re.login(this.loginForm.username,this.loginForm.password,this.loginForm.rememberMe).catch(()=>{this.isLoading=!1,this.showLoginFailed=""});else return!1})}}},Ml=e=>(R("data-v-081151ca"),e=e(),G(),e),Al={style:{display:"flex","justify-content":"center"}},Tl=p(" Login "),Bl=Ml(()=>u("div",{style:{display:"flex","justify-content":"center"}},[u("p",null,"test ID: test / password: test")],-1));function El(e,t,s,i,r,a){const d=l("el-alert"),_=l("UserFilled"),m=l("el-icon"),h=l("el-input"),f=l("el-form-item"),y=l("Lock"),w=l("el-checkbox"),b=l("el-button"),I=l("el-form"),C=l("el-col"),$=ie("loading");return c(),x(L,null,[u("div",Al,[ae((c(),S(C,{span:6},{default:n(()=>[o(d,{title:"Invalid username/password",type:"error","show-icon":"",style:O({display:r.showLoginFailed})},null,8,["style"]),o(I,{model:r.loginForm,rules:r.rules,ref:"loginForm"},{default:n(()=>[o(f,{label:"Username",prop:"username",class:"bold-label"},{default:n(()=>[o(h,{modelValue:r.loginForm.username,"onUpdate:modelValue":t[0]||(t[0]=g=>r.loginForm.username=g)},{prefix:n(()=>[o(m,null,{default:n(()=>[o(_)]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(f,{label:"Password",prop:"password",class:"bold-label"},{default:n(()=>[o(h,{type:"password",modelValue:r.loginForm.password,"onUpdate:modelValue":t[1]||(t[1]=g=>r.loginForm.password=g)},{prefix:n(()=>[o(m,null,{default:n(()=>[o(y)]),_:1})]),_:1},8,["modelValue"])]),_:1}),o(f,null,{default:n(()=>[o(w,{label:"Remember me",modelValue:r.loginForm.rememberMe,"onUpdate:modelValue":t[2]||(t[2]=g=>r.loginForm.rememberMe=g)},null,8,["modelValue"])]),_:1}),o(f,null,{default:n(()=>[o(b,{type:"primary",onClick:a.login,disabled:this.isValid,style:{width:"100%"}},{default:n(()=>[Tl]),_:1},8,["onClick","disabled"])]),_:1})]),_:1},8,["model","rules"])]),_:1})),[[$,r.isLoading]])]),Bl],64)}var Vl=M(Wl,[["render",El],["__scopeId","data-v-081151ca"]]);const Ul={name:"LogoutPage",setup(){return{userStore:Q()}},created(){this.userStore.logout()}};function Ol(e,t,s,i,r,a){return c(),x("div")}var zl=M(Ul,[["render",Ol]]);const oe=Ye({history:et("/"),routes:[{path:"/",name:"Home",component:pt},{path:"/projects",name:"Projects",component:It},{path:"/login",name:"Login",component:Vl},{path:"/logout",component:zl},{path:"/project/",component:Ut,children:[{path:"doc/",component:Nt,children:[{path:"upload",name:"DocumentUpload",component:Io},{path:"list",name:"DocumentList",component:Kt},{path:"model",name:"ModelUpload",component:Ao}]},{path:"labels",name:"Labels",component:No},{path:"generate-explanations",name:"GenerateExplanations",component:Ho},{path:"export",name:"ExportData",component:en}]},{path:"/debug/",component:kn,children:[{path:"overview",name:"DebugOverview",component:Tn},{path:"dictionary",name:"DebugDictionary",component:wl},{path:"local",name:"DebugLocal",component:nl},{path:"global",name:"DebugGlobal",component:hl},{path:"evaluation",name:"DebugEvaluation",component:Ll}]}]});oe.beforeEach((e,t,s)=>{!Q().isLoggedIn&&e.name!=="Login"&&e.name!=="Home"?s("/login"):(e.name=="Login",s())});oe.afterEach(()=>{const e=Q();e.isLoggedIn&&e.inspectToken()});const Q=z({id:"user",presist:!0,state:()=>({userInfo:null}),getters:{username:e=>e.userInfo.username,token:e=>e.userInfo.token,isLoggedIn:e=>e.userInfo!==null},actions:{login(e){this.userInfo=e,re.updateToken(e.token),oe.push({name:"Projects"}).then(t=>t)},logout(){this.userInfo=null,oe.push("/").then(e=>e)},updateToken(e){this.userInfo.token=e,re.updateToken(e)},inspectToken(){const e=this.userInfo.token;if(e){const t=tt(e),s=t.exp,i=t.orig_iat;s<Date.now()/1e3?this.logout():s-Date.now()/1e3<1800&&Date.now()/1e3-i<628200&&re.refreshToken()}}}});var Nl="/assets/logo.4941f0a9.png";const Ql={name:"NavBar",components:{},setup(){return{userStore:Q(),Logo:Nl}},methods:{loginClicked(){this.userStore.isLoggedIn?this.$router.push("/login"):this.$router.push("/logout")}}},Rl=p(" Projects ");function Gl(e,t,s,i,r,a){const d=l("el-image"),_=l("el-menu-item"),m=l("el-button"),h=l("el-menu");return c(),S(h,{"default-active":e.$route.path,mode:"horizontal",router:!0},{default:n(()=>[o(_,{index:"/"},{default:n(()=>[o(d,{src:i.Logo,style:{width:"58px",height:"58px"}},null,8,["src"])]),_:1}),i.userStore.isLoggedIn?(c(),S(_,{key:0,index:"/projects"},{default:n(()=>[Rl]),_:1})):A("",!0),o(_,{index:i.userStore.isLoggedIn?"/logout":"/login",class:"dock-right"},{default:n(()=>[o(m,{onClick:t[0]||(t[0]=f=>a.loginClicked(f)),jest:"logBtn"},{default:n(()=>[p(j(this.userStore.isLoggedIn?"Logout":"Login"),1)]),_:1})]),_:1},8,["index"])]),_:1},8,["default-active"])}var ql=M(Ql,[["render",Gl],["__scopeId","data-v-3fc15066"]]);const Jl={components:{NavBar:ql}},Hl={id:"app"};function Kl(e,t,s,i,r,a){const d=l("NavBar"),_=l("router-view");return c(),x("div",Hl,[o(d,{style:{width:"100%"}}),o(_)])}var Zl=M(Jl,[["render",Kl]]);const ee=ot(Zl);ee.use(nt);ee.provide("$api",v);ee.use(lt,{locale:rt});const Me=st();Me.use(it);ee.use(Me);ee.use(oe);ee.mount("#app");
