var Ee=Object.defineProperty,Ue=Object.defineProperties;var Me=Object.getOwnPropertyDescriptors;var ke=Object.getOwnPropertySymbols;var Be=Object.prototype.hasOwnProperty,ze=Object.prototype.propertyIsEnumerable;var Ie=(e,t,s)=>t in e?Ee(e,t,{enumerable:!0,configurable:!0,writable:!0,value:s}):e[t]=s,B=(e,t)=>{for(var s in t||(t={}))Be.call(t,s)&&Ie(e,s,t[s]);if(ke)for(var s of ke(t))ze.call(t,s)&&Ie(e,s,t[s]);return e},R=(e,t)=>Ue(e,Me(t));import{c as Oe,r as l,o as _,a as y,w as n,b as i,d as o,e as u,f as Fe,E as Y,g as Q,h as S,i as U,F as P,j as Pe,_ as ie,D as Ne,t as V,k as Qe,u as fe,m as Ge,s as Re,l as be,n as Ve,p as Le,q as H,v as K,x as ye,y as G,z as L,A as qe,B as Je,C as N,G as He,H as ae,I as Ke,J as Ye,K as Ze,L as Xe,M as Se,N as we,O as ve,P as Te,Q as We,R as et,S as tt,T as ot,U as nt,V as lt,W as rt,X as st,Y as it,Z as at,$ as dt,a0 as ct,a1 as ut}from"./vendor.19523812.js";const pt=function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))a(r);new MutationObserver(r=>{for(const d of r)if(d.type==="childList")for(const m of d.addedNodes)m.tagName==="LINK"&&m.rel==="modulepreload"&&a(m)}).observe(document,{childList:!0,subtree:!0});function s(r){const d={};return r.integrity&&(d.integrity=r.integrity),r.referrerpolicy&&(d.referrerPolicy=r.referrerpolicy),r.crossorigin==="use-credentials"?d.credentials="include":r.crossorigin==="anonymous"?d.credentials="omit":d.credentials="same-origin",d}function a(r){if(r.ep)return;r.ep=!0;const d=s(r);fetch(r.href,d)}};pt();var _t="/assets/overview.ef42e75e.png",I=(e,t)=>{const s=e.__vccOpts||e;for(const[a,r]of t)s[a]=r;return s};const mt={name:"HomePage",components:{}},gt=Oe('<section id="hero" class="hero d-flex align-items-center" style="width:100%;height:60vh;background:#cce5ff;background-size:cover;background-position:center;"><div class="container"><div class="row"><div class="justify-content-center"><h1 data-aos="fade-up" style="margin:0;font-size:48px;font-weight:700;color:#361e0b;">XMD: An End-to-End Framework for Interactive Explanation-Based Debugging of NLP Models</h1><h2 data-aos="fade-up" style="color:#444444;margin:15px 0 0 0;font-size:26px;" data-aos-delay="400">University of Southern California</h2></div></div></div></section><section id="overview" class="overview" style="padding:100px;width:100%;"><div class="container" id="app"><div class="row"><div class="col-md-6"><h2 class="" style="color:#3597d4;"> Overview </h2><p class="text" style="text-align:justify;"> NLP models are susceptible to learning spurious biases (i.e., bugs) that work on some datasets but do not properly reflect the underlying task. Explanation-based model debugging aims to resolve spurious biases by showing human users explanations of model behavior, asking users to give feedback on the behavior, then using the feedback to update the model. While existing model debugging methods have shown promise, their prototype-level implementations provide limited practical utility. </p></div><div class="col-sm-12 col-xl-6 d-flex text-center" data-aos="zoom-out" data-aos-delay="200"><img src="'+_t+'" class="img-fluid" alt=""></div></div></div></section>',2);function ht(e,t,s,a,r,d){return gt}var ft=I(mt,[["render",ht]]);const bt={name:"CreatePorjectTutorial",props:{dialogVisible:Boolean,existingInfo:Object},setup(){},data(){return{}},methods:{}},yt=i("span",{slot:"title",style:{"font-size":"18pt","font-weight":"bold"}},"Create Projects",-1),St=i("div",{class:"container"},[i("div",{class:"row",style:{padding:"10px"}},[i("br"),i("br"),i("p",{class:"text",style:{"font-size":"15pt","text-align":"justify"}},[u(" Create a project to start with. "),i("br"),u(" You can choose between sequence classification and relation extraction. "),i("br"),u(" (Currently we only support sequence classification.) ")])])],-1),wt={class:"dialog-footer"},vt=u(" Understand ");function xt(e,t,s,a,r,d){const m=l("el-button"),c=l("el-dialog");return _(),y(c,{modelValue:s.dialogVisible,"onUpdate:modelValue":t[1]||(t[1]=p=>s.dialogVisible=p),"onUpdate:visible":t[2]||(t[2]=p=>e.$emit("update:dialogVisible",p)),onClose:t[3]||(t[3]=p=>e.$emit("update:dialogVisible",!1)),width:"50%"},{footer:n(()=>[i("span",wt,[o(m,{onClick:t[0]||(t[0]=()=>e.$emit("update:dialogVisible",!1))},{default:n(()=>[vt]),_:1})])]),default:n(()=>[yt,St]),_:1},8,["modelValue"])}var Dt=I(bt,[["render",xt]]);const O={1:"Sequence Classification",2:"Relation Extraction"},q={0:{name:"Neutral",colors:[{"background-color":"#FFFFFF",color:"#000000"},{"background-color":"#FFFFFF",color:"#000000"},{"background-color":"#FFFFFF",color:"#000000"},{"background-color":"#FFFFFF",color:"#000000"},{"background-color":"#FFFFFF",color:"#000000"}]},1:{name:"Red",colors:[{"background-color":"#EA9999",color:"#000000"},{"background-color":"#E06666",color:"#FFFFFF"},{"background-color":"#CC0000",color:"#FFFFFF"}]},2:{name:"Blue",colors:[{"background-color":"#ADD8E6",color:"#000000"},{"background-color":"#4682B4",color:"#000000"},{"background-color":"#00008B",color:"#FFFFFF"}]},3:{name:"Green",colors:[{"background-color":"#8AFF8A",color:"#000000"},{"background-color":"#00D100",color:"#FFFFFF"},{"background-color":"#007500",color:"#FFFFFF"}]},4:{name:"Purple",colors:[{"background-color":"#CC85FF",color:"#000000"},{"background-color":"#7700CC",color:"#FFFFFF"},{"background-color":"#3E006B",color:"#FFFFFF"}]},5:{name:"Orange",colors:[{"background-color":"#FFCA8A",color:"#000000"},{"background-color":"#FFA12E",color:"#000000"},{"background-color":"#D67600",color:"#000000"}]}};Fe.defaults.baseURL="/api";const x=Fe.create({headers:{Accept:"application/json","Content-Type":"application/json",Authorization:null}});x.interceptors.response.use(e=>e.data,e=>(Y({title:"Error",message:e.toString(),type:"error"}),Promise.reject(e)));x.interceptors.request.use(e=>e,e=>(Y({title:"Error",message:e.toString(),type:"error"}),Promise.reject(e)));var ee={list(){return x.get("hilt/projects/")},get(e){return x.get(`hilt/projects/${e}/`)},create(e){return x.post("hilt/projects/",e)},update(e){return x.put(`hilt/projects/${e.id}/`,e)},delete(e){return x.delete(`hilt/projects/${e}/`)},exportJSON(e){return x.get(`hilt/export/json/${e}/`)}};const W=Q({id:"project",state:()=>({projectInfo:null}),getters:{getProjectInfo:e=>e.projectInfo,task:e=>e.projectInfo.task},actions:{reset_state(){ee.get(this.projectInfo.id).then(e=>(console.log("reset_project_state",e),this.projectInfo=e,e),e=>{console.log(e)})},setProject(e){this.projectInfo=e},setTask(e){this.projectInfo.task=e},exportJSON(){return ee.exportJSON(this.projectInfo.id)}}}),$t={name:"CreateProjectModal",props:{dialogVisible:Boolean,existingInfo:Object},setup(){const e=W(),t=[];for(let s in O)t.push({id:s,name:O[s]});return{projectStore:e,taskOptions:t}},data(){return{projectInfo:{name:"",description:"",task:""},formRules:{name:[{required:!0,message:"Please input project name",trigger:"blur"}],description:[{required:!0,message:"Please input description",trigger:"blur"}],task:[{required:!0,message:"Please select task",trigger:"blur"}]}}},methods:{dialogIsOpen(){if(this.existingInfo)for(let e in this.existingInfo)this.projectInfo[e]=this.existingInfo[e];else this.projectInfo={name:"",description:"",task:""}},createProject(){this.$refs.projectInfoForm.validate(e=>{if(e){let t;this.existingInfo?t=ee.update(this.projectInfo):t=ee.create(this.projectInfo),t.then(s=>{this.projectStore.setProject(s),this.$emit("update:dialogVisible",!1),this.$router.push({name:"DocumentList"})})}})}}},kt={class:"dialog-footer"},It=u("Cancel"),Ct=u("Confirm");function jt(e,t,s,a,r,d){const m=l("el-input"),c=l("el-form-item"),p=l("el-option"),g=l("el-select"),b=l("el-form"),h=l("el-button"),D=l("el-dialog");return _(),y(D,{title:this.existingInfo?"Edit Existing Project":"Create New Project",modelValue:s.dialogVisible,"onUpdate:modelValue":t[4]||(t[4]=f=>s.dialogVisible=f),"onUpdate:visible":t[5]||(t[5]=f=>e.$emit("update:dialogVisible",f)),onOpen:this.dialogIsOpen,onClose:t[6]||(t[6]=f=>e.$emit("update:dialogVisible",!1)),width:"40%"},{footer:n(()=>[i("span",kt,[o(h,{onClick:t[3]||(t[3]=()=>e.$emit("update:dialogVisible",!1))},{default:n(()=>[It]),_:1}),o(h,{type:"primary",onClick:d.createProject},{default:n(()=>[Ct]),_:1},8,["onClick"])])]),default:n(()=>[o(b,{model:r.projectInfo,rules:r.formRules,ref:"projectInfoForm"},{default:n(()=>[o(c,{label:"Name",prop:"name"},{default:n(()=>[o(m,{modelValue:r.projectInfo.name,"onUpdate:modelValue":t[0]||(t[0]=f=>r.projectInfo.name=f)},null,8,["modelValue"])]),_:1}),o(c,{label:"Description",prop:"description"},{default:n(()=>[o(m,{modelValue:r.projectInfo.description,"onUpdate:modelValue":t[1]||(t[1]=f=>r.projectInfo.description=f)},null,8,["modelValue"])]),_:1}),o(c,{label:"Task",prop:"task"},{default:n(()=>[o(g,{remote:"",modelValue:r.projectInfo.task,"onUpdate:modelValue":t[2]||(t[2]=f=>r.projectInfo.task=f),placeholder:"Select",style:{width:"100%"}},{default:n(()=>[(_(!0),S(P,null,U(a.taskOptions,f=>(_(),y(p,{key:f.id,label:f.name,value:f.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["title","modelValue","onOpen"])}var Ft=I($t,[["render",jt]]);const Pt={name:"ProjectsPage",components:{CreatePorjectTutorial:Dt,CreateProjectModal:Ft,Edit:Pe,Delete:ie},setup(){const e=J(),t=W(),s=[];for(let a in O)s.push({text:O[a],value:O[a]});return{userStore:e,projectStore:t,filters:s}},data(){return{projects:[],dialogVisible:!1,tutorialVisible:!0,selectedProject:null}},created:function(){this.fetchProjects()},methods:{handleProjectSelected(e,t){this.$router.push({name:"DocumentList"}),this.projectStore.setProject(t)},handleEdit(e,t){this.selectedProject=t,this.dialogVisible=!0},handleDelete(e,t){ee.delete(t.id).then(()=>{this.fetchProjects()})},fetchProjects(){ee.list().then(e=>{this.projects=e.results},e=>{console.log(e)})},dateFormat(e,t){let s=e[t.property];return s?Ne.fromISO(s).toISODate():""},convertTaskIDToString(e,t){let s=e[t.property];return s?O[s]:""},filterTask(e,t,s){let a=t[s.property],r=O[a];return e===r}}},Vt={style:{"text-align":"center"}},Lt=u("CREATE PROJECT "),Tt=u(" Edit "),Wt=u("Delete");function At(e,t,s,a,r,d){const m=l("CreatePorjectTutorial"),c=l("el-button"),p=l("el-col"),g=l("el-row"),b=l("el-link"),h=l("el-table-column"),D=l("Edit"),f=l("el-icon"),v=l("Delete"),F=l("el-popconfirm"),w=l("el-table"),k=l("CreateProjectModal");return _(),S("div",null,[o(m,{"dialog-visible":r.tutorialVisible,"onUpdate:dialog-visible":t[0]||(t[0]=$=>r.tutorialVisible=$)},null,8,["dialog-visible"]),i("div",Vt,[i("h1",null,"Hello, "+V(this.userStore.username),1),o(g,null,{default:n(()=>[o(p,{span:12,offset:6},{default:n(()=>[o(c,{type:"primary",onClick:t[1]||(t[1]=()=>{this.selectedProject=null,this.dialogVisible=!0})},{default:n(()=>[Lt]),_:1})]),_:1})]),_:1})]),o(g,null,{default:n(()=>[o(p,{span:16,offset:4},{default:n(()=>[o(w,{data:r.projects,stripe:"","default-sort":{prop:"updated_at",order:"descending"}},{default:n(()=>[o(h,{prop:"name",label:"Name",sortable:""},{default:n($=>[o(b,{type:"primary",onClick:T=>d.handleProjectSelected($.$index,$.row)},{default:n(()=>[u(V($.row.name),1)]),_:2},1032,["onClick"])]),_:1}),o(h,{prop:"description",label:"Description",sortable:""}),o(h,{prop:"task",label:"Task",formatter:d.convertTaskIDToString,sortable:"",filters:this.filters,"filter-method":d.filterTask,width:"180"},null,8,["formatter","filters","filter-method"]),o(h,{prop:"updated_at",label:"Last Updated",formatter:d.dateFormat,sortable:""},null,8,["formatter"]),o(h,{label:"Operations",width:"180"},{default:n($=>[o(c,{size:"small",onClick:T=>d.handleEdit($.$index,$.row)},{default:n(()=>[o(f,null,{default:n(()=>[o(D)]),_:1}),Tt]),_:2},1032,["onClick"]),o(F,{title:"Are you sure?",onConfirm:T=>d.handleDelete($.$index,$.row),style:{"margin-left":"10px"}},{reference:n(()=>[o(c,{size:"small",type:"danger"},{default:n(()=>[o(f,null,{default:n(()=>[o(v)]),_:1}),Wt]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1}),o(k,{"dialog-visible":r.dialogVisible,"onUpdate:dialog-visible":t[2]||(t[2]=$=>r.dialogVisible=$),"existing-info":this.selectedProject},null,8,["dialog-visible","existing-info"])])}var Et=I(Pt,[["render",At]]);const Ut={name:"SetupSideBar",components:{Files:Qe,UploadFilled:fe,MessageBox:Ge,StarFilled:Re,Edit:Pe,Download:be,DataAnalysis:Ve,Tools:Le},computed:{disabled(){return this.projectStore.getProjectInfo,!1}},setup(){return{projectStore:W()}}},de=e=>(H("data-v-fa01afce"),e=e(),K(),e),Mt=de(()=>i("span",null,"Setup",-1)),Bt=u(" Overview "),zt=u(" Upload New Document "),Ot=u(" Upload Custom Model "),Nt=de(()=>i("span",null,"Generate Explanations",-1)),Qt=de(()=>i("span",null,"Debug",-1)),Gt=de(()=>i("span",null,"Export Data",-1));function Rt(e,t,s,a,r,d){const m=l("Tools"),c=l("el-icon"),p=l("Files"),g=l("el-menu-item"),b=l("UploadFilled"),h=l("el-sub-menu"),D=l("DataAnalysis"),f=l("el-menu"),v=l("Edit"),F=l("Download"),w=l("el-col");return _(),y(w,null,{default:n(()=>[o(f,{"default-active":e.$route.path,router:!0},{default:n(()=>[o(h,{index:"1"},{title:n(()=>[o(c,null,{default:n(()=>[o(m)]),_:1}),Mt]),default:n(()=>[o(g,{index:"/project/doc/list"},{default:n(()=>[o(c,null,{default:n(()=>[o(p)]),_:1}),Bt]),_:1}),o(g,{index:"/project/doc/upload",disabled:d.disabled},{default:n(()=>[o(c,null,{default:n(()=>[o(b)]),_:1}),zt]),_:1},8,["disabled"]),o(g,{index:"/project/doc/model",disabled:d.disabled},{default:n(()=>[o(c,null,{default:n(()=>[o(b)]),_:1}),Ot]),_:1},8,["disabled"])]),_:1}),o(g,{index:"/project/generate-explanations"},{default:n(()=>[o(c,null,{default:n(()=>[o(D)]),_:1}),Nt]),_:1})]),_:1},8,["default-active"]),o(f,null,{default:n(()=>[o(g,{onClick:t[0]||(t[0]=()=>this.$router.push({name:"DebugOverview"}))},{default:n(()=>[o(c,null,{default:n(()=>[o(v)]),_:1}),Qt]),_:1})]),_:1}),o(f,{"default-active":e.$route.path,router:!0},{default:n(()=>[o(g,{index:"/project/export"},{default:n(()=>[o(c,null,{default:n(()=>[o(F)]),_:1}),Gt]),_:1})]),_:1},8,["default-active"])]),_:1})}var qt=I(Ut,[["render",Rt],["__scopeId","data-v-fa01afce"]]);const Jt={name:"ProjectSetupPage",components:{SetupSideBar:qt}};function Ht(e,t,s,a,r,d){const m=l("SetupSideBar"),c=l("el-aside"),p=l("router-view"),g=l("el-main"),b=l("el-container");return _(),S("div",null,[o(b,null,{default:n(()=>[o(c,{style:{"border-right":"solid 1px #e6e6e6"}},{default:n(()=>[o(m,{style:{width:"100%"}})]),_:1}),o(g,null,{default:n(()=>[o(p)]),_:1})]),_:1})])}var Kt=I(Jt,[["render",Ht]]);const Yt={name:"SetupDocument"};function Zt(e,t,s,a,r,d){const m=l("router-view");return _(),y(m)}var Xt=I(Yt,[["render",Zt]]),Z={list(e,t,s){const a={};return t&&(a.page=t),s&&(a.page_size=s),x.get(`hilt/projects/${e}/docs/`,{params:a})},uploadFile(e,t,s){const a=new FormData;return a.append("dataset",t),a.append("format",s.toLowerCase()),x.post(`hilt/projects/${e}/docs/upload/`,a,{headers:R(B({},x.defaults.headers),{"Content-Type":"multipart/form-data"})})},markAnnotated(e,t,s,a){return console.log("documents API",t,":	",s),x.put(`hilt/projects/${t}/docs/${s}/`,{annotated:e,project:t,text:a})},delete(e,t){return x.delete(`hilt/projects/${e}/docs/${t}/`)},detailedDocument(e,t){return x.get(`hilt/projects/${e}/docs/${t}/words-annotations/`)}};const le=Q({id:"document",state:()=>({documents:[],curPage:1,maxPage:1,totalDocCount:0,curDocIndex:0,annotatedDocCount:0,pageSize:10}),getters:{getDocuments:e=>e.documents,getdocumentInfo:e=>e},actions:{resetState(){return this.curPage=1,this.pageSize=10,this.fetchDocuments()},setCurDocIndex(e){this.curDocIndex=e},fetchDocuments(){const e=W();return Z.list(e.getProjectInfo.id,this.curPage,this.pageSize).then(t=>(this.documents=t.results.results,this.totalDocCount=t.count,this.annotatedDocCount=t.results.annotatedCount,this.maxPage=Math.ceil(this.totalDocCount/this.pageSize),console.log(t.results.results),t))},updateCurPage(e){return this.curPage=e,this.curDocIndex=0,this.fetchDocuments()},deleteDocument(e){const t=W();return Z.delete(t.getProjectInfo.id,e.id)},markAnnotated(e){const t=W();return this.documents[this.curDocIndex].id?(console.log(t.getProjectInfo.id,this.documents[this.curDocIndex].id),Z.markAnnotated(e,t.getProjectInfo.id,this.documents[this.curDocIndex].id,this.documents[this.curDocIndex].text).then(()=>{this.documents[this.curDocIndex].annotated=!0})):null}}}),eo={name:"WorkflowTutorial",props:{dialogVisible:Boolean,existingInfo:Object},setup(){},data(){return{}},methods:{}},to=i("span",{slot:"title",style:{"font-size":"18pt","font-weight":"bold"}},"XMD Workflow",-1),oo=i("div",{class:"container"},[i("div",{class:"row",style:{padding:"10px"}},[i("br"),i("br"),i("p",{class:"text",style:{"font-size":"15pt","text-align":"justify"}},[u(" 1. Upload your train data. "),i("br"),u(" 2. Load your trained model. "),i("br"),u(" 3. Generate explanations on your train data using the trained model. "),i("br"),u(" 4. Select words to increase or decrease its importance score. "),i("br"),u(" 5. Start debug the model. "),i("br"),u(" 6. Download the debugged model and see how explanation is changed. "),i("br")])])],-1),no={class:"dialog-footer"},lo=u(" Understand ");function ro(e,t,s,a,r,d){const m=l("el-button"),c=l("el-dialog");return _(),y(c,{modelValue:s.dialogVisible,"onUpdate:modelValue":t[1]||(t[1]=p=>s.dialogVisible=p),"onUpdate:visible":t[2]||(t[2]=p=>e.$emit("update:dialogVisible",p)),onClose:t[3]||(t[3]=p=>e.$emit("update:dialogVisible",!1)),width:"50%"},{footer:n(()=>[i("span",no,[o(m,{onClick:t[0]||(t[0]=()=>e.$emit("update:dialogVisible",!1))},{default:n(()=>[lo]),_:1})])]),default:n(()=>[to,oo]),_:1},8,["modelValue"])}var so=I(eo,[["render",ro]]);const io={name:"DocumentList",components:{WorkflowTutorial:so,Search:ye,Delete:ie,QuestionFilled:G},setup(){return{documentStore:le()}},data(){return{tutorialVisible:!0,searchQuery:""}},methods:{pageChanged(e){this.documentStore.updateCurPage(e)},indexMethod(e){return e+1},percentageText(e){return`${e} % annotated`},handleDelete(e,t){this.documentStore.deleteDocument(t).then(()=>{this.documentStore.fetchDocuments()})}},created(){this.documentStore.resetState()}},ao={style:{"text-align":"center"}},co=i("div",null,[i("h1",null,"All Uploaded Documents")],-1),uo={style:{"align-content":"center"}},po=u("Delete");function _o(e,t,s,a,r,d){const m=l("Search"),c=l("el-icon"),p=l("el-input"),g=l("el-table-column"),b=l("Delete"),h=l("el-button"),D=l("el-popconfirm"),f=l("el-table"),v=l("el-pagination"),F=l("WorkflowTutorial");return _(),S(P,null,[i("div",null,[i("div",ao,[co,o(p,{modelValue:r.searchQuery,"onUpdate:modelValue":t[0]||(t[0]=w=>r.searchQuery=w),placeholder:"Type to search for documents",style:{width:"50%"},clearable:""},{prefix:n(()=>[i("div",uo,[o(c,null,{default:n(()=>[o(m)]),_:1})])]),_:1},8,["modelValue"])]),o(f,{data:a.documentStore.getDocuments.filter(w=>!r.searchQuery||w.text.toLowerCase().includes(r.searchQuery.toLowerCase().trim())),stripe:""},{default:n(()=>[o(g,{type:"index",index:d.indexMethod},null,8,["index"]),o(g,{prop:"text",label:"Text"},{default:n(w=>[u(V(w.row.text),1)]),_:1}),o(g,{label:"Operations"},{default:n(w=>[o(D,{title:"Are you sure?",onConfirm:k=>d.handleDelete(w.$index,w.row),style:{"margin-left":"10px"}},{reference:n(()=>[o(h,{size:"small",type:"danger"},{default:n(()=>[o(c,null,{default:n(()=>[o(b)]),_:1}),po]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"]),o(v,{background:"",layout:"prev, pager, next",total:a.documentStore.getdocumentInfo.totalDocCount,"page-size":a.documentStore.getdocumentInfo.pageSize,"current-page":a.documentStore.getdocumentInfo.curPage,onCurrentChange:d.pageChanged,style:{"text-align":"center"}},null,8,["total","page-size","current-page","onCurrentChange"])]),o(F,{"dialog-visible":r.tutorialVisible,"onUpdate:dialog-visible":t[1]||(t[1]=w=>r.tutorialVisible=w)},null,8,["dialog-visible"])],64)}var mo=I(io,[["render",_o]]);const go={name:"UploadDocumentTutorial",props:{dialogVisible:Boolean,existingInfo:Object},setup(){},data(){return{}},methods:{}},ho=i("span",{slot:"title",style:{"font-size":"18pt","font-weight":"bold"}},"Upload Documents",-1),fo=i("div",{class:"container"},[i("div",{class:"row",style:{padding:"10px"}},[i("br"),i("br"),i("p",{class:"text",style:{"font-size":"15pt","text-align":"justify"}},[u(" You need to first input the train data that your model is trained on. "),i("br"),u(" Follow the instruction to upload the data. "),i("br")])])],-1),bo={class:"dialog-footer"},yo=u(" Understand ");function So(e,t,s,a,r,d){const m=l("el-button"),c=l("el-dialog");return _(),y(c,{modelValue:s.dialogVisible,"onUpdate:modelValue":t[1]||(t[1]=p=>s.dialogVisible=p),"onUpdate:visible":t[2]||(t[2]=p=>e.$emit("update:dialogVisible",p)),onClose:t[3]||(t[3]=p=>e.$emit("update:dialogVisible",!1)),width:"50%"},{footer:n(()=>[i("span",bo,[o(m,{onClick:t[0]||(t[0]=()=>e.$emit("update:dialogVisible",!1))},{default:n(()=>[yo]),_:1})])]),default:n(()=>[ho,fo]),_:1},8,["modelValue"])}var wo=I(go,[["render",So]]);const vo={name:"DocumentUpload",components:{UploadDocumentTutorial:wo,UploadFilled:fe},setup(){return{projectStore:W()}},data(){return{tutorialVisible:!0,fileForm:{fileType:"JSON"}}},methods:{uploadFile(e){Z.uploadFile(this.projectStore.getProjectInfo.id,e.file,this.fileForm.fileType).then(()=>{this.$router.push({name:"GenerateExplanations"})}).catch(t=>{console.log(t)})}}},z=e=>(H("data-v-e4859054"),e=e(),K(),e),xo=z(()=>i("h3",null,"Import your corpus below",-1)),Do=z(()=>i("div",null,[u("In order to start the annotation process, a corpus "),i("u",null,"must"),u(" be uploaded")],-1)),$o=z(()=>i("div",null,"We accept datasets in the following formats:",-1)),ko=z(()=>i("b",null,"JSON (recommended)",-1)),Io=z(()=>i("br",null,null,-1)),Co=z(()=>i("u",null,"Format:",-1)),jo={style:{width:"fit-content","padding-left":"20px","padding-right":"20px",height:"fit-content"}},Fo=u("                "),Po=u(`
                  {
                    "data" : [
                      {
                        "text" : "Louis Armstrong the great trumpet player lived in Corona.",
                      `),Vo=u(`
                        "label": "Label-Name-1"
                      `),Lo=u(`
                        "label": "Label-Name-1",
                        "start_offset": 0,
                        "end_offset": 5,
                      `),To=u(`
                      },
                      ...
                    ]
                  }
              `),Wo=u(`
							`),Ao=u(" Each entry within "),Eo=z(()=>i("i",null,"data",-1)),Uo=u(" must have keys "),Mo=z(()=>i("i",null,[i("b",null,"text")],-1)),Bo=u(" and "),zo=z(()=>i("i",null,[i("b",null,"words")],-1)),Oo=u(". All other keys will be saved in a metadata dictionary associated with the text "),No=z(()=>i("br",null,null,-1)),Qo=u(" The "),Go=z(()=>i("i",null,[i("b",null,"annotations")],-1)),Ro=u(" key in each entry is optional. And, can be used to populate the document with label. "),qo=z(()=>i("div",null,[u("Document Example: "),i("a",{href:"https://github.com/INK-USC/XMD/blob/master/annotation_backend/sample_data/tweeteval_hate_sample_100.json"},"[Dataset]")],-1)),Jo=z(()=>i("br",null,null,-1)),Ho=u("JSON file"),Ko=z(()=>i("div",{class:"el-upload__text"},[u(" Drop file here or "),i("em",null,"click to upload")],-1));function Yo(e,t,s,a,r,d){const m=l("el-radio"),c=l("el-form-item"),p=l("UploadFilled"),g=l("el-icon"),b=l("el-upload"),h=l("el-form"),D=l("el-card"),f=l("el-col"),v=l("el-row"),F=l("UploadDocumentTutorial");return _(),S(P,null,[o(v,null,{default:n(()=>[o(f,null,{default:n(()=>[o(D,null,{header:n(()=>[xo]),default:n(()=>[i("div",null,[Do,$o,i("ul",null,[i("li",null,[ko,Io,Co,i("pre",jo,[Fo,i("code",null,[Po,this.projectStore.task===1?(_(),S(P,{key:0},[Vo],64)):L("",!0),this.projectStore.task===2?(_(),S(P,{key:1},[Lo],64)):L("",!0),To]),Wo]),Ao,Eo,Uo,Mo,Bo,zo,Oo,No,Qo,Go,Ro])]),qo,Jo]),o(h,{model:this.fileForm,style:{"text-align":"center"}},{default:n(()=>[o(c,null,{default:n(()=>[o(m,{modelValue:r.fileForm.fileType,"onUpdate:modelValue":t[0]||(t[0]=w=>r.fileForm.fileType=w),label:"JSON",border:""},{default:n(()=>[Ho]),_:1},8,["modelValue"])]),_:1}),o(c,{label:""},{default:n(()=>[o(b,{"http-request":d.uploadFile,drag:"",accept:"text/json",ref:"uploadInput",action:""},{default:n(()=>[o(g,{size:48},{default:n(()=>[o(p)]),_:1}),Ko]),_:1},8,["http-request"])]),_:1})]),_:1},8,["model"])]),_:1})]),_:1})]),_:1}),o(F,{"dialog-visible":r.tutorialVisible,"onUpdate:dialog-visible":t[1]||(t[1]=w=>r.tutorialVisible=w)},null,8,["dialog-visible"])],64)}var Zo=I(vo,[["render",Yo],["__scopeId","data-v-e4859054"]]),X={list(e){return x.get(`hilt/projects/${e}/models/`)},uploadModel(e,t,s){const a=new FormData;return a.append("model_zip",t),a.append("format",s.toLowerCase()),console.log(a),x.post(`hilt/projects/${e}/models/upload/`,a,{headers:R(B({},x.defaults.headers),{"Content-Type":"multipart/form-data"})})},downloadModel(e,t){const s=new FormData;return s.append("model_id",t),x.post(`hilt/projects/${e}/model/download/`,s,{headers:R(B({},x.defaults.headers),{"Content-Type":"multipart/form-data"}),responseType:"arraybuffer"})}};const Xo={name:"ModelUpload",components:{UploadFilled:fe,Upload:qe,SuccessFilled:Je,QuestionFilled:G},setup(){return{projectStore:W()}},data(){return{modelRadio:"Upload Model",modelList:[],fileForm:{fileType:".zip",fileZip:[],file:null},savingSuccessful:!1}},methods:{handleUpload(e){X.uploadModel(this.projectStore.getProjectInfo.id,e.file,this.fileForm.fileType).then(t=>{console.log(t),t!=null&&t.success&&(this.savingSuccessful=!0)}).catch(t=>{console.log(t)})},uploadFile(){this.$refs.modelUploadForm.validate(e=>{e&&X.uploadModel(this.projectStore.getProjectInfo.id,this.fileForm.file,this.fileForm.description,this.fileForm.fileType).then(()=>{}).catch(t=>{console.log(t)})})},getModelList(){X.list(this.projectStore.getProjectInfo.id).then(e=>{this.modelList=e.results,console.log("res",e),console.log("model list:",this.modelList)})},created(){this.getModelList()}}},ce=e=>(H("data-v-1a6e1ead"),e=e(),K(),e),en=u("Model List "),tn=ce(()=>i("h3",null,[u("Upload new model "),i("span",{style:{color:"#909399"}},"(Optional)")],-1)),on=ce(()=>i("div",null,[u(" We expect model architecture be compatible to "),i("a",{href:"https://huggingface.co/docs/transformers/model_doc/auto#transformers.AutoModelForSequenceClassification"},"Huggingface sequence classification model")],-1)),nn=ce(()=>i("div",null,[i("br")],-1)),ln=u(".ZIP file"),rn=ce(()=>i("div",{class:"el-upload__text"},[u(" Drop file here or "),i("em",null,"click to upload")],-1)),sn={key:0,class:"success",style:{color:"green"}},an=u("Model was saved successfully ");function dn(e,t,s,a,r,d){const m=l("QuestionFilled"),c=l("el-icon"),p=l("el-popover"),g=l("el-table-column"),b=l("el-table"),h=l("el-card"),D=l("el-radio"),f=l("el-form-item"),v=l("UploadFilled"),F=l("el-upload"),w=l("SuccessFilled"),k=l("el-form"),$=l("el-col"),T=l("el-row");return _(),y(T,null,{default:n(()=>[o($,null,{default:n(()=>[r.modelRadio=="Model List"?(_(),y(h,{key:0},{header:n(()=>[i("h3",null,[en,o(p,{content:"help text",trigger:"hover",width:400},{reference:n(()=>[o(c,{style:{height:"100%","margin-left":"0.5rem"}},{default:n(()=>[o(m)]),_:1})]),_:1})])]),default:n(()=>[o(b,{data:this.modelList,stripe:"",style:{width:"100%"}},{default:n(()=>[o(g,{prop:"id",label:"Id"}),o(g,{prop:"name",label:"Name"}),o(g,{prop:"model",label:"Model path"}),o(g,{prop:"uploaded_at",label:"Uploaded at"})]),_:1},8,["data"])]),_:1})):L("",!0),r.modelRadio=="Upload Model"?(_(),y(h,{key:1},{header:n(()=>[tn]),default:n(()=>[on,nn,o(k,{model:this.fileForm,ref:"modelUploadForm",style:{"text-align":"center"}},{default:n(()=>[o(f,null,{default:n(()=>[o(D,{modelValue:r.fileForm.fileType,"onUpdate:modelValue":t[0]||(t[0]=A=>r.fileForm.fileType=A),label:".zip",border:""},{default:n(()=>[ln]),_:1},8,["modelValue"])]),_:1}),o(f,null,{default:n(()=>[o(F,{"file-list":r.fileForm.fileZip,"onUpdate:file-list":t[1]||(t[1]=A=>r.fileForm.fileZip=A),drag:"",accept:".zip",ref:"uploadInput",action:"","http-request":d.handleUpload},{default:n(()=>[o(c,{size:48},{default:n(()=>[o(v)]),_:1}),rn]),_:1},8,["file-list","http-request"])]),_:1}),r.savingSuccessful?(_(),S("div",sn,[i("p",null,[an,o(c,null,{default:n(()=>[o(w)]),_:1})])])):L("",!0)]),_:1},8,["model"])]),_:1})):L("",!0)]),_:1})]),_:1})}var cn=I(Xo,[["render",dn],["__scopeId","data-v-1a6e1ead"]]),Ce={list(e){return x.get(`hilt/projects/${e}/labels/?page_size=100`)},update(e,t){return x.put(`hilt/projects/${e}/labels/${t.id}/`,t)}};const te=Q({id:"label",state:()=>({labels:[],labelsMap:{}}),getters:{getLabels:e=>e.labels,getLabelByID:e=>t=>!t||!(t in e.labelsMap)?null:e.labels[e.labelsMap[t]]},actions:{fetchLabels(){const e=W();return Ce.list(e.getProjectInfo.id).then(t=>{const s={};for(let a=0;a<t.results.length;a++){const r=t.results[a];s[r.id]=a}return this.labels=t.results,this.labelsMap=s,t.results})},updateLabel(e){const t=W();return Ce.update(t.getProjectInfo.id,e)}}}),un={name:"LabelModificationPage",components:{QuestionFilled:G},setup(){const e=te(),t=[];for(let s in q)t.push({id:s,name:q[s].name});return{labelStore:e,colorSetOptions:t}},data(){return{existingLabels:[],colors_sets:[],saving:!1}},methods:{goNextStep(){this.saving=!0;const e=[];for(let t=0;t<this.existingLabels.length;t++){const s=this.existingLabels[t],a=parseInt(this.colors_sets[t]);s.color_set!=a&&(s.color_set=a,e.push(this.labelStore.updateLabel(s)))}Promise.all(e).then(()=>{this.saving=!1,this.labelStore.fetchLabels(),this.$router.push({name:"GenerateExplanations"})})},getColors(e){return e=parseInt(e),e in q?q[e].colors:[]}},created(){this.labelStore.fetchLabels().then(e=>{const t={};for(let s in e)t[s]=""+e[s].color_set;this.colors_sets=t,this.existingLabels=e})},computed:{disableButton(){if(this.saving)return!0;const e={};for(let t in this.colors_sets){if(t in e)return!0;e[t]=null}return!1}}},pn=i("h3",null,"Label Space Creation",-1),_n={style:{"text-align":"left"}},mn=i("b",null,"Current Label Space",-1),gn={style:{"margin-left":"5px"}},hn=u(" Done ");function fn(e,t,s,a,r,d){const m=l("QuestionFilled"),c=l("el-icon"),p=l("el-popover"),g=l("el-col"),b=l("el-row"),h=l("el-divider"),D=l("el-option"),f=l("el-select"),v=l("el-form-item"),F=l("el-button"),w=l("el-form"),k=l("el-card");return _(),y(b,{style:{width:"100%"}},{default:n(()=>[o(k,{style:{width:"100%"}},{header:n(()=>[pn]),default:n(()=>[i("div",_n,[o(b,null,{default:n(()=>[o(g,{span:8},{default:n(()=>[o(p,{content:"Available labels for model to predict.",trigger:"hover"},{reference:n(()=>[i("span",null,[mn,o(c,{style:{"margin-left":"5px"}},{default:n(()=>[o(m)]),_:1})])]),_:1})]),_:1})]),_:1}),o(h),o(w,{model:r.colors_sets},{default:n(()=>[(_(!0),S(P,null,U(this.existingLabels,($,T)=>(_(),y(b,{key:$.id},{default:n(()=>[o(v,{label:$.text},{default:n(()=>[o(f,{modelValue:this.colors_sets[T],"onUpdate:modelValue":A=>this.colors_sets[T]=A,placeholder:"Select",style:{width:"100%"}},{default:n(()=>[(_(!0),S(P,null,U(this.colorSetOptions,A=>(_(),y(D,{key:A.id,label:A.name,value:A.id},null,8,["label","value"]))),128))]),_:2},1032,["modelValue","onUpdate:modelValue"])]),_:2},1032,["label"]),i("div",gn,[(_(!0),S(P,null,U(this.getColors(this.colors_sets[T]),(A,j)=>(_(),S("span",{key:j,style:N([A,{"margin-left":"5px",padding:"5px"}])}," Word ",4))),128))])]),_:2},1024))),128)),o(b,null,{default:n(()=>[o(F,{type:"success",disabled:this.disableButton,onClick:d.goNextStep},{default:n(()=>[hn]),_:1},8,["disabled","onClick"])]),_:1})]),_:1},8,["model"])])]),_:1})]),_:1})}var bn=I(un,[["render",fn]]),re={generateExplanations(e,t,{str:s,model_id:a,model_path:r}={}){console.log("inside network/explanations.js");const d=new FormData;return d.append("useHuggingface",t),t?d.append("str",s):(d.append("model_id",a),d.append("model_path",r)),console.log(d),x.post(`hilt/projects/${e}/explanations/`,d,{headers:R(B({},x.defaults.headers),{"Content-Type":"multipart/form-data"})})},didFinishGeneration(e){return x.get(`hilt/projects/${e}/update/model_status/`)},getAttributeScoresForDoc(e,t,s,a){console.log("inside network/getAttributeScoresForDoc function");const r=new FormData;return r.append("text",t),r.append("label",s),r.append("model_id",a),console.log("explanations/single",r),x.post(`hilt/projects/${e}/explanations/single`,r,{headers:R(B({},x.defaults.headers),{"Content-Type":"multipart/form-data"})})}};const yn={name:"GenerateExplanationTutorial",props:{dialogVisible:Boolean,existingInfo:Object},setup(){},data(){return{}},methods:{}},Sn=i("span",{slot:"title",style:{"font-size":"18pt","font-weight":"bold"}},"Explanation Generation",-1),wn=i("div",{class:"container"},[i("div",{class:"row",style:{padding:"10px"}},[i("br"),i("br"),i("p",{class:"text",style:{"font-size":"15pt","text-align":"justify"}},[u(" Load the model trained on the train data from local or huggingface modelhub. "),i("br"),u(" Use that model to generate explanations for the train data. "),i("br")])])],-1),vn={class:"dialog-footer"},xn=u(" Understand ");function Dn(e,t,s,a,r,d){const m=l("el-button"),c=l("el-dialog");return _(),y(c,{modelValue:s.dialogVisible,"onUpdate:modelValue":t[1]||(t[1]=p=>s.dialogVisible=p),"onUpdate:visible":t[2]||(t[2]=p=>e.$emit("update:dialogVisible",p)),onClose:t[3]||(t[3]=p=>e.$emit("update:dialogVisible",!1)),width:"50%"},{footer:n(()=>[i("span",vn,[o(m,{onClick:t[0]||(t[0]=()=>e.$emit("update:dialogVisible",!1))},{default:n(()=>[xn]),_:1})])]),default:n(()=>[Sn,wn]),_:1},8,["modelValue"])}var $n=I(yn,[["render",Dn]]);const kn={name:"GenerateExplanations",components:{Tools:Le,QuestionFilled:G,GenerateExplanationTutorial:$n},setup(){return{projectStore:W()}},data(){return{tutorialVisible:!0,generating_explanations:!1,huggingfaceForm:{str:"cardiffnlp/bertweet-base-hate",rules:{str:{required:!0,message:"Please input huggingface model name",trigger:"blur"}}},customModelForm:{modelList:[],select:"",rules:{select:{required:!0,message:"Please select model",trigger:"change"}}},loadingExplanations:!1,percentage:0,colors:[{color:"#f56c6c",percentage:20},{color:"#e6a23c",percentage:40},{color:"#5cb87a",percentage:60},{color:"#1989fa",percentage:80},{color:"#6f7ad3",percentage:100}]}},methods:{getModelList(){console.log("model list"),X.list(this.projectStore.getProjectInfo.id).then(e=>{this.customModelForm.modelList=e.results})},huggingfaceSubmit(){this.$refs.huggingfaceForm.validate(e=>{e&&(console.log("huggingface generate explanations"),this.loadingExplanations=!0,re.generateExplanations(this.projectStore.getProjectInfo.id,!0,{str:this.huggingfaceForm.str}).then(t=>{console.log("Here"),console.log(t),this.generating_explanations=!0,this.waitForCompletion(),Y({title:"Explanation Generation Started",message:"Page will automatically change once task is completed",type:"success",duration:0})}).catch(t=>{this.loadingExplanations=!1,t.response&&t.response.data?this.$notify.error({title:"Model training failed",message:t.response.data}):this.$notify.error({title:"Model failed to start training",message:"Please try again later"})}))})},customModelSubmit(){this.$refs.customModelForm.validate(e=>{e&&(console.log("custom model generate explanations"),console.log("model_id:",this.customModelForm.select[0]),console.log("model_path",this.customModelForm.select[1]),this.loadingExplanations=!0,Y({title:"Started",message:"Task accepted",type:"success",duration:4500}),re.generateExplanations(this.projectStore.getProjectInfo.id,!1,{model_id:this.customModelForm.select[0],model_path:this.customModelForm.select[1]}).then(t=>{const s=this.projectStore.getProjectInfo;this.projectStore.reset_state(),console.log(s.explanations_status),console.log(t),this.generating_explanations=!0,this.waitForCompletion(),Y({title:"Explanation Generation Started",message:"Page will automatically change once task is",type:"success",duration:0})}).catch(t=>{this.loadingExplanations=!1,console.log(t),t.response&&t.response.data?this.$notify.error({title:"Model training failed",message:t.response.data}):this.$notify.error({title:"Model failed to start training",message:"Please try again later"})}))})},waitForCompletion(){let e=60,t=setInterval(()=>re.didFinishGeneration(this.projectStore.getProjectInfo.id).then(s=>{this.percentage=this.percentage+100/e,console.log(this.percentage),console.log(s),e<0||s.status=="finished"?(console.log("finished"),this.loadingExplanations=!1,this.$notify.success({title:"Success",message:"Model Execution had been completed",duration:0}),clearInterval(t),this.$router.push({name:"DebugOverview"})):(console.log("Waiting for model finish message."),e-=1,console.log(e))}),2*1e3)}},mounted(){this.getModelList()}},In=u(" Generate Explanations Page "),Cn=u(" Generate Explanations "),jn=u("Generate Explanations");function Fn(e,t,s,a,r,d){const m=l("QuestionFilled"),c=l("el-icon"),p=l("el-popover"),g=l("el-input"),b=l("el-col"),h=l("el-form-item"),D=l("el-button"),f=l("el-form"),v=l("el-tab-pane"),F=l("el-option"),w=l("el-select"),k=l("el-tabs"),$=l("el-progress"),T=l("el-row"),A=l("el-card"),j=l("GenerateExplanationTutorial");return _(),S(P,null,[o(A,{style:{width:"100%"}},{default:n(()=>[i("h3",null,[In,o(p,{content:"Generate model attribution scores using Captum (https://captum.ai/tutorials/)",trigger:"hover",width:400},{reference:n(()=>[o(c,{style:{height:"100%","margin-left":"0.5rem"}},{default:n(()=>[o(m)]),_:1})]),_:1})]),o(k,{type:"border-card"},{default:n(()=>[o(v,{label:"Huggingface"},{default:n(()=>[o(f,{model:r.huggingfaceForm,ref:"huggingfaceForm",rules:r.huggingfaceForm.rules,"label-position":"top"},{default:n(()=>[o(h,{label:"huggingface model name",prop:"str"},{default:n(()=>[o(b,{span:6},{default:n(()=>[o(g,{modelValue:r.huggingfaceForm.str,"onUpdate:modelValue":t[0]||(t[0]=M=>r.huggingfaceForm.str=M)},null,8,["modelValue"])]),_:1}),o(p,{content:"Search your model from Huggingface model hub (https://huggingface.co/models)",trigger:"hover",width:400},{reference:n(()=>[o(c,{style:{height:"100%","margin-left":"0.5rem"}},{default:n(()=>[o(m)]),_:1})]),_:1})]),_:1}),o(h,null,{default:n(()=>[o(D,{type:"primary",onClick:d.huggingfaceSubmit,loading:r.loadingExplanations},{default:n(()=>[Cn]),_:1},8,["onClick","loading"])]),_:1})]),_:1},8,["model","rules"])]),_:1}),o(v,{label:"Custom Model"},{default:n(()=>[o(f,{model:r.customModelForm,ref:"customModelForm",rules:r.customModelForm.rules,"label-position":"top"},{default:n(()=>[o(h,{label:"Custom Model",prop:"select"},{default:n(()=>[o(w,{modelValue:r.customModelForm.select,"onUpdate:modelValue":t[1]||(t[1]=M=>r.customModelForm.select=M),clearable:"",placeholder:"Select Model"},{default:n(()=>[(_(!0),S(P,null,U(r.customModelForm.modelList,M=>(_(),y(F,{key:M.id,label:M.name,value:[M.id,M.model]},null,8,["label","value"]))),128))]),_:1},8,["modelValue"]),o(p,{content:"Select your custom model. You can upload your model in project setup.",trigger:"hover",width:400},{reference:n(()=>[o(c,{style:{height:"100%","margin-left":"0.5rem"}},{default:n(()=>[o(m)]),_:1})]),_:1})]),_:1}),o(h,null,{default:n(()=>[o(D,{type:"primary",onClick:d.customModelSubmit,loading:r.loadingExplanations},{default:n(()=>[jn]),_:1},8,["onClick","loading"])]),_:1})]),_:1},8,["model","rules"])]),_:1})]),_:1}),o(T,{justify:"center",style:{"margin-top":"1em"}},{default:n(()=>[r.loadingExplanations?(_(),y($,{key:0,type:"dashboard",percentage:Math.round(r.percentage),color:r.colors},null,8,["percentage","color"])):L("",!0)]),_:1})]),_:1}),o(j,{"dialog-visible":r.tutorialVisible,"onUpdate:dialog-visible":t[2]||(t[2]=M=>r.tutorialVisible=M)},null,8,["dialog-visible"])],64)}var Pn=I(kn,[["render",Fn]]);const Vn={name:"ExportData",components:{Download:be,QuestionFilled:G},setup(){return{projectStore:W()}},methods:{exportJSON(){this.projectStore.exportJSON().then(e=>{He(JSON.stringify(e,null,1),`${this.projectStore.getProjectInfo.name}.json`)})}}},Ln=u("Export Explanation-Generated Data "),Tn=u(" Download JSON data ");function Wn(e,t,s,a,r,d){const m=l("QuestionFilled"),c=l("el-icon"),p=l("el-popover"),g=l("Download"),b=l("el-button");return _(),S(P,null,[i("h3",null,[Ln,o(p,{content:"help text",trigger:"hover",width:400},{reference:n(()=>[o(c,{style:{height:"100%","margin-left":"0.5rem"}},{default:n(()=>[o(m)]),_:1})]),_:1})]),o(b,{type:"primary",onClick:t[0]||(t[0]=h=>d.exportJSON())},{default:n(()=>[o(c,null,{default:n(()=>[o(g)]),_:1}),Tn]),_:1})],64)}var An=I(Vn,[["render",Wn]]);const En={name:"SetupSideBar",components:{Back:ae,Document:Ke,DocumentCopy:Ye,List:Ze,Management:Xe,DataAnalysis:Ve}},xe=e=>(H("data-v-c9efccda"),e=e(),K(),e),Un=xe(()=>i("span",null,"Back",-1)),Mn=xe(()=>i("span",null,"Debug Overview",-1)),Bn=xe(()=>i("span",null,"Evaluation",-1));function zn(e,t,s,a,r,d){const m=l("Back"),c=l("el-icon"),p=l("el-menu-item"),g=l("Management"),b=l("DataAnalysis"),h=l("el-menu"),D=l("el-col");return _(),y(D,null,{default:n(()=>[o(h,{"default-active":e.$route.path},{default:n(()=>[o(p,{index:"1",onClick:t[0]||(t[0]=()=>this.$router.push({name:"GenerateExplanations"}))},{default:n(()=>[o(c,null,{default:n(()=>[o(m)]),_:1}),Un]),_:1}),o(p,{index:"/debug/overview",onClick:t[1]||(t[1]=()=>this.$router.push({name:"DebugOverview"}))},{default:n(()=>[o(c,null,{default:n(()=>[o(g)]),_:1}),Mn]),_:1}),o(p,{index:"/debug/evaluation",onClick:t[2]||(t[2]=()=>this.$router.push({name:"DebugEvaluation"}))},{default:n(()=>[o(c,null,{default:n(()=>[o(b)]),_:1}),Bn]),_:1})]),_:1},8,["default-active"])]),_:1})}var On=I(En,[["render",zn],["__scopeId","data-v-c9efccda"]]);const De=Q({id:"detailedDocument",state:()=>({document:null,maxWords:50}),getters:{getDocument:e=>e.document,getMaxWords:e=>e.maxWords},actions:{fetchDocument(e){const t=W();return Z.detailedDocument(t.getProjectInfo.id,e).then(s=>{const a={};for(let r of s.words){const d={};for(let m of r.word_annotation_score)d[m.annotation]=m,m.annotation in a||(a[m.annotation]=[]),a[m.annotation].push([m.score,m]);r.scores=d,delete r.word_annotation_score}for(let r in a){const d=a[r];d.sort((c,p)=>p[0]-c[0]);let m=0;for(let c=0;c<d.length;c++){const p=d[c];c>0&&d[c-1][0]!==p[0]&&(m=c),p[1].order=m}}this.document=s})}}});var me={list(e,t){const s=t!==void 0?`&doc_id=${t}`:"";return x.get(`hilt/projects/${e}/dict/local/?page_size=10000`+s)},create(e,t){return x.post(`hilt/projects/${e}/dict/local/`,t)},delete(e,t){return x.delete(`hilt/projects/${e}/dict/local/${t}/`)}};const ue=Q({id:"dictionary_local",state:()=>({documents:{},annotatedDocCount:0}),getters:{getByDocumentID:e=>t=>e.documents[t],fetchIfExists:e=>(t,s,a)=>{if(!(t in e.documents))return null;const r=e.documents[t];if(!(s in r))return null;const d=r[s];return a in d?d[a]:null},getLocalInfo:e=>e},actions:{fetchDictionary(e){const t=W();return me.list(t.getProjectInfo.id,e).then(s=>{const a=s.results,r={};let d=0;for(let m of a){const c=m.word.document;c in r||(r[c]={},d+=1);const p=m.word.id;p in r[c]||(r[c][p]={});const g=m.annotation;r[c][p][g]=m}this.documents=r,this.annotatedDocCount=d,console.log(`dictionaryLocal -> fetchDictionary: annotatedDocCount ${d}`)})},addWord(e,t){const s=W();return me.create(s.getProjectInfo.id,t).then(()=>{this.fetchDictionary(e)})},deleteWord(e){const t=W();return me.delete(t.getProjectInfo.id,e).then(()=>this.fetchDictionary())}}});const Nn={name:"LocalSideBar",components:{Back:ae,Check:Se},setup(){const e=le(),t=De(),s=te(),a=ue();return{documentStore:e,detailedDocumentStore:t,labelStore:s,localDictionaryStore:a}},data(){return{docs:[]}},created(){const e=[];e.push(this.labelStore.fetchLabels()),e.push(this.documentStore.resetState().then(()=>this.localDictionaryStore.fetchDictionary(this.documentStore.getDocuments[this.documentStore.getdocumentInfo.curDocIndex].id))),Promise.all(e).then(()=>{this.detailedDocumentStore.fetchDocument(this.documentStore.getDocuments[this.documentStore.getdocumentInfo.curDocIndex].id),this.docs=this.documentStore.getDocuments,console.log("updating docs data")})},methods:{pageChanged(e){this.documentStore.updateCurPage(e).then(t=>{this.docs=t.results.results,console.log("updating docs data"),this.detailedDocumentStore.fetchDocument(this.documentStore.getDocuments[this.documentStore.getdocumentInfo.curDocIndex].id)})},goToDocument(e,t){this.documentStore.setCurDocIndex(e),this.detailedDocumentStore.fetchDocument(t.id),this.localDictionaryStore.fetchDictionary(t.id)},truncate(e,t){return e.length>t?e.substring(0,t)+"...":e}}},Qn=e=>(H("data-v-35321ea0"),e=e(),K(),e),Gn=Qn(()=>i("span",null,"Back",-1)),Rn={key:0},qn={key:1};function Jn(e,t,s,a,r,d){const m=l("Back"),c=l("el-icon"),p=l("el-menu-item"),g=l("el-menu"),b=l("Check"),h=l("el-table-column"),D=l("el-link"),f=l("el-table"),v=l("el-pagination"),F=l("el-col");return _(),y(F,null,{default:n(()=>[o(g,null,{default:n(()=>[o(p,{onClick:t[0]||(t[0]=()=>this.$router.push({name:"DebugOverview"}))},{default:n(()=>[o(c,null,{default:n(()=>[o(m)]),_:1}),Gn]),_:1})]),_:1}),o(f,{data:Array.from(r.docs)},{default:n(()=>[o(h,{width:"40"},{default:n(w=>[w.row.annotated?(_(),S("span",Rn,[o(c,null,{default:n(()=>[o(b)]),_:1})])):(_(),S("div",qn,V(a.documentStore.getdocumentInfo.pageSize*(a.documentStore.getdocumentInfo.curPage-1)+w.$index+1),1))]),_:1}),o(h,{prop:"text"},{default:n(w=>[o(D,{onClick:k=>d.goToDocument(w.$index,w.row)},{default:n(()=>[u(V(this.truncate(w.row.text,100)),1)]),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"]),o(v,{background:"",layout:"prev, pager, next",total:a.documentStore.getdocumentInfo.totalDocCount,"page-size":a.documentStore.getdocumentInfo.pageSize,"current-page":a.documentStore.getdocumentInfo.curPage,onCurrentChange:d.pageChanged,style:{"text-align":"center"}},null,8,["total","page-size","current-page","onCurrentChange"])]),_:1})}var Hn=I(Nn,[["render",Jn],["__scopeId","data-v-35321ea0"]]),je={list(e,t,s,a){const r={};return t&&(r.page=t),s!=null&&(r.page_size=s),a!=null&&(r.q=a),x.get(`hilt/projects/${e}/words/`,{params:r})},documents(e,t){return x.get(`hilt/projects/${e}/words/${t}/`)}};const pe=Q({id:"words",state:()=>({words:[],curPage:1,maxPage:1,totalWordCount:0,curWordIndex:0,pageSize:10,currDocuments:[],searchQuery:void 0,wordLoaded:!1}),getters:{getWords:e=>e.words,getWordInfo:e=>e,getCurrWord:e=>()=>e.words[e.curWordIndex]?e.words[e.curWordIndex].text:void 0,getDocuments:e=>e.currDocuments},actions:{resetState(e=void 0){return this.curPage=1,this.pageSize=10,this.currDocuments=[],this.searchQuery=e,this.fetchWords()},setCurWordIndex(e){this.curWordIndex=e},fetchWords(){const e=W();return je.list(e.getProjectInfo.id,this.curPage,this.pageSize,this.searchQuery).then(t=>(this.words=t.results,this.totalWordCount=t.count,this.maxPage=Math.ceil(this.totalWordCount/this.pageSize),t))},updateCurPage(e){return this.curPage=e,this.curWordIndex=0,this.currDocuments=[],this.fetchWords()},fetchDocuments(){this.wordLoaded=!1;const e=W();return je.documents(e.getProjectInfo.id,this.getCurrWord()).then(t=>{for(const s of t.results)for(let a of s.words){const r={};for(let d of a.word_annotation_score)r[d.annotation]=d;a.scores=r,delete a.word_annotation_score}this.currDocuments=t.results,this.wordLoaded=!0})}}});var ge={list(e,t){const s=t!==void 0?`&q=${t}`:"";return x.get(`hilt/projects/${e}/dict/global/?page_size=10000`+s)},create(e,t){return x.post(`hilt/projects/${e}/dict/global/`,t)},update(e,t){return x.put(`hilt/projects/${e}/dict/global/${t.id}/`,t)},delete(e,t){return x.delete(`hilt/projects/${e}/dict/global/${t}/`)}};const _e=Q({id:"dictionary_global",state:()=>({words:{},wordRows:[]}),getters:{getWords:e=>e.words,getRows:e=>e.wordRows,containsWord:e=>t=>t in e.words},actions:{fetchDictionary(e=void 0){const t=W();return ge.list(t.getProjectInfo.id,e).then(s=>{const a=s.results,r={},d=[];for(let m of a)r[m.word]=d.length,d.push(m);this.words=r,this.wordRows=d})},addWord(e,t,s){const a=W();return ge.create(a.getProjectInfo.id,{word:e,modification_type:t,ground_truth_label:s}).then(r=>{this.words[e]=this.wordRows.length,this.wordRows.push(r),console.log(`added global word ${e}`)})},deleteWord(e){console.log(`deleted global word ${e}`);const t=W();return ge.delete(t.getProjectInfo.id,this.wordRows[this.words[e]].id).then(()=>this.fetchDictionary())}}});const Kn={name:"GlobalSideBar",components:{Back:ae,Check:Se,Search:ye},setup(){const e=te(),t=pe(),s=_e();return{labelStore:e,wordStore:t,globalDictionaryStore:s}},data(){return{searchQuery:""}},watch:{searchQuery:function(e,t){console.log(e),e===""?this.wordStore.resetState().then(()=>{this.wordStore.fetchDocuments()}):this.wordStore.resetState(e).then(()=>{this.wordStore.fetchDocuments()})}},created(){this.$route.query.q!==void 0&&(this.searchQuery=this.$route.query.q);const e=[];e.push(this.labelStore.fetchLabels()),e.push(this.globalDictionaryStore.fetchDictionary()),this.searchQuery===""?e.push(this.wordStore.resetState()):e.push(this.wordStore.resetState(this.searchQuery)),Promise.all(e).then(()=>{this.wordStore.fetchDocuments()})},methods:{tableRowStyle({row:e}){return this.globalDictionaryStore.containsWord(e.text)?this.globalDictionaryStore.getRows[this.globalDictionaryStore.getWords[e.text]].modification_type==0?{color:"white",backgroundColor:"#67C23A"}:{color:"white",backgroundColor:"#F56C6C"}:{}},pageChanged(e){this.wordStore.updateCurPage(e).then(()=>{this.wordStore.fetchDocuments()})},goToDocument(e){this.wordStore.setCurWordIndex(e),this.wordStore.fetchDocuments()}}},Yn=e=>(H("data-v-5cdc2f13"),e=e(),K(),e),Zn=Yn(()=>i("span",null,"Back",-1)),Xn={style:{"align-content":"center"}},el={key:0},tl={key:1};function ol(e,t,s,a,r,d){const m=l("Back"),c=l("el-icon"),p=l("el-menu-item"),g=l("el-menu"),b=l("Search"),h=l("el-input"),D=l("Check"),f=l("el-table-column"),v=l("el-link"),F=l("el-table"),w=l("el-pagination"),k=l("el-col"),$=we("snip");return _(),y(k,null,{default:n(()=>[o(g,null,{default:n(()=>[o(p,{onClick:t[0]||(t[0]=()=>this.$router.push({name:"DebugOverview"}))},{default:n(()=>[o(c,null,{default:n(()=>[o(m)]),_:1}),Zn]),_:1})]),_:1}),o(h,{modelValue:r.searchQuery,"onUpdate:modelValue":t[1]||(t[1]=T=>r.searchQuery=T),placeholder:"Type to search for words",style:{"margin-top":"20px",width:"90%"},clearable:""},{prefix:n(()=>[i("div",Xn,[o(c,null,{default:n(()=>[o(b)]),_:1})])]),_:1},8,["modelValue"]),o(F,{data:Array.from(a.wordStore.getWords),"row-style":d.tableRowStyle},{default:n(()=>[o(f,{width:"40"},{default:n(T=>[a.globalDictionaryStore.containsWord(T.row.text)?(_(),S("span",el,[o(c,null,{default:n(()=>[o(D)]),_:1})])):(_(),S("div",tl,V(a.wordStore.getWordInfo.pageSize*(a.wordStore.getWordInfo.curPage-1)+T.$index+1),1))]),_:1}),o(f,{prop:"text"},{default:n(T=>[ve((_(),y(v,{key:T.row.text,onClick:A=>d.goToDocument(T.$index)},{default:n(()=>[u(V(T.row.text),1)]),_:2},1032,["onClick"])),[[$,{lines:3}]])]),_:1})]),_:1},8,["data","row-style"]),o(w,{background:"",layout:"prev, pager, next",total:a.wordStore.getWordInfo.totalWordCount,"page-size":a.wordStore.getWordInfo.pageSize,"current-page":a.wordStore.getWordInfo.curPage,onCurrentChange:d.pageChanged,style:{"text-align":"center"}},null,8,["total","page-size","current-page","onCurrentChange"])]),_:1})}var nl=I(Kn,[["render",ol],["__scopeId","data-v-5cdc2f13"]]);const ll={name:"DebugPage",components:{OverviewSideBar:On,LocalSideBar:Hn,GlobalSideBar:nl}};function rl(e,t,s,a,r,d){const m=l("OverviewSideBar"),c=l("LocalSideBar"),p=l("GlobalSideBar"),g=l("el-aside"),b=l("router-view"),h=l("el-main"),D=l("el-container");return _(),S("div",null,[o(D,null,{default:n(()=>[o(g,{style:{"border-right":"solid 1px #e6e6e6"}},{default:n(()=>[this.$route.path.endsWith("/overview")||this.$route.path.endsWith("/dictionary")||this.$route.path.endsWith("/evaluation")?(_(),y(m,{key:0,style:{width:"100%"}})):L("",!0),this.$route.path.endsWith("/local")?(_(),y(c,{key:1,style:{width:"100%"}})):L("",!0),this.$route.path.endsWith("/global")?(_(),y(p,{key:2,style:{width:"100%"}})):L("",!0)]),_:1}),o(h,null,{default:n(()=>[o(b)]),_:1})]),_:1})])}var sl=I(ll,[["render",rl]]),he={train(e){return x.post(`hilt/projects/${e}/debug/training/`,{headers:B({},x.defaults.headers)})},didFinishGeneration(e){return x.get(`hilt/projects/${e}/update/training_debug_model_status/`)}};const il={name:"DebugTutorial",props:{dialogVisible:Boolean,existingInfo:Object},setup(){},data(){return{}},methods:{}},al=i("span",{slot:"title",style:{"font-size":"18pt","font-weight":"bold"}},"Model Debugging",-1),dl=i("div",{class:"container"},[i("div",{class:"row",style:{padding:"10px"}},[i("br"),i("br"),i("p",{class:"text",style:{"font-size":"15pt","text-align":"justify"}},[u(" You will debug the model by selecting words to increase or decrease its importance score. "),i("br"),u(" You can select words for each instance (Instance Explanation) or words that apply to all instances (Task Explanation). "),i("br")])])],-1),cl={class:"dialog-footer"},ul=u(" Understand ");function pl(e,t,s,a,r,d){const m=l("el-button"),c=l("el-dialog");return _(),y(c,{modelValue:s.dialogVisible,"onUpdate:modelValue":t[1]||(t[1]=p=>s.dialogVisible=p),"onUpdate:visible":t[2]||(t[2]=p=>e.$emit("update:dialogVisible",p)),onClose:t[3]||(t[3]=p=>e.$emit("update:dialogVisible",!1)),width:"50%"},{footer:n(()=>[i("span",cl,[o(m,{onClick:t[0]||(t[0]=()=>e.$emit("update:dialogVisible",!1))},{default:n(()=>[ul]),_:1})])]),default:n(()=>[al,dl]),_:1},8,["modelValue"])}var _l=I(il,[["render",pl]]);const ml={name:"DebugOverview",components:{QuestionFilled:G,DebugTutorial:_l},setup(){const e=W(),t=le(),s=_e(),a=ue(),r=pe();return{projectStore:e,documentStore:t,globalDictionaryStore:s,localDictionaryStore:a,wordStore:r}},data(){return{tutorialVisible:!0,loadingExplanations:!1,percentage:0,colors:[{color:"#f56c6c",percentage:20},{color:"#e6a23c",percentage:40},{color:"#5cb87a",percentage:60},{color:"#1989fa",percentage:80},{color:"#6f7ad3",percentage:100}]}},created(){const e=[];e.push(this.globalDictionaryStore.fetchDictionary()),e.push(this.localDictionaryStore.fetchDictionary()),e.push(this.documentStore.fetchDocuments()),e.push(this.wordStore.resetState()),Promise.all(e).then(()=>{this.wordStore.fetchDocuments()})},methods:{getInstanceProgressBarLabel(){let e=this.documentStore.getdocumentInfo;return`${this.localDictionaryStore.getLocalInfo.annotatedDocCount} / ${e.totalDocCount} sentences annotated`},getTaskProgressBarLabel(){return`${this.globalDictionaryStore.getRows.length} / ${this.wordStore.getWordInfo.totalWordCount} words annotated`},fetchDebugScores(e){return Z.detailedDocument(this.projectStore.getProjectInfo.id,e).then(t=>{console.log(t),console.log(t.words);for(let s of t.words)console.log("word:",s.text),console.log("initial score:",s.word_annotation_score[0].score)})},trainDebugModel(){this.loadingExplanations=!0,he.train(this.projectStore.getProjectInfo.id).then(e=>{console.log("Here"),console.log(e),this.waitForCompletion(),Y({title:"Debug Training Started",message:"Page will automatically change once task is completed",type:"success",duration:0})}).catch(e=>{this.loadingExplanations=!1,e.response&&e.response.data?this.$notify.error({title:"Model training failed",message:e.response.data}):this.$notify.error({title:"Model failed to start training",message:"Please try again later"})}),this.fetchDebugScores(this.documentStore.getDocuments[1].id)},waitForCompletion(){let e=60,t=setInterval(()=>he.didFinishGeneration(this.projectStore.getProjectInfo.id).then(s=>{this.percentage=this.percentage+100/e,e<0||s.status=="finished"?(console.log("finished"),this.loadingExplanations=!1,this.$notify.success({title:"Success",message:"Model Execution had been completed",duration:0}),clearInterval(t),this.$router.push({name:"DebugEvaluation"})):(console.log("Waiting for model finish message."),e-=1,console.log(e))}),10*1e3)}},computed:{instanceAnnotationCompletionPercentage(){let e=this.documentStore.getdocumentInfo,t=this.localDictionaryStore.getLocalInfo;return e.totalDocCount==0?0:100*t.annotatedDocCount/e.totalDocCount},taskAnnotationCompletionPercentage(){let e=this.wordStore.getWordInfo;return e.totalWordCount==0?0:100*Array.from(this.globalDictionaryStore.getRows).length/e.totalWordCount}}},gl=u(" Debug Overview Page "),hl=u(" Start Debug Training "),fl=i("br",null,null,-1),bl={style:{"padding-right":"1em"}},yl=u("Instance Explanation "),Sl=u(" Start Annotating "),wl={style:{"padding-right":"1em"}},vl=u("Task Explanation "),xl=u(" Start Annotating ");function Dl(e,t,s,a,r,d){const m=l("QuestionFilled"),c=l("el-icon"),p=l("el-popover"),g=l("el-button"),b=l("el-col"),h=l("el-progress"),D=l("el-row"),f=l("DebugTutorial");return _(),S(P,null,[i("h3",null,[gl,o(p,{content:"Overview of Human Debugging Phase. Perform task and instance annotation to start debugging phase",trigger:"hover",width:400},{reference:n(()=>[o(c,{style:{height:"100%","margin-left":"0.5rem"}},{default:n(()=>[o(m)]),_:1})]),_:1})]),o(D,null,{default:n(()=>[o(b,{span:6},{default:n(()=>[o(g,{type:"primary",onClick:t[0]||(t[0]=v=>d.trainDebugModel())},{default:n(()=>[hl]),_:1})]),_:1}),o(b,{span:6},{default:n(()=>[r.loadingExplanations?(_(),y(h,{key:0,type:"dashboard",percentage:Math.round(r.percentage),color:r.colors},null,8,["percentage","color"])):L("",!0)]),_:1})]),_:1}),fl,o(D,{style:{width:"100%","margin-top":"3em"}},{default:n(()=>[i("span",bl,[yl,o(p,{content:"Select words to debug for each instance",trigger:"hover",width:400},{reference:n(()=>[o(c,{style:{height:"100%","margin-left":"0.5rem"}},{default:n(()=>[o(m)]),_:1})]),_:1})]),o(g,{size:"small",onClick:t[1]||(t[1]=()=>this.$router.push({name:"DebugLocal"}))},{default:n(()=>[Sl]),_:1}),o(h,{style:{width:"100%","margin-top":"1em"},percentage:d.instanceAnnotationCompletionPercentage,format:d.getInstanceProgressBarLabel,type:"line","stroke-width":30,"text-inside":""},null,8,["percentage","format"])]),_:1}),o(D,{style:{width:"100%","margin-top":"3em"}},{default:n(()=>[i("span",wl,[vl,o(p,{content:"Select words to debug for all instances",trigger:"hover",width:400},{reference:n(()=>[o(c,{style:{height:"100%","margin-left":"0.5rem"}},{default:n(()=>[o(m)]),_:1})]),_:1})]),o(g,{size:"small",onClick:t[2]||(t[2]=()=>this.$router.push({name:"DebugGlobal"}))},{default:n(()=>[xl]),_:1}),o(h,{style:{width:"100%","margin-top":"1em"},percentage:d.taskAnnotationCompletionPercentage,format:d.getTaskProgressBarLabel,type:"line","stroke-width":30,"text-inside":""},null,8,["percentage","format"])]),_:1}),o(f,{"dialog-visible":r.tutorialVisible,"onUpdate:dialog-visible":t[3]||(t[3]=v=>r.tutorialVisible=v)},null,8,["dialog-visible"])],64)}var $l=I(ml,[["render",Dl]]);const kl={name:"LocalDebugTutorial",props:{dialogVisible:Boolean,existingInfo:Object},setup(){},data(){return{}},methods:{}},Il=i("span",{slot:"title",style:{"font-size":"18pt","font-weight":"bold"}},"Instance Explanation",-1),Cl=i("div",{class:"container"},[i("div",{class:"row",style:{padding:"10px"}},[i("br"),i("br"),i("p",{class:"text",style:{"font-size":"15pt","text-align":"justify"}},[u(" Select words to debug for each instance. "),i("br"),u(" Attribution scores refer to how much the word positively correlates to the ground truth label. "),i("br")])])],-1),jl={class:"dialog-footer"},Fl=u(" Understand ");function Pl(e,t,s,a,r,d){const m=l("el-button"),c=l("el-dialog");return _(),y(c,{modelValue:s.dialogVisible,"onUpdate:modelValue":t[1]||(t[1]=p=>s.dialogVisible=p),"onUpdate:visible":t[2]||(t[2]=p=>e.$emit("update:dialogVisible",p)),onClose:t[3]||(t[3]=p=>e.$emit("update:dialogVisible",!1)),width:"50%"},{footer:n(()=>[i("span",jl,[o(m,{onClick:t[0]||(t[0]=()=>e.$emit("update:dialogVisible",!1))},{default:n(()=>[Fl]),_:1})])]),default:n(()=>[Il,Cl]),_:1},8,["modelValue"])}var Vl=I(kl,[["render",Pl]]);const Ll={name:"LocalExplanations",components:{ArrowLeft:Te,ArrowRight:We,Delete:ie,QuestionFilled:G,LocalDebugTutorial:Vl},setup(){const e=le(),t=De(),s=W(),a=ue(),r=te();return{documentStore:e,detailedDocumentStore:t,projectStore:s,localDictionaryStore:a,labelStore:r,TaskTypes:O,getLabelByID:r.getLabelByID}},data(){return{tutorialVisible:!0,topK:3}},methods:{wordDelete(e){console.log("vue delete word"),this.localDictionaryStore.deleteWord(e).then(this.updateAnnotation())},wordClick(e,t,s){const a=this.detailedDocumentStore.getDocument.id,r=this.localDictionaryStore.fetchIfExists(a,t,e);r===null?s>=0&&this.localDictionaryStore.addWord(a,{word:t,annotation:e,modification_type:s}).then(()=>this.updateAnnotation()):s==-1&&this.wordDelete(r.id)},getWordStyle(e,t){const s={padding:"3px 3px 3px 3px",margin:"3px 3px 3px 3px",fontSize:"18px"};if(this.topK>0&&e.order>=this.topK)return s;const a=e.score,r=q[1].colors;let d=-1;return a<=.1?s:(a<=.5?d=0:a<=.75?d=1:a<=1&&(d=2),B(B({},s),r[d]))},getProgressBarLabel(){let e=this.documentStore.getdocumentInfo;return`${e.annotatedDocCount} / ${e.totalDocCount} documents annotated`},goToPrevDoc(){this.updateAnnotation();const e=this.documentStore.getdocumentInfo.curDocIndex-1;e==-1?this.documentStore.updateCurPage(this.documentStore.getdocumentInfo.curPage-1).then(()=>{this.documentStore.setCurDocIndex(this.documentStore.getDocuments.length-1),this.detailedDocumentStore.fetchDocument(this.documentStore.getDocuments[this.documentStore.getDocuments.length-1].id)}):(this.documentStore.setCurDocIndex(e),this.detailedDocumentStore.fetchDocument(this.documentStore.getDocuments[e].id))},goToNextDoc(){this.updateAnnotation();const e=this.documentStore.getdocumentInfo.curDocIndex+1;this.documentStore.getDocuments.length==e?this.documentStore.updateCurPage(this.documentStore.getdocumentInfo.curPage+1).then(()=>{this.detailedDocumentStore.fetchDocument(this.documentStore.getDocuments[0].id),this.localDictionaryStore.fetchDictionary(this.documentStore.getDocuments[0].id)}):(this.documentStore.setCurDocIndex(e),this.detailedDocumentStore.fetchDocument(this.documentStore.getDocuments[e].id),this.localDictionaryStore.fetchDictionary(this.documentStore.getDocuments[e].id))},noAnnotation(){this.documentStore.markAnnotated().then(()=>{const e=this.documentStore.getdocumentInfo.curDocIndex+1;this.documentStore.getDocuments.length!==e&&this.documentStore.getdocumentInfo.curPage!==this.documentStore.getdocumentInfo.maxPage&&this.goToNextDoc()})},updateAnnotation(){const e=this.detailedDocumentStore.getDocument.id;this.localDictionaryStore.getByDocumentID(e)!==void 0?(console.log("Marking Annotated"),this.documentStore.markAnnotated(!0)):(console.log("Unmarking Annotated"),this.documentStore.markAnnotated(!1))},trainDebugModel(){he.train(this.projectStore.getProjectInfo.id)}},computed:{annotationCompletionPercentage:function(){let e=this.documentStore.getdocumentInfo;return e.totalDocCount==0?0:100*e.annotatedDocCount/e.totalDocCount},dictTableData:function(){const e=this.detailedDocumentStore.getDocument.id,t=this.localDictionaryStore.getByDocumentID(e),s=[];if(e===void 0||t===void 0)return s;const a=this.detailedDocumentStore.getDocument.words;for(const r of a){const d=r.id;if(!(d in t))continue;const m=t[d];for(const c in m){const p=m[c].id,g=r.scores[c].score;let b;for(const h of this.detailedDocumentStore.getDocument.annotations)if(h.id==c){b=h.label;break}s.push({id:p,word:r.text,score:{score:g,order:0},label:b,type:m[c].modification_type})}}return s}}},Tl={style:{display:"flex","align-items":"center","justify-content":"space-between"}},Wl={style:{"text-align":"center"}},Al=u(" Annotate page (Instance Explanation) "),El={style:{width:"100%"}},Ul={key:0,class:"demonstration"},Ml={key:1,class:"demonstration"},Bl=u("Words"),zl={style:{"font-size":"18px"}},Ol=u("Model Output"),Nl={style:{"text-align":"right",margin:"0"}},Ql=u(" add "),Gl=u(" remove "),Rl=u(" reset "),ql=u("Add"),Jl=u("Remove"),Hl=u("Delete"),Kl=u(" Prev "),Yl=u(" Next "),Zl=u(" Skip (Nothing to Mark Up)"),Xl=u(" Submit ");function er(e,t,s,a,r,d){const m=l("QuestionFilled"),c=l("el-icon"),p=l("el-popover"),g=l("el-row"),b=l("el-slider"),h=l("el-tag"),D=l("el-divider"),f=l("el-button"),v=l("el-col"),F=l("el-table-column"),w=l("Delete"),k=l("el-popconfirm"),$=l("el-table"),T=l("el-card"),A=l("ArrowLeft"),j=l("ArrowRight"),M=l("LocalDebugTutorial");return _(),S(P,null,[o(g,{style:{width:"100%"}},{default:n(()=>[o(g,{style:{width:"100%"}},{default:n(()=>[i("div",Tl,[i("h1",Wl,[Al,o(p,{content:"Attribution scores refer to how much the word positively correlates to the ground truth label.",trigger:"hover",width:400},{reference:n(()=>[o(c,{style:{height:"100%","margin-left":"0.5rem"}},{default:n(()=>[o(m)]),_:1})]),_:1})])])]),_:1}),o(g,{style:{width:"100%"}},{default:n(()=>[i("div",El,[r.topK>0?(_(),S("span",Ul,"Top "+V(r.topK)+" words",1)):L("",!0),r.topK==0?(_(),S("span",Ml,"All words")):L("",!0),o(b,{modelValue:r.topK,"onUpdate:modelValue":t[0]||(t[0]=C=>r.topK=C),max:this.detailedDocumentStore.getMaxWords},null,8,["modelValue","max"])])]),_:1}),this.detailedDocumentStore.getDocument?(_(),y(T,{key:0,style:{width:"100%","margin-top":"10px"}},{default:n(()=>[o(g,null,{default:n(()=>[o(v,{span:16},{default:n(()=>[o(g,null,{default:n(()=>[o(h,null,{default:n(()=>[Bl]),_:1}),"ground_truth"in this.detailedDocumentStore.getDocument?(_(),y(h,{key:0,style:{"margin-left":"10px"}},{default:n(()=>[u(" Ground truth: "+V(a.getLabelByID(this.detailedDocumentStore.getDocument.ground_truth).text),1)]),_:1})):L("",!0)]),_:1}),o(g,{style:{"line-height":"2","margin-top":"10px"}},{default:n(()=>[i("span",zl,V(this.detailedDocumentStore.getDocument.text),1)]),_:1}),o(D),(_(!0),S(P,null,U(this.detailedDocumentStore.getDocument.annotations,C=>(_(),y(g,{style:{"margin-top":"10px"},key:C.id},{default:n(()=>[o(g,{style:{width:"100%"}},{default:n(()=>[o(h,{style:{"margin-right":"10px"}},{default:n(()=>[Ol]),_:1}),o(h,null,{default:n(()=>[u("Label: "+V(a.getLabelByID(C.label).text),1)]),_:2},1024),o(p,{content:"If you think positively correlated words (red-colored) should not be correlated to the ground truth label prediction, delete those words! If you think weakly correlated words should be correlated to the ground truth label, add those words!",trigger:"hover",width:400},{reference:n(()=>[o(c,{style:{height:"100%","margin-left":"0.5rem"}},{default:n(()=>[o(m)]),_:1})]),_:1})]),_:2},1024),o(g,{style:{"line-height":"2","margin-top":"10px"}},{default:n(()=>[(_(!0),S(P,null,U(this.detailedDocumentStore.getDocument.words,E=>(_(),S("span",{key:E.id,style:N(d.getWordStyle(E.scores[C.id],C.label))},[o(p,{trigger:"hover",width:"200px"},{reference:n(()=>[i("span",null,V(E.text),1)]),default:n(()=>[i("p",null,V(E.text+": "+E.scores[C.id].score),1),i("div",Nl,[o(f,{size:"small",type:"success",onClick:$e=>d.wordClick(C.id,E.id,0)},{default:n(()=>[Ql]),_:2},1032,["onClick"]),o(f,{size:"small",type:"primary",onClick:$e=>d.wordClick(C.id,E.id,1)},{default:n(()=>[Gl]),_:2},1032,["onClick"]),o(f,{size:"small",type:"info",onClick:$e=>d.wordClick(C.id,E.id,-1)},{default:n(()=>[Rl]),_:2},1032,["onClick"])])]),_:2},1024)],4))),128))]),_:2},1024)]),_:2},1024))),128))]),_:1}),o(v,{span:8},{default:n(()=>[o($,{data:d.dictTableData,border:"",style:{width:"100%"}},{default:n(()=>[o(F,{label:"Word"},{default:n(C=>[i("span",{style:N(d.getWordStyle(C.row.score,C.row.label))},V(C.row.word),5)]),_:1}),o(F,{label:"Type"},{default:n(C=>[C.row.type==0?(_(),y(h,{key:0,type:"success"},{default:n(()=>[ql]),_:1})):L("",!0),C.row.type==1?(_(),y(h,{key:1,type:"danger"},{default:n(()=>[Jl]),_:1})):L("",!0)]),_:1}),o(F,{label:"Operations"},{default:n(C=>[o(k,{title:"Are you sure?",onConfirm:E=>d.wordDelete(C.row.id),style:{"margin-left":"10px"}},{reference:n(()=>[o(f,{size:"small",type:"danger"},{default:n(()=>[o(c,null,{default:n(()=>[o(w)]),_:1}),Hl]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])]),_:1})]),_:1})]),_:1})):L("",!0),o(g,{style:{"margin-top":"20px",width:"100%"}},{default:n(()=>[o(v,{style:{display:"flex","justify-content":"space-between"}},{default:n(()=>[o(f,{type:"primary",onClick:t[1]||(t[1]=C=>d.goToPrevDoc()),disabled:this.documentStore.getdocumentInfo.curDocIndex===0&&this.documentStore.getdocumentInfo.curPage===1},{default:n(()=>[o(c,null,{default:n(()=>[o(A)]),_:1}),Kl]),_:1},8,["disabled"]),o(f,{type:"primary",onClick:t[2]||(t[2]=C=>d.goToNextDoc()),disabled:this.documentStore.getdocumentInfo.curDocIndex===this.documentStore.getdocumentInfo.documents.length-1&&this.documentStore.getdocumentInfo.curPage===this.documentStore.getdocumentInfo.maxPage},{default:n(()=>[Yl,o(c,null,{default:n(()=>[o(j)]),_:1})]),_:1},8,["disabled"])]),_:1})]),_:1}),this.detailedDocumentStore.getDocument?(_(),y(g,{key:1,style:{"margin-top":"10px",width:"100%"}},{default:n(()=>[o(v,{style:{display:"flex","justify-content":"flex-end"}},{default:n(()=>[o(f,{type:"primary",onClick:d.noAnnotation},{default:n(()=>[Zl,o(c,null,{default:n(()=>[o(j)]),_:1})]),_:1},8,["onClick"])]),_:1})]),_:1})):L("",!0)]),_:1}),o(g,null,{default:n(()=>[o(f,{type:"primary",onClick:t[3]||(t[3]=C=>d.trainDebugModel())},{default:n(()=>[Xl]),_:1})]),_:1}),o(M,{"dialog-visible":r.tutorialVisible,"onUpdate:dialog-visible":t[4]||(t[4]=C=>r.tutorialVisible=C)},null,8,["dialog-visible"])],64)}var tr=I(Ll,[["render",er]]);const or={name:"GlobalDebugTutorial",props:{dialogVisible:Boolean,existingInfo:Object},setup(){},data(){return{}},methods:{}},nr=i("span",{slot:"title",style:{"font-size":"18pt","font-weight":"bold"}},"Task Explanation",-1),lr=i("div",{class:"container"},[i("div",{class:"row",style:{padding:"10px"}},[i("br"),i("br"),i("p",{class:"text",style:{"font-size":"15pt","text-align":"justify"}},[u(" Select words to debug for all instances. "),i("br"),u(" Attribution scores refer to how much the word positively correlates to the ground truth label. "),i("br")])])],-1),rr={class:"dialog-footer"},sr=u(" Understand ");function ir(e,t,s,a,r,d){const m=l("el-button"),c=l("el-dialog");return _(),y(c,{modelValue:s.dialogVisible,"onUpdate:modelValue":t[1]||(t[1]=p=>s.dialogVisible=p),"onUpdate:visible":t[2]||(t[2]=p=>e.$emit("update:dialogVisible",p)),onClose:t[3]||(t[3]=p=>e.$emit("update:dialogVisible",!1)),width:"50%"},{footer:n(()=>[i("span",rr,[o(m,{onClick:t[0]||(t[0]=()=>e.$emit("update:dialogVisible",!1))},{default:n(()=>[sr]),_:1})])]),default:n(()=>[nr,lr]),_:1},8,["modelValue"])}var ar=I(or,[["render",ir]]);const dr={name:"GlobalExplanations",components:{ArrowLeft:Te,ArrowRight:We,QuestionFilled:G,GlobalDebugTutorial:ar},setup(){const e=te(),t=pe(),s=_e(),a=W();return{labelStore:e,wordStore:t,globalDictionaryStore:s,projectStore:a,TaskTypes:O,getLabelByID:e.getLabelByID}},data(){return{tutorialVisible:!0}},computed:{documents:function(){return this.wordStore.getDocuments}},methods:{addWord(e){this.globalDictionaryStore.addWord(this.wordStore.getCurrWord(),e,this.getLabelByID(this.documents[0].ground_truth).id)},getWordStyle(e,t){const s={padding:"3px 3px 3px 3px",margin:"3px 3px 3px 3px",fontSize:"18px"},a=e.score,r=q[1].colors;let d=-1;return a<=.1?s:(a<=.5?d=0:a<=.75?d=1:a<=1&&(d=2),B(B({},s),r[d]))},goToPrevWord(){const e=this.wordStore.getWordInfo.curWordIndex-1;e==-1?this.wordStore.updateCurPage(this.wordStore.getWordInfo.curPage-1).then(()=>{this.wordStore.setCurWordIndex(this.wordStore.getWords.length-1),this.wordStore.fetchDocuments()}):(this.wordStore.setCurWordIndex(e),this.wordStore.fetchDocuments())},goToNextWord(){const e=this.wordStore.getWordInfo.curWordIndex+1;this.wordStore.getWords.length==e?this.wordStore.updateCurPage(this.wordStore.getWordInfo.curPage+1).then(()=>{this.wordStore.fetchDocuments()}):(this.wordStore.setCurWordIndex(e),this.wordStore.fetchDocuments())}}},cr={style:{display:"flex","align-items":"center","justify-content":"space-between"}},ur={style:{"text-align":"center"}},pr=u(" Annotate page (Task Explanation) "),_r=u(" Prev "),mr=u(" Next "),gr=u(" Current Word: "),hr={style:{"margin-left":"10px",display:"inline-block"}},fr=u(" add "),br=u(" remove "),yr=u(" reset ");function Sr(e,t,s,a,r,d){const m=l("QuestionFilled"),c=l("el-icon"),p=l("el-popover"),g=l("el-row"),b=l("ArrowLeft"),h=l("el-button"),D=l("ArrowRight"),f=l("el-col"),v=l("el-tag"),F=l("el-divider"),w=l("el-card"),k=l("GlobalDebugTutorial");return _(),S(P,null,[o(g,{style:{width:"100%"}},{default:n(()=>[o(g,{style:{width:"100%"}},{default:n(()=>[i("div",cr,[i("h1",ur,[pr,o(p,{content:"Attribution scores refer to how much the word positively correlates to the ground truth label.",trigger:"hover",width:400},{reference:n(()=>[o(c,{style:{height:"100%","margin-left":"0.5rem"}},{default:n(()=>[o(m)]),_:1})]),_:1})])])]),_:1}),a.wordStore.getCurrWord()!==void 0?(_(),y(g,{key:0,style:{"margin-top":"20px",width:"100%"}},{default:n(()=>[o(f,{style:{display:"flex","justify-content":"space-between"}},{default:n(()=>[o(h,{type:"primary",onClick:t[0]||(t[0]=$=>d.goToPrevWord()),disabled:this.wordStore.getWordInfo.curWordIndex===0&&this.wordStore.getWordInfo.curPage===1},{default:n(()=>[o(c,null,{default:n(()=>[o(b)]),_:1}),_r]),_:1},8,["disabled"]),o(h,{type:"primary",onClick:t[1]||(t[1]=$=>d.goToNextWord()),disabled:this.wordStore.getWordInfo.curWordIndex===this.wordStore.getWordInfo.words.length-1&&this.wordStore.getWordInfo.curPage===this.wordStore.getWordInfo.maxPage},{default:n(()=>[mr,o(c,null,{default:n(()=>[o(D)]),_:1})]),_:1},8,["disabled"])]),_:1})]),_:1})):L("",!0),a.wordStore.wordLoaded?(_(),y(w,{key:1,style:{width:"100%","margin-top":"10px"}},{header:n(()=>[i("div",null,[gr,i("b",null,V(this.wordStore.getCurrWord()),1),i("div",hr,[a.globalDictionaryStore.containsWord(a.wordStore.getCurrWord())?L("",!0):(_(),y(h,{key:0,size:"small",type:"success",onClick:t[2]||(t[2]=$=>d.addWord(0))},{default:n(()=>[fr]),_:1})),a.globalDictionaryStore.containsWord(a.wordStore.getCurrWord())?L("",!0):(_(),y(h,{key:1,size:"small",type:"primary",onClick:t[3]||(t[3]=$=>d.addWord(1))},{default:n(()=>[br]),_:1})),a.globalDictionaryStore.containsWord(a.wordStore.getCurrWord())?(_(),y(h,{key:2,size:"small",type:"info",onClick:t[4]||(t[4]=$=>a.globalDictionaryStore.deleteWord(a.wordStore.getCurrWord()))},{default:n(()=>[yr]),_:1})):L("",!0),o(p,{content:"If you think positively correlated words (red-colored) should not be correlated to the ground truth label prediction, delete those words! If you think weakly correlated words should be correlated to the ground truth label, add those words!",trigger:"hover",width:400},{reference:n(()=>[o(c,{style:{height:"100%","margin-left":"0.5rem"}},{default:n(()=>[o(m)]),_:1})]),_:1})])])]),default:n(()=>[(_(!0),S(P,null,U(d.documents,($,T)=>(_(),y(g,{style:{width:"100%"},key:$.id},{default:n(()=>[(_(!0),S(P,null,U($.annotations,A=>(_(),y(g,{style:{width:"100%"},key:A.id},{default:n(()=>[o(g,{style:{width:"100%"}},{default:n(()=>[o(v,null,{default:n(()=>[u("Document #"+V(T+1),1)]),_:2},1024),"ground_truth"in $?(_(),y(v,{key:0,style:{"margin-left":"10px"}},{default:n(()=>[u(" Ground truth: "+V(a.getLabelByID($.ground_truth).text),1)]),_:2},1024)):L("",!0),o(v,{style:{"margin-left":"10px"}},{default:n(()=>[u(" Prediction: "+V(a.getLabelByID(A.label).text),1)]),_:2},1024)]),_:2},1024),o(g,{style:{"line-height":"2","margin-top":"10px"}},{default:n(()=>[i("div",null,[(_(!0),S(P,null,U($.words,j=>(_(),S("span",{key:j.id,style:N(d.getWordStyle(j.scores[A.id],A.label))},[o(p,{content:j.text+": "+j.scores[A.id].score,trigger:"hover"},{reference:n(()=>[i("span",{style:N(j.text===this.wordStore.getCurrWord()?{border:"2px solid black"}:{})},V(j.text),5)]),_:2},1032,["content"])],4))),128))])]),_:2},1024)]),_:2},1024))),128)),o(F)]),_:2},1024))),128))]),_:1})):L("",!0)]),_:1}),o(k,{"dialog-visible":r.tutorialVisible,"onUpdate:dialog-visible":t[5]||(t[5]=$=>r.tutorialVisible=$)},null,8,["dialog-visible"])],64)}var wr=I(dr,[["render",Sr]]);const vr={name:"DictionaryOverview",components:{Search:ye,Delete:ie},setup(){return{dictionaryStore:_e()}},data(){return{searchQuery:""}},watch:{searchQuery:function(e,t){this.dictionaryStore.fetchDictionary(e)}},methods:{indexMethod(e){return e+1},onClick(e,t){this.$router.push({name:"DebugGlobal",query:{q:t.word}})},handleDelete(e,t){this.dictionaryStore.deleteWord(t.word).then(()=>{this.dictionaryStore.fetchDictionary()})}},created(){this.dictionaryStore.fetchDictionary()}},xr={style:{"text-align":"center"}},Dr=i("div",null,[i("h1",null,"Task Dictionary")],-1),$r={style:{"align-content":"center"}},kr=["onClick"],Ir=u("Delete");function Cr(e,t,s,a,r,d){const m=l("Search"),c=l("el-icon"),p=l("el-input"),g=l("el-table-column"),b=l("Delete"),h=l("el-button"),D=l("el-popconfirm"),f=l("el-table");return _(),S("div",null,[i("div",xr,[Dr,o(p,{modelValue:r.searchQuery,"onUpdate:modelValue":t[0]||(t[0]=v=>r.searchQuery=v),modelModifiers:{lazy:!0,trim:!0},placeholder:"Type to search for words",style:{width:"50%"},clearable:""},{prefix:n(()=>[i("div",$r,[o(c,null,{default:n(()=>[o(m)]),_:1})])]),_:1},8,["modelValue"])]),o(f,{data:Array.from(a.dictionaryStore.getRows),stripe:""},{default:n(()=>[o(g,{type:"index",index:d.indexMethod},null,8,["index"]),o(g,{label:"Text",sortable:""},{default:n(v=>[i("p",{onClick:F=>d.onClick(v.$index,v.row),style:{cursor:"pointer"}},V(v.row.word),9,kr)]),_:1}),o(g,{label:"Operations"},{default:n(v=>[o(D,{title:"Are you sure?",onConfirm:F=>d.handleDelete(v.$index,v.row),style:{"margin-left":"10px"}},{reference:n(()=>[o(h,{size:"small",type:"danger"},{default:n(()=>[o(c,null,{default:n(()=>[o(b)]),_:1}),Ir]),_:1})]),_:2},1032,["onConfirm"])]),_:1})]),_:1},8,["data"])])}var jr=I(vr,[["render",Cr]]);const Fr={name:"EvaluationTutorial",props:{dialogVisible:Boolean,existingInfo:Object},setup(){},data(){return{}},methods:{}},Pr=i("span",{slot:"title",style:{"font-size":"18pt","font-weight":"bold"}},"Evaluation",-1),Vr=i("div",{class:"container"},[i("div",{class:"row",style:{padding:"10px"}},[i("br"),i("br"),i("p",{class:"text",style:{"font-size":"15pt","text-align":"justify"}},[u(" Now you have debugged model. "),i("br"),u(" You can download the debug model. "),i("br"),u(" Moreover, you can check how the explanations get changed after debugging! ")])])],-1),Lr={class:"dialog-footer"},Tr=u(" Understand ");function Wr(e,t,s,a,r,d){const m=l("el-button"),c=l("el-dialog");return _(),y(c,{modelValue:s.dialogVisible,"onUpdate:modelValue":t[1]||(t[1]=p=>s.dialogVisible=p),"onUpdate:visible":t[2]||(t[2]=p=>e.$emit("update:dialogVisible",p)),onClose:t[3]||(t[3]=p=>e.$emit("update:dialogVisible",!1)),width:"50%"},{footer:n(()=>[i("span",Lr,[o(m,{onClick:t[0]||(t[0]=()=>e.$emit("update:dialogVisible",!1))},{default:n(()=>[Tr]),_:1})])]),default:n(()=>[Pr,Vr]),_:1},8,["modelValue"])}var Ar=I(Fr,[["render",Wr]]);const Er={name:"DebugEvaluation",components:{Back:ae,Check:Se,Download:be,EvaluationTutorial:Ar},setup(){const e=le(),t=De(),s=te(),a=ue(),r=W(),d=pe();return{documentStore:e,detailedDocumentStore:t,labelStore:s,localDictionaryStore:a,projectStore:r,wordStore:d,getLabelByID:s.getLabelByID}},created(){const e=[];e.push(this.labelStore.fetchLabels()),e.push(this.documentStore.resetState().then(()=>this.localDictionaryStore.fetchDictionary(this.documentStore.getDocuments[this.documentStore.getdocumentInfo.curDocIndex].id))),Promise.all(e).then(()=>{this.detailedDocumentStore.fetchDocument(this.documentStore.getDocuments[this.documentStore.getdocumentInfo.curDocIndex].id)}),this.getModelDetails()},data(){return{tutorialVisible:!0,exampleInputsForm:{sentence_id:""},downloading:!1,model:{model_id:"",model_name:""},detailedSentence:[],debugTrainingSentence:[],loadingAnnotations:!1}},computed:{getDocText(){return console.log("calling getDocTest"),console.log(this.exampleInputsForm.sentence_id),this.detailedSentence},documents:function(){return console.log("inside documents function"),console.log(this.detailedSentence),this.detailedSentence}},methods:{updateDetailedDoc(e){this.loadingAnnotations=!0;const t=[];t.push(this.detailedDocumentStore.fetchDocument(e)),Promise.all(t).then(()=>{this.detailedSentence=[this.detailedDocumentStore.getDocument],this.calculateAttrsForDoc(this.detailedSentence[0].text,this.getLabelByID(this.detailedSentence[0].ground_truth).text).then(s=>{this.debugTrainingSentence=JSON.parse(s).res,console.log(JSON.parse(s).res),this.loadingAnnotations=!1}).catch(s=>{console.log(s),this.loadingAnnotations=!1})})},getModelDetails(){X.list(this.projectStore.getProjectInfo.id).then(e=>{console.log(e.results.at(-1));const t=e.results.at(-1);this.model.model_id=t.id,this.model.model_name=t.name})},modelDownload(){this.downloading=!0,X.downloadModel(this.projectStore.getProjectInfo.id,this.model.model_id).then(e=>{console.log(e.length);const t=new Blob([e],{type:"application/zip"});et.exports.saveAs(t,"test.zip"),this.downloading=!1}).catch(e=>{console.log(e),this.downloading=!1})},str2bytes(e){for(var t=new Uint8Array(e.length),s=0;s<e.length;s++)t[s]=e.charCodeAt(s);return t},getWordStyle(e=0,t){const s={padding:"3px 3px 3px 3px",margin:"3px 3px 3px 3px",fontSize:"18px"},a=e.score,r=q[1].colors;let d=-1;return a<=.1?s:(a<=.5?d=0:a<=.75?d=1:a<=1&&(d=2),B(B({},s),r[d]))},calculateAttrsForDoc(e,t){return re.getAttributeScoresForDoc(this.projectStore.getProjectInfo.id,e,t,this.model.model_id).then(s=>(console.log(s),s.res))}}},Ur=u("Evaluation Section "),Mr={style:{"padding-right":"1em"}},Br=u("Model Selected: "),zr=i("h4",null,"Example Input",-1),Or=u("Before Debugging"),Nr=u("After Debug Training"),Qr=i("span",null,"\xA0",-1);function Gr(e,t,s,a,r,d){const m=l("QuestionFilled"),c=l("el-icon"),p=l("el-popover"),g=l("Download"),b=l("el-button"),h=l("el-divider"),D=l("el-option"),f=l("el-select"),v=l("el-form-item"),F=l("el-form"),w=l("el-tag"),k=l("el-row"),$=l("el-card"),T=l("EvaluationTutorial"),A=we("loading");return _(),S(P,null,[o(k,{style:{width:"100%"}},{default:n(()=>[o($,{style:{width:"100%"}},{header:n(()=>[i("h3",null,[Ur,o(p,{content:"help text",trigger:"hover",width:400},{reference:n(()=>[o(c,{style:{height:"100%","margin-left":"0.5rem"}},{default:n(()=>[o(m)]),_:1})]),_:1})])]),default:n(()=>[o(k,null,{default:n(()=>[i("span",Mr,[Br,i("b",null,V(r.model.model_name),1)]),o(b,{type:"primary",size:"small",loading:r.downloading,onClick:t[0]||(t[0]=j=>this.modelDownload())},{default:n(()=>[o(c,null,{default:n(()=>[o(g)]),_:1})]),_:1},8,["loading"]),o(h),zr,o(F,{model:r.exampleInputsForm,size:"large",style:{width:"100%"}},{default:n(()=>[o(v,null,{default:n(()=>[o(f,{modelValue:r.exampleInputsForm.sentence_id,"onUpdate:modelValue":t[1]||(t[1]=j=>r.exampleInputsForm.sentence_id=j),placeholder:"Select a Sentence",size:"large",onChange:d.updateDetailedDoc,style:{width:"100%"}},{default:n(()=>[(_(!0),S(P,null,U(a.documentStore.getDocuments,j=>(_(),y(D,{key:j.id,label:j.text,value:j.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1})]),_:1},8,["model"]),(_(!0),S(P,null,U(r.detailedSentence,(j,M)=>(_(),y(k,{style:{width:"100%"},key:j.id},{default:n(()=>[(_(!0),S(P,null,U(j.annotations,C=>(_(),y(k,{style:{width:"100%"},key:C.id},{default:n(()=>[o(k,{style:{width:"100%"}},{default:n(()=>[o(w,null,{default:n(()=>[u("Document #"+V(M+1),1)]),_:2},1024),"ground_truth"in j?(_(),y(w,{key:0,style:{"margin-left":"10px"}},{default:n(()=>[u(" Ground truth: "+V(a.getLabelByID(j.ground_truth).text),1)]),_:2},1024)):L("",!0)]),_:2},1024),o(k,{style:{width:"100%","margin-top":"10px"}},{default:n(()=>[o(w,{type:"warning"},{default:n(()=>[Or]),_:1})]),_:1}),o(k,{style:{"line-height":"2","margin-top":"10px"}},{default:n(()=>[(_(!0),S(P,null,U(j.words,E=>(_(),S("span",{key:E.id,style:N(d.getWordStyle(E.scores[C.id],C.label))},[o(p,{content:E.text+": "+E.scores[C.id].score,trigger:"hover"},{reference:n(()=>[i("span",null,V(E.text),1)]),_:2},1032,["content"])],4))),128))]),_:2},1024)]),_:2},1024))),128)),o(h)]),_:2},1024))),128)),(_(!0),S(P,null,U(r.detailedSentence,(j,M)=>(_(),y(k,{style:{width:"100%"},key:j.id},{default:n(()=>[(_(!0),S(P,null,U(j.annotations,C=>(_(),y(k,{style:{width:"100%"},key:C.id},{default:n(()=>[o(k,{style:{width:"100%"}},{default:n(()=>[o(w,{type:"warning"},{default:n(()=>[Nr]),_:1})]),_:1}),r.model.model_id?ve((_(),y(k,{key:0,style:{"line-height":"2","margin-top":"10px"}},{default:n(()=>[(_(!0),S(P,null,U(r.debugTrainingSentence,E=>(_(),S("span",{style:N(d.getWordStyle({score:E.score},C.label))},[o(p,{content:E.text+": "+E.score,trigger:"hover"},{reference:n(()=>[i("span",null,V(E.text),1)]),_:2},1032,["content"])],4))),256)),Qr]),_:2},1024)),[[A,r.loadingAnnotations]]):L("",!0)]),_:2},1024))),128)),o(h)]),_:2},1024))),128))]),_:1})]),_:1})]),_:1}),o(T,{"dialog-visible":r.tutorialVisible,"onUpdate:dialog-visible":t[2]||(t[2]=j=>r.tutorialVisible=j)},null,8,["dialog-visible"])],64)}var Rr=I(Er,[["render",Gr]]),se={updateToken(e){x.defaults.headers.Authorization=`Bearer ${e}`},login(e,t,s=!1){const a=J();return x.post("token/",{username:e,password:t,rememberMe:s}).then(r=>(r.token=r.access,delete r.access,a.login(R(B({},r),{username:e})),r))},refreshToken(){const e=J();return x.post("token/refresh/",{token:e.token}).then(t=>{e.updateToken(t.token)})}};const qr={name:"LoginPage",components:{UserFilled:tt,Lock:ot},data(){return{loginForm:{username:"test",password:"test",rememberMe:!1},rules:{username:[{required:!0,message:"Please input username",trigger:"blur"}],password:[{required:!0,message:"Please input password",trigger:"blur"}]},isLoading:!1,isValid:!1,showLoginFailed:"none"}},methods:{login(){this.$refs.loginForm.validate(e=>{if(e)this.isLoading=!0,this.showLoginFailed="none",se.login(this.loginForm.username,this.loginForm.password,this.loginForm.rememberMe).catch(()=>{this.isLoading=!1,this.showLoginFailed=""});else return!1})}}},Jr=e=>(H("data-v-2536a0bc"),e=e(),K(),e),Hr={style:{display:"flex","justify-content":"center"}},Kr={style:{"align-content":"center"}},Yr={style:{"align-content":"center"}},Zr=u(" Login "),Xr=Jr(()=>i("div",{style:{display:"flex","justify-content":"center"}},[i("p",null,"test ID: test / password: test")],-1));function es(e,t,s,a,r,d){const m=l("el-alert"),c=l("UserFilled"),p=l("el-icon"),g=l("el-input"),b=l("el-form-item"),h=l("Lock"),D=l("el-checkbox"),f=l("el-button"),v=l("el-form"),F=l("el-col"),w=we("loading");return _(),S(P,null,[i("div",Hr,[ve((_(),y(F,{span:6,style:{"margin-top":"2em"}},{default:n(()=>[o(m,{title:"Invalid username/password",type:"error","show-icon":"",style:N({display:r.showLoginFailed})},null,8,["style"]),o(v,{model:r.loginForm,rules:r.rules,ref:"loginForm"},{default:n(()=>[o(b,{label:"Username",prop:"username",class:"bold-label"},{default:n(()=>[o(g,{modelValue:r.loginForm.username,"onUpdate:modelValue":t[0]||(t[0]=k=>r.loginForm.username=k)},{prefix:n(()=>[i("div",Kr,[o(p,null,{default:n(()=>[o(c)]),_:1})])]),_:1},8,["modelValue"])]),_:1}),o(b,{label:"Password",prop:"password",class:"bold-label"},{default:n(()=>[o(g,{type:"password",modelValue:r.loginForm.password,"onUpdate:modelValue":t[1]||(t[1]=k=>r.loginForm.password=k)},{prefix:n(()=>[i("div",Yr,[o(p,null,{default:n(()=>[o(h)]),_:1})])]),_:1},8,["modelValue"])]),_:1}),o(b,null,{default:n(()=>[o(D,{label:"Remember me",modelValue:r.loginForm.rememberMe,"onUpdate:modelValue":t[2]||(t[2]=k=>r.loginForm.rememberMe=k)},null,8,["modelValue"])]),_:1}),o(b,null,{default:n(()=>[o(f,{type:"primary",onClick:d.login,disabled:this.isValid,style:{width:"100%"}},{default:n(()=>[Zr]),_:1},8,["onClick","disabled"])]),_:1})]),_:1},8,["model","rules"])]),_:1})),[[w,r.isLoading]])]),Xr],64)}var ts=I(qr,[["render",es],["__scopeId","data-v-2536a0bc"]]);const os={name:"LogoutPage",setup(){return{userStore:J()}},created(){this.userStore.logout()}};function ns(e,t,s,a,r,d){return _(),S("div")}var ls=I(os,[["render",ns]]);const ne=nt({history:lt("/"),routes:[{path:"/",name:"Home",component:ft},{path:"/projects",name:"Projects",component:Et},{path:"/login",name:"Login",component:ts},{path:"/logout",component:ls},{path:"/project/",component:Kt,children:[{path:"doc/",component:Xt,children:[{path:"upload",name:"DocumentUpload",component:Zo},{path:"list",name:"DocumentList",component:mo},{path:"model",name:"ModelUpload",component:cn}]},{path:"labels",name:"Labels",component:bn},{path:"generate-explanations",name:"GenerateExplanations",component:Pn},{path:"export",name:"ExportData",component:An}]},{path:"/debug/",component:sl,children:[{path:"overview",name:"DebugOverview",component:$l},{path:"dictionary",name:"DebugDictionary",component:jr},{path:"local",name:"DebugLocal",component:tr},{path:"global",name:"DebugGlobal",component:wr},{path:"evaluation",name:"DebugEvaluation",component:Rr}]}]});ne.beforeEach((e,t,s)=>{!J().isLoggedIn&&e.name!=="Login"&&e.name!=="Home"?s("/"):(e.name=="Login",s())});ne.afterEach(()=>{const e=J();e.isLoggedIn&&e.inspectToken()});const J=Q({id:"user",presist:!0,state:()=>({userInfo:null}),getters:{username:e=>e.userInfo.username,token:e=>e.userInfo.token,isLoggedIn:e=>e.userInfo!==null},actions:{login(e){this.userInfo=e,se.updateToken(e.token),ne.push({name:"Projects"}).then(t=>t)},logout(){this.userInfo=null,ne.push("/").then(e=>e)},updateToken(e){this.userInfo.token=e,se.updateToken(e)},inspectToken(){const e=this.userInfo.token;if(e){const t=rt(e),s=t.exp,a=t.orig_iat;s<Date.now()/1e3?this.logout():s-Date.now()/1e3<1800&&Date.now()/1e3-a<628200&&se.refreshToken()}}}});var rs="/assets/logo.4941f0a9.png";const ss={name:"NavBar",components:{},setup(){return{userStore:J(),Logo:rs}},methods:{loginClicked(){this.userStore.isLoggedIn?this.$router.push("/login"):this.$router.push("/logout")}}},is=u(" Projects ");function as(e,t,s,a,r,d){const m=l("el-image"),c=l("el-menu-item"),p=l("el-button"),g=l("el-menu");return _(),y(g,{"default-active":e.$route.path,mode:"horizontal",router:!0},{default:n(()=>[o(c,{index:"/"},{default:n(()=>[o(m,{src:a.Logo,style:{width:"58px",height:"58px"}},null,8,["src"])]),_:1}),a.userStore.isLoggedIn?(_(),y(c,{key:0,index:"/projects"},{default:n(()=>[is]),_:1})):L("",!0),o(c,{index:a.userStore.isLoggedIn?"/logout":"/login",class:"dock-right",style:{width:"200px",height:"58px",display:"flex","justify-content":"center"}},{default:n(()=>[o(p,{type:"primary",onClick:t[0]||(t[0]=b=>d.loginClicked(b)),jest:"logBtn",style:{width:"150px",display:"flex","justify-content":"center"}},{default:n(()=>[u(V(this.userStore.isLoggedIn?"Logout":"Login"),1)]),_:1})]),_:1},8,["index"])]),_:1},8,["default-active"])}var ds=I(ss,[["render",as],["__scopeId","data-v-3b7773b4"]]);const cs={components:{NavBar:ds}},us={id:"app"};function ps(e,t,s,a,r,d){const m=l("NavBar"),c=l("router-view");return _(),S("div",us,[o(m,{style:{width:"100%"}}),o(c)])}var _s=I(cs,[["render",ps]]);const oe=st(_s);oe.use(it);oe.provide("$api",x);oe.use(at,{locale:dt});const Ae=ct();Ae.use(ut);oe.use(Ae);oe.use(ne);oe.mount("#app");
